<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>WOMAN HELP | Премиум сервис для женщин</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Обновленная цветовая палитра - СДЕРЖАННЫЙ И СТИЛЬНЫЙ */
        :root {
            --ivory-bg: #F9F7F3;
            --ivory-light: #FDFCF9;
            --graphite-dark: #3D3D3D;
            --graphite-medium: #555555;
            --graphite-light: #888888;
            --soft-pink: #F2DDE6;
            --pink-light: #F8F0F5;
            --dusty-pink: #E8D1DE;
            --gold-metallic: #C5A880;
            --gold-dark: #A78B65;
            --lavender-purple: #B9AFFF;
            --lavender-light: #EAE7FF;
            --aqua-teal: #7FE0D1;
            --aqua-light: #E6F7F4;
            --white: #FFFFFF;
            --success: #38B2AC;
            --warning: #ED8936;
            --error: #E57373;
            --info: #5C6BC0;
            --primary-gold: #C5A880;
            --primary-gold-dark: #A78B65;
            --primary-gradient: linear-gradient(135deg, var(--primary-gold), var(--primary-gold-dark));
            --aqua-gradient: linear-gradient(135deg, var(--aqua-teal), #6BD4C5);
            --lavender-gradient: linear-gradient(135deg, var(--lavender-purple), #A89EFF);
            
            --shadow-sm: 0 2px 8px rgba(61, 61, 61, 0.04);
            --shadow: 0 4px 16px rgba(61, 61, 61, 0.08);
            --shadow-lg: 0 8px 32px rgba(61, 61, 61, 0.12);
            --shadow-xl: 0 20px 40px rgba(61, 61, 61, 0.15);
            
            --radius-sm: 8px;
            --radius: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-full: 9999px;
            
            --transition-fast: 0.15s ease;
            --transition: 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 0.4s ease;
            
            --nav-height: 70px;
            --bottom-nav-height: 60px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--ivory-bg);
            color: var(--graphite-dark);
            line-height: 1.6;
            min-height: 100vh;
            font-weight: 400;
            padding-top: var(--nav-height);
            padding-bottom: var(--bottom-nav-height);
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 16px;
            width: 100%;
        }
        
        /* Основная навигация сверху */
        .top-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--nav-height);
            background: var(--white);
            border-bottom: 1px solid rgba(61, 61, 61, 0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.97);
        }
        
        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--graphite-dark);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-img {
            height: 36px;
            width: 36px;
            border-radius: 8px;
            object-fit: cover;
            background: var(--primary-gradient);
            padding: 4px;
        }
        
        .logo-woman {
            color: var(--graphite-dark);
        }
        
        .logo-help {
            color: var(--primary-gold);
        }
        
        .logo-tagline {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--graphite-medium);
            margin-left: 10px;
            font-family: 'Inter', sans-serif;
            padding-left: 10px;
            border-left: 1px solid var(--graphite-light);
        }
        
        .user-avatar {
            width: 42px;
            height: 42px;
            background: var(--primary-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            border: 2px solid rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .user-avatar:hover {
            transform: scale(1.05);
        }
        
        .user-menu {
            display: none;
            position: absolute;
            top: 70px;
            right: 20px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-xl);
            padding: 10px;
            min-width: 200px;
            z-index: 1001;
            border: 1px solid rgba(61, 61, 61, 0.1);
            animation: fadeIn 0.2s ease;
        }
        
        .nav-menu-item {
            display: flex;
            align-items: center;
            padding: 10px;
            text-decoration: none;
            color: var(--graphite-dark);
            border-radius: var(--radius-sm);
            transition: var(--transition-fast);
            gap: 10px;
            width: 100%;
        }
        
        .nav-menu-item:hover {
            background: rgba(61, 61, 61, 0.05);
        }
        
        /* Нижняя навигация */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--bottom-nav-height);
            background: var(--white);
            border-top: 1px solid rgba(61, 61, 61, 0.08);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 10px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.98);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: var(--graphite-medium);
            padding: 8px 12px;
            border-radius: var(--radius);
            transition: var(--transition-fast);
            min-width: 70px;
            cursor: pointer;
        }
        
        .nav-item.active {
            color: var(--primary-gold);
            background: rgba(197, 168, 128, 0.08);
        }
        
        .nav-item i {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }
        
        .nav-item span {
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        /* Основной контент */
        .page {
            display: none;
            animation: fadeIn 0.3s ease;
            min-height: calc(100vh - var(--nav-height) - var(--bottom-nav-height));
            padding: 20px 0;
            width: 100%;
        }
        
        .page.active {
            display: block;
        }
        
        /* Секции */
        .section {
            margin-bottom: 30px;
            width: 100%;
        }
        
        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--graphite-dark);
            margin-bottom: 20px;
        }
        
        .section-subtitle {
            font-size: 1rem;
            color: var(--graphite-medium);
            margin-bottom: 24px;
            line-height: 1.5;
        }
        
        /* Карточки */
        .card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 20px;
            border: 1px solid rgba(61, 61, 61, 0.08);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            width: 100%;
        }
        
        /* Кнопки */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 28px;
            border: none;
            border-radius: var(--radius);
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
        }
        
        .btn-primary {
            background: var(--aqua-gradient);
            color: white;
            box-shadow: 0 4px 12px rgba(127, 224, 209, 0.25);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #6BD4C5, #5AC6B7);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(127, 224, 209, 0.3);
        }
        
        .btn-secondary {
            background: white;
            color: var(--graphite-dark);
            border: 2px solid rgba(61, 61, 61, 0.1);
        }
        
        .btn-secondary:hover {
            background: rgba(61, 61, 61, 0.02);
            border-color: var(--graphite-light);
            transform: translateY(-1px);
        }
        
        .btn-gold {
            background: var(--primary-gradient);
            color: white;
            border: none;
        }
        
        .btn-gold:hover {
            background: linear-gradient(135deg, var(--gold-dark), #957852);
            transform: translateY(-2px);
        }
        
        .btn-white {
            background: white;
            color: var(--graphite-dark);
            border: 2px solid var(--primary-gold);
        }
        
        .btn-white:hover {
            background: var(--primary-gold);
            color: white;
            transform: translateY(-2px);
        }
        
        /* Hero секция */
        .hero {
            background: linear-gradient(135deg, rgba(249, 247, 243, 0.9), rgba(242, 221, 230, 0.3));
            border-radius: var(--radius-xl);
            padding: 40px;
            margin-bottom: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .hero:before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200px;
            height: 200px;
            background: linear-gradient(135deg, var(--lavender-light), transparent);
            border-radius: 50%;
            opacity: 0.2;
        }
        
        .hero:after {
            content: '';
            position: absolute;
            bottom: -30%;
            left: -30%;
            width: 150px;
            height: 150px;
            background: linear-gradient(135deg, transparent, var(--aqua-teal));
            border-radius: 50%;
            opacity: 0.1;
        }
        
        .hero-content {
            position: relative;
            z-index: 1;
        }
        
        .hero h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--graphite-dark);
            line-height: 1.2;
        }
        
        .hero .tagline {
            font-size: 1.8rem;
            color: var(--primary-gold);
            font-weight: 600;
            margin-bottom: 24px;
        }
        
        .hero p {
            font-size: 1.1rem;
            color: var(--graphite-medium);
            margin-bottom: 32px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .hero-actions {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        /* Сетки */
        .grid {
            display: grid;
            gap: 16px;
            width: 100%;
        }
        
        .grid-2 {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        }
        
        /* Категории с превью изображениями */
        .category-card {
            text-align: center;
            padding: 20px 16px;
            cursor: pointer;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--aqua-teal);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .category-card:hover::before {
            transform: scaleX(1);
        }
        
        .category-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
        }
        
        .category-icon {
            font-size: 2.5rem;
            color: var(--lavender-purple);
            margin-bottom: 15px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .category-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: var(--radius);
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--pink-light), var(--soft-pink));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--lavender-purple);
            font-size: 2.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .category-card h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--graphite-dark);
        }
        
        .category-card p {
            color: var(--graphite-medium);
            font-size: 0.85rem;
            margin-bottom: 16px;
            flex-grow: 1;
        }
        
        /* Услуги - уменьшенные карточки с изображениями */
        .service-card {
            padding: 16px;
            cursor: pointer;
            height: 100%;
            display: flex;
            flex-direction: column;
            min-height: 220px;
            transition: all 0.3s ease;
            border: 1px solid rgba(185, 175, 255, 0.1);
        }
        
        .service-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
            border-color: var(--lavender-purple);
        }
        
        .service-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: var(--radius-sm);
            margin-bottom: 12px;
            background: linear-gradient(135deg, var(--pink-light), var(--soft-pink));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--lavender-purple);
            font-size: 2.5rem;
        }
        
        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }
        
        .service-header h4 {
            font-size: 1rem;
            font-weight: 600;
            flex: 1;
            margin-right: 10px;
            min-height: 48px;
            color: var(--graphite-dark);
        }
        
        .service-description {
            color: var(--graphite-medium);
            font-size: 0.85rem;
            margin-bottom: 16px;
            line-height: 1.4;
            flex-grow: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }
        
        .service-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }
        
        .service-price {
            color: var(--aqua-teal);
            font-weight: 600;
            font-size: 0.9rem;
            background: rgba(127, 224, 209, 0.08);
            padding: 4px 8px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .service-price i {
            font-size: 0.8rem;
        }
        
        /* Профиль */
        .profile-header {
            background: var(--primary-gradient);
            color: white;
            padding: 30px 20px;
            border-radius: var(--radius-xl);
            margin-bottom: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .profile-avatar {
            width: 100px;
            height: 100px;
            background: white;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--aqua-teal);
            font-size: 2.5rem;
            font-weight: 700;
            border: 4px solid rgba(255, 255, 255, 0.3);
        }
        
        .profile-name {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .profile-email {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 16px;
        }
        
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 12px;
            border-radius: var(--radius);
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }
        
        /* Подписки */
        .subscription-card {
            padding: 24px 20px;
            text-align: center;
            border: 2px solid rgba(61, 61, 61, 0.1);
            position: relative;
            cursor: pointer;
            height: 100%;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }
        
        .subscription-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
        }
        
        .subscription-card.popular {
            border-color: var(--aqua-teal);
        }
        
        .popular-badge {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--aqua-gradient);
            color: white;
            padding: 4px 16px;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .subscription-card h3 {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--graphite-dark);
        }
        
        .subscription-price {
            font-size: 2rem;
            font-weight: 700;
            color: var(--aqua-teal);
            margin: 16px 0;
        }
        
        .subscription-price span {
            font-size: 0.9rem;
            color: var(--graphite-medium);
        }
        
        .subscription-features {
            text-align: left;
            margin: 20px 0;
            flex-grow: 1;
        }
        
        .subscription-features li {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--graphite-medium);
            font-size: 0.9rem;
        }
        
        .subscription-features i {
            color: var(--aqua-teal);
            font-size: 0.9rem;
        }
        
        /* Статистика сервиса */
        .service-stats {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: 40px 30px;
            margin: 40px 0;
            text-align: center;
            box-shadow: var(--shadow);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .stat-card {
            padding: 20px;
            border-radius: var(--radius);
            background: linear-gradient(135deg, rgba(127, 224, 209, 0.05), rgba(107, 212, 197, 0.05));
            border: 1px solid rgba(127, 224, 209, 0.1);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--aqua-teal);
            margin-bottom: 10px;
        }
        
        .stat-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--graphite-dark);
            margin-bottom: 8px;
        }
        
        .stat-description {
            color: var(--graphite-medium);
            font-size: 0.9rem;
        }
        
        .stat-counter {
            font-size: 0.8rem;
            color: var(--graphite-light);
            margin-top: 5px;
            font-style: italic;
        }
        
        /* Баннер с рекламой/акцией */
        .promo-banner {
            background: linear-gradient(135deg, var(--lavender-purple), var(--aqua-teal));
            color: white;
            padding: 30px;
            border-radius: var(--radius-lg);
            margin: 30px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .promo-banner h3 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .promo-banner p {
            font-size: 1.1rem;
            margin-bottom: 20px;
            opacity: 0.9;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* Уведомления */
        .notification {
            position: fixed;
            top: 100px;
            right: 16px;
            z-index: 3000;
            background: white;
            border-radius: var(--radius);
            padding: 16px;
            box-shadow: var(--shadow-lg);
            border-left: 4px solid var(--aqua-teal);
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 90%;
            width: 350px;
        }
        
        .notification.error {
            border-left-color: var(--error);
        }
        
        .notification.warning {
            border-left-color: var(--warning);
        }
        
        .notification.info {
            border-left-color: var(--info);
        }
        
        /* Загрузка */
        .loader {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(61, 61, 61, 0.1);
            border-top: 4px solid var(--aqua-teal);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        /* Модальные окна */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: var(--radius-lg);
            max-width: 400px;
            width: 100%;
            animation: modalSlideIn 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--graphite-dark);
        }
        
        .form-group {
            margin-bottom: 20px;
            width: 100%;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--graphite-dark);
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 1.5px solid rgba(61, 61, 61, 0.1);
            border-radius: var(--radius-sm);
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--aqua-teal);
            box-shadow: 0 0 0 3px rgba(127, 224, 209, 0.1);
        }
        
        /* Создание задачи */
        .create-task-form {
            margin-top: 20px;
        }
        
        /* Список задач - МОБИЛЬНЫЕ КАРТОЧКИ */
        .task-list {
            margin-top: 20px;
        }
        
        .task-item {
            margin-bottom: 16px;
            padding: 16px;
            background: white;
            border-radius: var(--radius);
            border: 1px solid rgba(61, 61, 61, 0.08);
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .task-title {
            font-weight: 600;
            font-size: 1.1rem;
            flex: 1;
            color: var(--graphite-dark);
        }
        
        .task-status {
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
            margin-left: 10px;
        }
        
        .task-status.new {
            background: rgba(25, 118, 210, 0.1);
            color: #1976D2;
        }
        
        .task-status.in_progress {
            background: rgba(255, 152, 0, 0.1);
            color: #EF6C00;
        }
        
        .task-status.completed {
            background: rgba(76, 175, 80, 0.1);
            color: #2E7D32;
        }
        
        .task-status.cancelled {
            background: rgba(229, 115, 115, 0.1);
            color: #C62828;
        }
        
        .task-status.searching {
            background: rgba(255, 193, 7, 0.1);
            color: #FF8F00;
        }
        
        .task-status.assigned {
            background: rgba(33, 150, 243, 0.1);
            color: #1565C0;
        }

        /* Кнопка "Все услуги" */
        .view-all-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: white;
            color: var(--aqua-teal);
            border: 2px solid var(--aqua-teal);
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            margin-top: 20px;
        }

        .view-all-btn:hover {
            background: var(--aqua-teal);
            color: white;
        }

        /* Кнопка "Гайды" */
        .guides-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: var(--primary-gradient);
            color: white;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
        }

        .guides-btn:hover {
            background: linear-gradient(135deg, var(--gold-dark), #957852);
            transform: translateY(-2px);
        }

        /* Секция гайдов */
        .guides-section {
            margin: 40px 0;
        }

        .guides-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .guide-card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            border: 1px solid rgba(61, 61, 61, 0.08);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            cursor: pointer;
            height: 100%;
        }

        .guide-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
        }

        .guide-icon {
            font-size: 2.5rem;
            color: var(--aqua-teal);
            margin-bottom: 15px;
        }

        .guide-card h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--graphite-dark);
        }

        .guide-card p {
            color: var(--graphite-medium);
            font-size: 0.95rem;
            margin-bottom: 15px;
        }
        
        /* Анимации */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes countUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(127, 224, 209, 0.3); }
            70% { box-shadow: 0 0 0 10px rgba(127, 224, 209, 0); }
            100% { box-shadow: 0 0 0 0 rgba(127, 224, 209, 0); }
        }
        
        /* Адаптивность */
        @media (max-width: 768px) {
            .container {
                padding: 0 12px;
            }
            
            .hero h1 {
                font-size: 1.8rem;
            }
            
            .hero .tagline {
                font-size: 1.4rem;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
            
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .grid-3 {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .profile-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .subscription-card {
                margin-bottom: 20px;
            }
            
            .btn {
                padding: 10px 20px !important;
                font-size: 0.9rem !important;
            }
            
            .modal-content {
                padding: 20px !important;
                margin: 10px !important;
            }

            .hero-actions {
                flex-direction: column;
                align-items: center;
            }

            .hero-actions .btn {
                width: 100%;
                max-width: 300px;
            }

            .logo-tagline {
                display: none;
            }
            
            .category-image {
                height: 100px;
            }
            
            .service-image {
                height: 100px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 0 8px !important;
            }
            
            .hero {
                padding: 20px;
            }
            
            .hero h1 {
                font-size: 1.6rem;
            }
            
            .hero .tagline {
                font-size: 1.2rem;
            }
            
            .section-title {
                font-size: 1.4rem !important;
            }
            
            .grid-3 {
                grid-template-columns: 1fr;
            }
            
            .profile-stats {
                grid-template-columns: 1fr;
                gap: 8px !important;
            }
            
            .stat-item {
                padding: 10px !important;
            }
            
            .nav-item span {
                font-size: 0.7rem;
            }
            
            .nav-item i {
                font-size: 1rem !important;
                margin-bottom: 2px !important;
            }
            
            .notification {
                width: 90%;
                right: 5%;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .bottom-nav {
                height: 55px !important;
                padding: 0 5px !important;
            }
            
            .nav-item span {
                font-size: 0.65rem !important;
            }

            .service-card {
                min-height: 180px;
            }

            .service-header h4 {
                min-height: 40px;
                font-size: 0.9rem;
            }

            .service-description {
                font-size: 0.8rem;
                -webkit-line-clamp: 2;
            }
            
            .category-image {
                height: 80px;
            }
            
            .service-image {
                height: 80px;
            }
        }
        
        /* Стили для планшетов */
        @media (min-width: 769px) and (max-width: 1024px) {
            .grid-3 {
                grid-template-columns: repeat(2, 1fr) !important;
            }
            
            .container {
                padding: 0 16px !important;
            }
        }
        
        /* Ховеры только для десктопа */
        @media (min-width: 1025px) {
            .card:hover {
                transform: translateY(-4px);
                box-shadow: var(--shadow);
            }
            
            .category-card:hover {
                transform: translateY(-4px);
                box-shadow: var(--shadow);
            }
        }
        
        /* Админ кнопка */
        .admin-access-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            z-index: 1000;
            width: 50px;
            height: 50px;
            background: var(--primary-gradient);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            animation: pulse 2s infinite;
        }
        
        /* Кнопка панели исполнителя */
        .performer-access-btn {
            position: fixed;
            bottom: 140px;
            right: 20px;
            z-index: 1000;
            width: 50px;
            height: 50px;
            background: var(--aqua-gradient);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            animation: pulse 2s infinite;
        }
        
        /* Утилиты */
        .text-center {
            text-align: center;
        }
        
        .mt-20 {
            margin-top: 20px;
        }
        
        .mb-20 {
            margin-bottom: 20px;
        }
        
        .w-100 {
            width: 100%;
        }

        .d-flex {
            display: flex;
        }

        .justify-between {
            justify-content: space-between;
        }

        .align-center {
            align-items: center;
        }

        .gap-10 {
            gap: 10px;
        }

        .gap-20 {
            gap: 20px;
        }
        
        /* Исправления для текста */
        a {
            text-decoration: none;
            color: inherit;
        }
        
        button {
            font-family: 'Inter', sans-serif;
        }
        
        /* Плейсхолдеры */
        ::placeholder {
            color: var(--graphite-light);
            opacity: 0.7;
        }
        
        /* Фокус состояния */
        :focus {
            outline: 2px solid var(--aqua-teal);
            outline-offset: 2px;
        }
        
        /* Скроллбар */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--ivory-bg);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--aqua-teal);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #6BD4C5;
        }
        
        /* Новые стили для состояний пользователя */
        .auth-screen {
            min-height: 70vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .auth-content {
            text-align: center;
            max-width: 400px;
            margin: 0 auto;
            width: 100%;
        }
        
        .auth-card {
            padding: 40px 30px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
        }
        
        .auth-icon {
            font-size: 4rem;
            color: var(--aqua-teal);
            margin-bottom: 20px;
        }
        
        .auth-actions {
            margin-top: 30px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .support-btn {
            margin-top: 15px;
            width: 100%;
        }
        
        /* Табы для задач */
        .tabs {
            display: flex;
            border-bottom: 1px solid rgba(61, 61, 61, 0.1);
            margin-bottom: 20px;
            overflow-x: auto;
        }
        
        .tab {
            padding: 12px 20px;
            font-weight: 500;
            color: var(--graphite-medium);
            border-bottom: 3px solid transparent;
            cursor: pointer;
            white-space: nowrap;
            transition: var(--transition-fast);
        }
        
        .tab.active {
            color: var(--aqua-teal);
            border-bottom-color: var(--aqua-teal);
        }
        
        /* Пустые состояния */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }
        
        .empty-state-icon {
            font-size: 4rem;
            color: rgba(61, 61, 61, 0.1);
            margin-bottom: 20px;
        }
        
        .empty-state-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--graphite-dark);
            margin-bottom: 10px;
        }
        
        .empty-state-description {
            color: var(--graphite-medium);
            max-width: 300px;
            margin: 0 auto 20px;
        }
        
        /* Стили для чата в деталях задачи */
        .chat-container {
            background: white;
            border-radius: var(--radius-lg);
            border: 1px solid rgba(61, 61, 61, 0.08);
            overflow: hidden;
            margin-top: 24px;
        }
        
        .chat-header {
            padding: 16px 20px;
            background: var(--pink-light);
            border-bottom: 1px solid rgba(61, 61, 61, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--graphite-dark);
        }
        
        .chat-messages-container {
            height: 400px;
            overflow-y: auto;
            padding: 20px;
            background: rgba(249, 247, 243, 0.5);
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .chat-message {
            display: flex;
            max-width: 80%;
            animation: fadeInMessage 0.3s ease;
        }
        
        .chat-message.sent {
            margin-left: auto;
            flex-direction: row-reverse;
        }
        
        .message-bubble {
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            box-shadow: var(--shadow-sm);
            word-break: break-word;
        }
        
        .chat-message.sent .message-bubble {
            background: linear-gradient(135deg, var(--aqua-teal), #6BD4C5);
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .chat-message.received .message-bubble {
            background: white;
            border: 1px solid rgba(61, 61, 61, 0.1);
            color: var(--graphite-dark);
            border-bottom-left-radius: 4px;
        }
        
        .message-sender {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--graphite-medium);
        }
        
        .chat-message.sent .message-sender {
            text-align: right;
        }
        
        .message-time {
            font-size: 0.7rem;
            color: var(--graphite-light);
            margin-top: 4px;
        }
        
        .chat-message.sent .message-time {
            text-align: right;
        }
        
        .chat-input-area {
            padding: 16px 20px;
            border-top: 1px solid rgba(61, 61, 61, 0.08);
            background: white;
            display: flex;
            gap: 10px;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid rgba(61, 61, 61, 0.1);
            border-radius: 24px;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            resize: none;
            min-height: 48px;
            max-height: 120px;
            transition: var(--transition);
        }
        
        .chat-input:focus {
            outline: none;
            border-color: var(--aqua-teal);
            box-shadow: 0 0 0 3px rgba(127, 224, 209, 0.1);
        }
        
        .send-message-btn {
            background: var(--aqua-gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .send-message-btn:disabled {
            background: var(--graphite-light);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .no-messages {
            text-align: center;
            padding: 40px 20px;
            color: var(--graphite-medium);
        }
        
        .no-messages i {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.3;
        }
        
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 8px 16px;
            background: white;
            border: 1px solid rgba(61, 61, 61, 0.1);
            border-radius: 16px;
            width: fit-content;
            margin-top: 8px;
        }
        
        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: var(--graphite-light);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-6px); }
        }
        
        @keyframes fadeInMessage {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Стили для списка задач (поп-ап окна) */
        .tasks-popup-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }
        
        .tasks-popup-content {
            background: white;
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            animation: popupSlideIn 0.3s ease;
        }
        
        @keyframes popupSlideIn {
            from { opacity: 0; transform: translateY(-20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .tasks-popup-header {
            padding: 20px;
            background: var(--aqua-gradient);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .tasks-popup-header h3 {
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .close-popup-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .tasks-popup-body {
            padding: 20px;
            max-height: calc(80vh - 80px);
            overflow-y: auto;
        }
        
        .task-quick-item {
            padding: 16px;
            border: 1px solid rgba(61, 61, 61, 0.08);
            border-radius: var(--radius);
            margin-bottom: 12px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .task-quick-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .task-quick-title {
            font-weight: 600;
            font-size: 1rem;
        }
        
        .task-quick-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .task-quick-info {
            color: var(--graphite-medium);
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .task-quick-date {
            color: var(--graphite-light);
            font-size: 0.8rem;
        }
        
        /* Кнопка для быстрого просмотра задач */
        .quick-tasks-btn {
            position: fixed;
            bottom: 80px;
            left: 20px;
            z-index: 1000;
            width: 50px;
            height: 50px;
            background: var(--aqua-gradient);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            animation: pulse 2s infinite;
        }
        
        /* Стили для страницы всех услуг */
        .all-services-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 45px;
            border: 1.5px solid rgba(61, 61, 61, 0.1);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--aqua-teal);
            box-shadow: 0 0 0 3px rgba(127, 224, 209, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--graphite-light);
        }

        .service-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid rgba(61, 61, 61, 0.1);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .filter-btn.active {
            background: var(--aqua-teal);
            color: white;
            border-color: var(--aqua-teal);
        }

        /* Стили для страницы гайдов */
        .guides-page .hero {
            background: linear-gradient(135deg, rgba(197, 168, 128, 0.1), rgba(127, 224, 209, 0.1));
        }
        
        /* Цвета статусов задач */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-new {
            background: rgba(25, 118, 210, 0.1);
            color: #1976D2;
        }
        
        .status-in_progress {
            background: rgba(255, 152, 0, 0.1);
            color: #EF6C00;
        }
        
        .status-completed {
            background: rgba(76, 175, 80, 0.1);
            color: #2E7D32;
        }
        
        .status-cancelled {
            background: rgba(229, 115, 115, 0.1);
            color: #C62828;
        }
        
        .status-searching {
            background: rgba(255, 193, 7, 0.1);
            color: #FF8F00;
        }
        
        .status-assigned {
            background: rgba(33, 150, 243, 0.1);
            color: #1565C0;
        }
        
        /* Кнопка просмотра на мобильных */
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        /* Кнопка фильтра с иконкой */
        .filter-btn i {
            margin-right: 6px;
        }

        /* Адаптивность для кнопок фильтра */
        @media (max-width: 768px) {
            .service-filters {
                overflow-x: auto;
                padding-bottom: 10px;
                margin-bottom: 15px;
            }
            
            .filter-btn {
                white-space: nowrap;
                flex-shrink: 0;
            }
        }

        /* Квадратные карточки категорий */
        .square-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            width: 100%;
        }

        .category-card-square {
            background: white;
            border-radius: var(--radius-lg);
            padding: 0;
            border: 1px solid rgba(61, 61, 61, 0.08);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            cursor: pointer;
            overflow: hidden;
            height: 280px;
            display: flex;
            flex-direction: column;
        }

        .category-card-square:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
        }

        .category-image-container {
            width: 100%;
            height: 160px;
            overflow: hidden;
            position: relative;
        }

        .category-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .category-card-square:hover .category-image-container img {
            transform: scale(1.05);
        }

        .category-icon-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(255, 255, 255, 0.95);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--aqua-teal);
            font-size: 1.2rem;
            box-shadow: var(--shadow-sm);
        }

        .category-content {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .category-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--graphite-dark);
            line-height: 1.3;
        }

        .category-description {
            font-size: 0.9rem;
            color: var(--graphite-medium);
            margin-bottom: 16px;
            line-height: 1.4;
            flex: 1;
        }

        .category-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }

        .services-count {
            font-size: 0.85rem;
            color: var(--graphite-light);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .select-service-btn {
            color: var(--aqua-teal);
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: var(--transition-fast);
        }

        .select-service-btn:hover {
            color: #6BD4C5;
        }

        /* Адаптивность для квадратной сетки */
        @media (max-width: 768px) {
            .square-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 15px;
            }
            
            .category-card-square {
                height: 240px;
            }
            
            .category-image-container {
                height: 130px;
            }
            
            .category-content {
                padding: 15px;
            }
            
            .category-title {
                font-size: 1rem;
                margin-bottom: 6px;
            }
            
            .category-description {
                font-size: 0.85rem;
                margin-bottom: 12px;
            }
        }

        @media (max-width: 480px) {
            .square-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 12px;
            }
            
            .category-card-square {
                height: 220px;
            }
            
            .category-image-container {
                height: 110px;
            }
            
            .category-content {
                padding: 12px;
            }
        }
        
        /* Стили для таблицы задач (только для десктопа) */
        @media (min-width: 769px) {
            .task-table-container {
                display: block;
                overflow-x: auto;
                margin-top: 20px;
            }
            
            .task-history-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 20px;
                display: table;
            }
            
            .task-history-table th {
                background: rgba(61, 61, 61, 0.05);
                padding: 12px;
                text-align: left;
                font-weight: 600;
                color: var(--graphite-dark);
                border-bottom: 2px solid rgba(61, 61, 61, 0.1);
            }
            
            .task-history-table td {
                padding: 12px;
                border-bottom: 1px solid rgba(61, 61, 61, 0.08);
                vertical-align: top;
            }
            
            .task-history-table tr:hover {
                background: rgba(61, 61, 61, 0.02);
            }
            
            .task-cards-container {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .task-table-container {
                display: none;
            }
            
            .task-cards-container {
                display: block;
            }
            
            .task-card {
                display: block;
                margin-bottom: 16px;
                padding: 16px;
                background: white;
                border-radius: var(--radius);
                border: 1px solid rgba(61, 61, 61, 0.08);
                box-shadow: var(--shadow-sm);
            }
            
            .task-card-row {
                display: flex;
                justify-content: space-between;
                margin-bottom: 8px;
                padding-bottom: 8px;
                border-bottom: 1px solid rgba(61, 61, 61, 0.05);
            }
            
            .task-card-label {
                font-size: 0.75rem;
                color: var(--graphite-medium);
                font-weight: 500;
            }
            
            .task-card-value {
                font-size: 0.9rem;
                color: var(--graphite-dark);
                font-weight: 500;
                text-align: right;
            }
            
            .task-card-actions {
                display: flex;
                gap: 8px;
                margin-top: 12px;
                justify-content: flex-end;
            }
        }

        /* Стили для продающей секции */
        .selling-section {
            margin: 40px 0;
            text-align: center;
        }

        .selling-video-placeholder {
            background: linear-gradient(135deg, var(--lavender-light), var(--aqua-light));
            border-radius: var(--radius-lg);
            padding: 60px 40px;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
        }

        .selling-video-placeholder i {
            font-size: 4rem;
            color: var(--lavender-purple);
            margin-bottom: 20px;
        }

        .selling-video-placeholder h3 {
            font-size: 1.8rem;
            color: var(--graphite-dark);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .selling-video-placeholder p {
            font-size: 1.1rem;
            color: var(--graphite-medium);
            max-width: 600px;
            margin: 0 auto 25px;
            line-height: 1.5;
        }

        .top-services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .top-service-card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(61, 61, 61, 0.08);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            height: 100%;
        }

        .top-service-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
        }

        .top-service-image {
            width: 100%;
            height: 140px;
            object-fit: cover;
            border-radius: var(--radius-sm);
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--pink-light), var(--soft-pink));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--lavender-purple);
            font-size: 3rem;
        }

        .top-service-card h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--graphite-dark);
        }

        .top-service-card p {
            color: var(--graphite-medium);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        /* Стили для поста с продающим текстом */
        .selling-post {
            background: white;
            border-radius: var(--radius-lg);
            padding: 40px;
            margin: 40px 0;
            box-shadow: var(--shadow);
        }

        .selling-post h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            font-weight: 600;
            color: var(--graphite-dark);
            margin-bottom: 20px;
            text-align: center;
        }

        .selling-post p {
            font-size: 1.1rem;
            line-height: 1.6;
            color: var(--graphite-medium);
            margin-bottom: 20px;
        }

        .selling-post ul {
            text-align: left;
            max-width: 600px;
            margin: 0 auto 30px;
        }

        .selling-post li {
            margin-bottom: 10px;
            color: var(--graphite-medium);
            font-size: 1.05rem;
        }

        .selling-post i {
            color: var(--aqua-teal);
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <!-- Верхняя навигация -->
    <nav class="top-nav">
        <a href="#" class="logo" onclick="navigateToPage('home')">
            <div class="logo-img" style="background: var(--aqua-gradient); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem; font-weight: bold;">
                WH
            </div>
            <span class="logo-woman">WOMAN</span>
            <span class="logo-help">HELP</span>
            <span class="logo-tagline">Решение есть</span>
        </a>
        
        <div class="user-avatar" id="userAvatar" onclick="toggleUserMenu()">
            <i class="fas fa-user"></i>
        </div>
        
        <!-- Меню пользователя -->
        <div class="user-menu" id="userMenu">
            <div style="padding: 10px; border-bottom: 1px solid rgba(61, 61, 61, 0.1);">
                <div style="font-weight: 600;" id="menuUserName">Гость</div>
                <div style="font-size: 0.9rem; color: var(--graphite-medium);" id="menuUserEmail"></div>
            </div>
            <div style="padding: 5px 0;">
                <a href="#" class="nav-menu-item" onclick="navigateToPage('profile')">
                    <i class="fas fa-user"></i>Профиль
                </a>
                <a href="#" class="nav-menu-item" onclick="showTasksPopup()">
                    <i class="fas fa-tasks"></i>Мои задачи
                </a>
                <a href="#" class="nav-menu-item" onclick="navigateToPage('guides')">
                    <i class="fas fa-book"></i>Гайды
                </a>
                <a href="#" class="nav-menu-item" onclick="navigateToPage('all-services')">
                    <i class="fas fa-list"></i>Все услуги
                </a>
                <a href="#" class="nav-menu-item" onclick="navigateToPerformerPanel()" id="performerPanelLink" style="display: none;">
                    <i class="fas fa-user-tie"></i>Панель исполнителя
                </a>
                <a href="#" class="nav-menu-item" onclick="showLoginModal()" id="loginMenuBtn">
                    <i class="fas fa-sign-in-alt"></i>Войти
                </a>
                <a href="#" class="nav-menu-item" onclick="logout()" id="logoutMenuBtn" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i>Выйти
                </a>
            </div>
        </div>
    </nav>
    
    <!-- Основной контент (страницы) -->
    <main>
        <!-- Экран авторизации (только для неавторизованных) -->
        <div id="auth-page" class="page active">
            <div class="container auth-screen">
                <div class="auth-content">
                    <div class="card auth-card">
                        <div class="logo" style="justify-content: center; margin-bottom: 20px;">
                            <div style="height: 60px; width: 60px; background: var(--aqua-gradient); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.8rem; font-weight: bold; margin-right: 15px;">
                                WH
                            </div>
                            <div style="text-align: left;">
                                <div style="font-family: 'Playfair Display', serif; font-size: 2.5rem; font-weight: 700; color: var(--graphite-dark); line-height: 1;">
                                    <span>WOMAN</span>
                                    <span style="color: var(--primary-gold);">HELP</span>
                                </div>
                                <div style="font-size: 1.2rem; color: var(--aqua-teal); font-weight: 600; margin-top: 5px;">
                                    Решение есть
                                </div>
                            </div>
                        </div>
                        <p class="section-subtitle">Премиум сервис помощи для женщин. Оставляйте бытовые задачи профессионалам и наслаждайтесь свободным временем.</p>
                        
                        <div class="auth-actions">
                            <button class="btn btn-primary" onclick="showRegisterModal()">
                                <i class="fas fa-user-plus"></i>
                                Зарегистрироваться
                            </button>
                            <button class="btn btn-white" onclick="showLoginModal()">
                                <i class="fas fa-sign-in-alt"></i>
                                Войти в систему
                            </button>
                            <button class="btn btn-secondary support-btn" onclick="showHelp()">
                                <i class="fas fa-headset"></i>
                                Поддержка
                            </button>
                        </div>

                        <!-- Место для рекламных записей -->
                        <div class="promo-banner" style="margin-top: 30px;">
                            <h3>Присоединяйтесь к нашему сообществу!</h3>
                            <p>Уже более 10,000 довольных клиентов доверили нам свои задачи</p>
                            <button class="btn btn-white" onclick="showRegisterModal()">
                                <i class="fas fa-star"></i>
                                Начать сейчас
                            </button>
                        </div>

                        <!-- Статистика сервиса -->
                        <div class="service-stats">
                            <h3 style="text-align: center; margin-bottom: 30px;">Наши достижения</h3>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-number" id="usersCount">10,000+</div>
                                    <div class="stat-title">Пользователей</div>
                                    <div class="stat-description">Доверяют нам свои задачи</div>
                                    <div class="stat-counter">+12 на этой неделе</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="tasksCount">25,000+</div>
                                    <div class="stat-title">Выполненных задач</div>
                                    <div class="stat-description">Успешно завершено</div>
                                    <div class="stat-counter">+47 на этой неделе</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="hoursCount">50,000+</div>
                                    <div class="stat-title">Часов экономии</div>
                                    <div class="stat-description">Сэкономлено времени</div>
                                    <div class="stat-counter">+124 на этой неделе</div>
                                </div>
                            </div>
                        </div>

                        <!-- Пост с продающим текстом/видео -->
                        <div class="selling-post">
                            <h2>Почему выбирают WOMAN HELP?</h2>
                            <p>Мы создали сервис, который действительно понимает потребности современных женщин. Это не просто помощь по дому - это возможность освободить время для того, что действительно важно.</p>
                            
                            <div class="selling-video-placeholder">
                                <i class="fas fa-play-circle"></i>
                                <h3>Посмотрите, как это работает</h3>
                                <p>Узнайте за 2 минуты, как WOMAN HELP меняет жизнь тысяч женщин</p>
                                <button class="btn btn-primary" onclick="showRegisterModal()">
                                    <i class="fas fa-play"></i>
                                    Смотреть видео
                                </button>
                            </div>

                            <p>Наши клиенты получают не просто услуги, а полное решение бытовых вопросов:</p>
                            <ul>
                                <li><i class="fas fa-check"></i> Профессиональные помощницы с проверенной репутацией</li>
                                <li><i class="fas fa-check"></i> Гарантия качества выполнения всех задач</li>
                                <li><i class="fas fa-check"></i> Безопасность и конфиденциальность</li>
                                <li><i class="fas fa-check"></i> Гибкие подписки под разные потребности</li>
                                <li><i class="fas fa-check"></i> Поддержка 24/7 и персональный менеджер</li>
                            </ul>
                        </div>

                        <!-- Топ категории услуг -->
                        <div class="selling-section">
                            <h2 class="section-title">Популярные услуги</h2>
                            <p class="section-subtitle">Топ-3 самых востребованных категорий среди наших клиенток</p>
                            
                            <div class="top-services-grid">
                                <div class="top-service-card">
                                    <div class="top-service-image" style="background: linear-gradient(135deg, #FFE8F2, #FFD1E8);">
                                        <i class="fas fa-tshirt"></i>
                                    </div>
                                    <h4>Глажка белья</h4>
                                    <p>Аккуратная глажка вещей с учетом требований к тканям. Профессиональный подход к каждому изделию.</p>
                                    <span class="service-price"><i class="fas fa-crown"></i> Включено в подписку</span>
                                </div>
                                
                                <div class="top-service-card">
                                    <div class="top-service-image" style="background: linear-gradient(135deg, #E8F5FF, #D1EBFF);">
                                        <i class="fas fa-utensils"></i>
                                    </div>
                                    <h4>Приготовление еды</h4>
                                    <p>Приготовление здоровой и вкусной пищи по вашим рецептам или нашим рекомендациям.</p>
                                    <span class="service-price"><i class="fas fa-crown"></i> Включено в подписку</span>
                                </div>
                                
                                <div class="top-service-card">
                                    <div class="top-service-image" style="background: linear-gradient(135deg, #F0FFE8, #E0FFD1);">
                                        <i class="fas fa-paw"></i>
                                    </div>
                                    <h4>Услуги грумера</h4>
                                    <p>Профессиональный уход за питомцами: стрижка, купание, уход за шерстью и когтями.</p>
                                    <span class="service-price"><i class="fas fa-crown"></i> Включено в подписку</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Остальной HTML код остается таким же, как в оригинале, только меняем цвета в соответствующих местах -->
        <!-- Я оставлю структуру точно такой же, но заменю только цвета в HTML где нужно -->
        
        <!-- Экран подписки (для авторизованных без активной подписки) -->
        <div id="subscription-required-page" class="page">
            <div class="container auth-screen">
                <div class="auth-content">
                    <div class="card auth-card">
                        <i class="fas fa-crown auth-icon" style="color: var(--primary-gold);"></i>
                        <h2 class="section-title">Требуется подписка</h2>
                        <p class="section-subtitle">Для доступа ко всем возможностям сервиса необходимо активировать подписку</p>
                        
                        <div class="mb-20" style="text-align: left; background: rgba(127, 224, 209, 0.05); padding: 16px; border-radius: var(--radius);">
                            <p style="margin-bottom: 10px;"><i class="fas fa-check" style="color: var(--aqua-teal); margin-right: 8px;"></i> Неограниченное создание задач</p>
                            <p style="margin-bottom: 10px;"><i class="fas fa-check" style="color: var(--aqua-teal); margin-right: 8px;"></i> Доступ ко всем категориям услуг</p>
                            <p style="margin-bottom: 10px;"><i class="fas fa-check" style="color: var(--aqua-teal); margin-right: 8px;"></i> Личный помощник 24/7</p>
                            <p><i class="fas fa-check" style="color: var(--aqua-teal); margin-right: 8px;"></i> Гарантия качества услуг</p>
                        </div>
                        
                        <div class="auth-actions">
                            <button class="btn btn-primary" onclick="navigateToPage('subscription')">
                                <i class="fas fa-crown"></i>
                                Выбрать подписку
                            </button>
                            <button class="btn btn-secondary" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i>
                                Выйти из системы
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Главная страница (только для авторизованных с активной подпиской) -->
        <div id="home-page" class="page">
            <div class="container">
                <!-- Hero секция -->
                <section class="hero">
                    <div class="hero-content">
                        <h1>WOMAN HELP</h1>
                        <div class="tagline">Решение есть</div>
                        <p>Премиум сервис помощи для женщин. Оставляйте бытовые задачи профессионалам и наслаждайтесь свободным временем.</p>
                        <div class="hero-actions">
                            <button class="btn btn-primary" onclick="checkSubscription()">
                                <i class="fas fa-plus-circle"></i>
                                Создать задачу
                            </button>
                            <button class="btn btn-white" onclick="navigateToPage('all-services')">
                                <i class="fas fa-list"></i>
                                Все услуги
                            </button>
                            <button class="btn guides-btn" onclick="navigateToPage('guides')">
                                <i class="fas fa-book"></i>
                                Гайды
                            </button>
                        </div>
                    </div>
                </section>
                
                <!-- Популярные категории -->
                <section class="section">
                    <h2 class="section-title">Популярные категории</h2>
                    <p class="section-subtitle">Выберите категорию для создания задачи</p>
                    
                    <div class="grid grid-2" id="categoriesGrid">
                        <div class="loader" style="grid-column: 1 / -1; text-align: center;">
                            <div class="spinner"></div>
                            <p>Загрузка категорий...</p>
                        </div>
                    </div>
                </section>
                
                <!-- Топ услуг -->
                <section class="section">
                    <div class="d-flex justify-between align-center mb-20">
                        <h2 class="section-title">Топ услуг</h2>
                        <button class="view-all-btn" onclick="navigateToPage('all-services')">
                            <i class="fas fa-arrow-right"></i>
                            Все услуги
                        </button>
                    </div>
                    
                    <div class="grid grid-3" id="topServicesGrid">
                        <!-- Топ услуги загружаются динамически -->
                    </div>
                </section>
                
                <!-- Статистика пользователя -->
                <section class="section">
                    <div class="card">
                        <h2 class="section-title">Ваша статистика</h2>
                        <div class="profile-stats" id="homeStats">
                            <div class="stat-item">
                                <div class="stat-value" id="statTasksHome">0</div>
                                <div class="stat-label">Создано задач</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="statAvailableHome">0</div>
                                <div class="stat-label">Доступно задач</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="statCompletedHome">0</div>
                                <div class="stat-label">Выполнено</div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        
        <!-- Остальные страницы остаются без изменений в структуре, только цвета обновлены в стилях -->
        <!-- Все остальные div с классами page остаются как в оригинале -->
        
        <!-- Страница всех услуг -->
        <div id="all-services-page" class="page">
            <div class="container">
                <section class="section">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                        <button class="btn btn-secondary" onclick="navigateToPage('home')" style="padding: 8px 16px;">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h2 class="section-title" id="servicesPageTitle">Все услуги</h2>
                    </div>
                    
                    <div class="all-services-header">
                        <div class="search-box">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" id="serviceSearch" class="search-input" placeholder="Поиск услуг..." oninput="filterServices()">
                        </div>
                        <div>
                            <button class="guides-btn" onclick="navigateToPage('guides')">
                                <i class="fas fa-book"></i>
                                Гайды
                            </button>
                        </div>
                    </div>
                    
                    <!-- Контейнер для категорий или услуг -->
                    <div class="square-grid" id="allServicesList">
                        <!-- Сначала показываются категории, при клике - услуги -->
                    </div>
                    
                    <!-- Кнопка "Назад к категориям" показывается только при просмотре услуг -->
                    <div style="text-align: center; margin-top: 30px; display: none;" id="backToCategoriesBtn">
                        <button class="btn btn-secondary" onclick="loadAllServicesPage()">
                            <i class="fas fa-arrow-left"></i>
                            Назад ко всем категориям
                        </button>
                    </div>
                </section>
            </div>
        </div>
        
        <!-- Страница гайдов -->
        <div id="guides-page" class="page">
            <div class="container">
                <section class="section">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                        <button class="btn btn-secondary" onclick="navigateToPage('home')" style="padding: 8px 16px;">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h2 class="section-title">Гайды и инструкции</h2>
                    </div>
                    
                    <div class="hero" style="margin-bottom: 40px;">
                        <div class="hero-content">
                            <h1>Библиотека знаний</h1>
                            <p>Полезные руководства и советы по эффективному использованию сервиса</p>
                        </div>
                    </div>
                    
                    <div class="guides-grid" id="guidesList">
                        <div class="guide-card" onclick="showGuide('getting-started')">
                            <i class="fas fa-play-circle guide-icon"></i>
                            <h3>Начало работы</h3>
                            <p>Пошаговое руководство по созданию первой задачи и работе с исполнителями</p>
                            <div style="color: var(--graphite-light); font-size: 0.9rem;">
                                <i class="far fa-clock"></i> 5 мин чтения
                            </div>
                        </div>
                        
                        <div class="guide-card" onclick="showGuide('tips')">
                            <i class="fas fa-lightbulb guide-icon"></i>
                            <h3>Советы по задачам</h3>
                            <p>Как правильно описать задачу, чтобы получить лучший результат</p>
                            <div style="color: var(--graphite-light); font-size: 0.9rem;">
                                <i class="far fa-clock"></i> 7 мин чтения
                            </div>
                        </div>
                        
                        <div class="guide-card" onclick="showGuide('safety')">
                            <i class="fas fa-shield-alt guide-icon"></i>
                            <h3>Безопасность</h3>
                            <p>Правила безопасности при работе с исполнителями и передаче доступа</p>
                            <div style="color: var(--graphite-light); font-size: 0.9rem;">
                                <i class="far fa-clock"></i> 10 мин чтения
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        
        <!-- Страница создания задачи -->
        <div id="create-task-page" class="page">
            <div class="container">
                <section class="section">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                        <button class="btn btn-secondary" onclick="cancelTask()" style="padding: 8px 16px;">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h2 class="section-title">Создание задачи</h2>
                    </div>
                    
                    <div class="card">
                        <form id="createTaskForm" class="create-task-form">
                            <div class="form-group">
                                <label class="form-label">Категория</label>
                                <div class="form-input" style="background: #f9f9f9; padding: 12px; border-radius: var(--radius-sm);" id="selectedCategoryDisplay">
                                    Не выбрана
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Услуга</label>
                                <div class="form-input" style="background: #f9f9f9; padding: 12px; border-radius: var(--radius-sm);" id="selectedServiceDisplay">
                                    Не выбрана
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="taskTitle">Название задачи *</label>
                                <input type="text" id="taskTitle" class="form-input" placeholder="Например: Уборка 2-комнатной квартиры" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="taskDescription">Подробное описание *</label>
                                <textarea id="taskDescription" class="form-input" rows="4" placeholder="Опишите детали задачи..." required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="taskAddress">Адрес *</label>
                                <input type="text" id="taskAddress" class="form-input" placeholder="Где нужно выполнить задачу" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="taskDeadline">Срок выполнения *</label>
                                <input type="date" id="taskDeadline" class="form-input" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="taskContact">Контакт для связи *</label>
                                <input type="text" id="taskContact" class="form-input" placeholder="Телефон или Telegram" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="additionalRequirements">Дополнительные требования</label>
                                <textarea id="additionalRequirements" class="form-input" rows="2" placeholder="Любые дополнительные пожелания..."></textarea>
                            </div>
                            
                            <div style="display: flex; gap: 12px; margin-top: 30px;">
                                <button type="button" class="btn btn-secondary" onclick="cancelTask()" style="flex: 1;">
                                    Отмена
                                </button>
                                <button type="submit" class="btn btn-primary" style="flex: 1;">
                                    Создать задачу
                                </button>
                            </div>
                        </form>
                    </div>
                </section>
            </div>
        </div>
        
        <!-- Страница задач пользователя -->
        <div id="tasks-page" class="page">
            <div class="container">
                <section class="section">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                        <button class="btn btn-secondary" onclick="navigateToPage('home')" style="padding: 8px 16px;">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h2 class="section-title">Мои задачи</h2>
                    </div>
                    
                    <!-- Табы -->
                    <div class="tabs" id="tasksTabs">
                        <div class="tab active" onclick="filterTasks('all')">Все</div>
                        <div class="tab" onclick="filterTasks('new')">Новые</div>
                        <div class="tab" onclick="filterTasks('in_progress')">В работе</div>
                        <div class="tab" onclick="filterTasks('completed')">Завершенные</div>
                    </div>
                    
                    <!-- Контейнер для карточек задач (для мобильных) -->
                    <div class="task-cards-container" id="userTasksCards">
                        <!-- Карточки задач загружаются динамически -->
                    </div>
                    
                    <!-- Контейнер для таблицы задач (для десктопа) -->
                    <div class="task-table-container" id="userTasksTable">
                        <!-- Таблица задач загружается динамически -->
                    </div>
                </section>
            </div>
        </div>
        
        <!-- Страница деталей задачи -->
        <div id="task-details-page" class="page">
            <div class="container">
                <section class="section">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                        <button class="btn btn-secondary" onclick="navigateToPage('tasks')" style="padding: 8px 16px;">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h2 class="section-title">Детали задачи</h2>
                    </div>
                    
                    <!-- Компактные детали задачи -->
                    <div class="card" style="margin-bottom: 20px;">
                        <div id="taskCompactDetails">
                            <!-- Детали задачи загружаются динамически -->
                        </div>
                    </div>
                    
                    <!-- Чат встроен прямо на странице -->
                    <div class="card" id="taskChatSection" style="display: none;">
                        <div class="chat-header" style="padding: 16px; border-bottom: 1px solid rgba(61,61,61,0.08);">
                            <h3 style="margin: 0; font-size: 1.1rem; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-comments"></i>
                                <span id="chatHeaderTitle">Чат по задаче</span>
                            </h3>
                        </div>
                        
                        <div class="chat-messages-container" id="inlineChatMessages" 
                             style="height: 300px; padding: 16px; overflow-y: auto;">
                            <!-- Сообщения чата -->
                        </div>
                        
                        <div class="chat-input-area" style="padding: 16px; border-top: 1px solid rgba(61,61,61,0.08);">
                            <textarea id="inlineChatMessage" placeholder="Введите сообщение..." 
                                     style="flex: 1; padding: 12px; border: 1px solid rgba(61,61,61,0.1); border-radius: 20px; font-family: 'Inter', sans-serif; min-height: 44px; resize: none;"></textarea>
                            <button onclick="sendInlineChatMessage()" style="background: var(--aqua-teal); color: white; border: none; width: 44px; height: 44px; border-radius: 50%; margin-left: 10px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        
        <!-- Страница профиля -->
        <div id="profile-page" class="page">
            <div class="container">
                <!-- Шапка профиля - уменьшенная и белая -->
                <div class="card" style="margin-bottom: 20px; padding: 20px; background: white;">
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <div class="profile-avatar" id="profileAvatar" style="width: 80px; height: 80px; font-size: 2rem;">
                            <i class="fas fa-user"></i>
                        </div>
                        <div style="flex: 1;">
                            <div class="profile-name" id="profileName" style="font-size: 1.5rem;">Гость</div>
                            <div class="profile-email" id="profileEmail" style="font-size: 0.9rem;">Войдите в аккаунт</div>
                        </div>
                    </div>
                    
                    <div class="profile-stats" id="profileStats" style="margin-top: 20px; grid-template-columns: repeat(3, 1fr);">
                        <div class="stat-item" style="background: rgba(61, 61, 61, 0.05);">
                            <div class="stat-value" id="statTasks">0</div>
                            <div class="stat-label">Задач</div>
                        </div>
                        <div class="stat-item" style="background: rgba(61, 61, 61, 0.05);">
                            <div class="stat-value" id="statRating">0</div>
                            <div class="stat-label">Рейтинг</div>
                        </div>
                        <div class="stat-item" style="background: rgba(61, 61, 61, 0.05);">
                            <div class="stat-value" id="statBalance">0₽</div>
                            <div class="stat-label">Баланс</div>
                        </div>
                    </div>
                </div>
                
                <!-- Подписка -->
                <section class="section">
                    <h2 class="section-title">Подписка</h2>
                    <div class="card" id="profileSubscriptionCard">
                        <div class="empty-state">
                            <i class="fas fa-crown empty-state-icon"></i>
                            <h3 class="empty-state-title">Подписка не активна</h3>
                            <p class="empty-state-description">Активируйте подписку для доступа ко всем возможностям</p>
                            <button class="btn btn-primary" onclick="navigateToPage('subscription')">
                                <i class="fas fa-crown"></i>
                                Активировать подписку
                            </button>
                        </div>
                    </div>
                </section>
                
                <!-- Мои задачи -->
                <section class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 class="section-title">Последние задачи</h2>
                        <button class="btn btn-secondary" onclick="navigateToPage('tasks')" style="padding: 8px 16px;">
                            <i class="fas fa-list"></i>
                            Все задачи
                        </button>
                    </div>
                    <div class="task-list" id="profileTasksList">
                        <div class="empty-state">
                            <i class="fas fa-tasks empty-state-icon"></i>
                            <h3 class="empty-state-title">Задач пока нет</h3>
                            <p class="empty-state-description">Создайте свою первую задачу</p>
                        </div>
                    </div>
                </section>
                
                <!-- Настройки профиля -->
                <section class="section">
                    <h2 class="section-title">Настройки</h2>
                    <div class="card">
                        <div style="padding: 10px 0;">
                            <a href="#" class="nav-menu-item" onclick="navigateToPage('subscription')" style="display: block; padding: 12px; text-decoration: none; color: var(--graphite-dark); border-radius: var(--radius-sm); transition: var(--transition-fast); margin-bottom: 8px;">
                                <i class="fas fa-crown" style="margin-right: 12px; color: var(--primary-gold);"></i>Управление подпиской
                            </a>
                            <a href="#" class="nav-menu-item" onclick="openSendCodeModal()" style="display: block; padding: 12px; text-decoration: none; color: var(--graphite-dark); border-radius: var(--radius-sm); transition: var(--transition-fast); margin-bottom: 8px;">
                                <i class="fas fa-mobile-alt" style="margin-right: 12px; color: var(--aqua-teal);"></i>Подтвердить телефон
                            </a>
                            <a href="#" class="nav-menu-item" onclick="navigateToPage('guides')" style="display: block; padding: 12px; text-decoration: none; color: var(--graphite-dark); border-radius: var(--radius-sm); transition: var(--transition-fast); margin-bottom: 8px;">
                                <i class="fas fa-book" style="margin-right: 12px; color: var(--lavender-purple);"></i>Гайды
                            </a>
                            <a href="#" class="nav-menu-item" onclick="navigateToPage('all-services')" style="display: block; padding: 12px; text-decoration: none; color: var(--graphite-dark); border-radius: var(--radius-sm); transition: var(--transition-fast); margin-bottom: 8px;">
                                <i class="fas fa-list" style="margin-right: 12px; color: var(--aqua-teal);"></i>Все услуги
                            </a>
                            <a href="#" class="nav-menu-item" onclick="showHelp()" style="display: block; padding: 12px; text-decoration: none; color: var(--graphite-dark); border-radius: var(--radius-sm); transition: var(--transition-fast); margin-bottom: 8px;">
                                <i class="fas fa-question-circle" style="margin-right: 12px; color: var(--primary-gold);"></i>Помощь и поддержка
                            </a>
                            <a href="#" class="nav-menu-item" onclick="logout()" style="display: block; padding: 12px; text-decoration: none; color: var(--graphite-dark); border-radius: var(--radius-sm); transition: var(--transition-fast);">
                                <i class="fas fa-sign-out-alt" style="margin-right: 12px; color: var(--error);"></i>Выйти из системы
                            </a>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        
        <!-- Страница подписок -->
        <div id="subscription-page" class="page">
            <div class="container subscription-screen">
                <div class="subscription-content">
                    <div class="card" style="padding: 40px 20px;">
                        <div style="text-align: center; margin-bottom: 30px;">
                            <i class="fas fa-crown" style="font-size: 3.5rem; color: var(--primary-gold); margin-bottom: 20px;"></i>
                            <h2 class="section-title">Выберите подписку</h2>
                            <p class="section-subtitle">Для создания задач необходимо активировать подписку</p>
                        </div>
                        
                        <div class="grid grid-2" id="subscriptionSelection">
                            <!-- Подписки загружаются динамически -->
                        </div>
                        
                        <div style="text-align: center; margin-top: 30px;">
                            <p style="color: var(--graphite-medium); font-size: 0.9rem;">
                                <i class="fas fa-info-circle"></i> Все услуги включены в подписку, дополнительная оплата не требуется
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Нижняя навигация (только для авторизованных с активной подпиской) -->
    <nav class="bottom-nav" id="bottomNav" style="display: none;">
        <a href="#" class="nav-item active" onclick="navigateToPage('home')" data-page="home">
            <i class="fas fa-home"></i>
            <span>Главная</span>
        </a>
        <a href="#" class="nav-item" onclick="navigateToPage('all-services')" data-page="all-services">
            <i class="fas fa-list"></i>
            <span>Услуги</span>
        </a>
        <a href="#" class="nav-item" onclick="showTasksPopup()" id="quickTasksBtn">
            <i class="fas fa-tasks"></i>
            <span>Задачи</span>
        </a>
        <a href="#" class="nav-item" onclick="navigateToPage('profile')" data-page="profile">
            <i class="fas fa-user"></i>
            <span>Профиль</span>
        </a>
    </nav>
    
    <!-- Кнопка быстрого просмотра задач -->
    <a href="#" class="quick-tasks-btn" onclick="showTasksPopup()" id="floatingTasksBtn" style="display: none;">
        <i class="fas fa-tasks"></i>
    </a>
    
    <!-- Кнопка админ-панели -->
    <a href="/admin.html" class="admin-access-btn" id="adminAccessBtn" style="display: none;">
        <i class="fas fa-crown"></i>
    </a>
    
    <!-- Кнопка панели исполнителя -->
    <a href="/performer.html" class="performer-access-btn" id="performerAccessBtn" style="display: none;">
        <i class="fas fa-user-tie"></i>
    </a>
    
    <!-- Поп-ап окно со списком задач -->
    <div class="tasks-popup-modal" id="tasksPopupModal" style="display: none;">
        <div class="tasks-popup-content">
            <div class="tasks-popup-header">
                <h3>Мои задачи</h3>
                <button class="close-popup-btn" onclick="closeTasksPopup()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="tasks-popup-body">
                <div id="popupTasksList">
                    <!-- Задачи загружаются динамически -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Модальные окна -->
    
    <!-- Модалка входа -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <h3 class="modal-title">Вход в аккаунт</h3>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Телефон или Email</label>
                    <input type="text" id="loginPhoneInput" class="form-input" placeholder="+79991234567 или ваш@email.com" required>
                    <small style="color: var(--graphite-light); font-size: 0.8rem;">Введите телефон или email, указанные при регистрации</small>
                </div>
                <div class="form-group">
                    <label class="form-label">Пароль</label>
                    <input type="password" id="loginPasswordInput" class="form-input" placeholder="Ваш пароль" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">
                    Войти
                </button>
            </form>
            <div style="text-align: center; margin-top: 20px;">
                <p style="color: var(--graphite-medium); font-size: 0.9rem;">Нет аккаунта? 
                    <a href="#" onclick="showRegisterModal()" style="color: var(--aqua-teal); text-decoration: none; font-weight: 600;">Зарегистрироваться</a>
                </p>
            </div>
        </div>
    </div>
    
    <!-- Модалка регистрации -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <h3 class="modal-title">Регистрация</h3>
            <form id="registerForm">
                <div class="form-group">
                    <label class="form-label">Имя *</label>
                    <input type="text" id="registerFirstName" class="form-input" placeholder="Ваше имя" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Фамилия (необязательно)</label>
                    <input type="text" id="registerLastName" class="form-input" placeholder="Ваша фамилия">
                </div>
                <div class="form-group">
                    <label class="form-label">Телефон *</label>
                    <input type="tel" id="registerPhone" class="form-input" placeholder="+7 (999) 123-45-67" required>
                    <small style="color: var(--graphite-light); font-size: 0.8rem;">Телефон будет использоваться для входа</small>
                </div>
                <div class="form-group">
                    <label class="form-label">Email (необязательно)</label>
                    <input type="email" id="registerEmail" class="form-input" placeholder="ваш@email.com">
                    <small style="color: var(--graphite-light); font-size: 0.8rem;">Для восстановления пароля и уведомлений</small>
                </div>
                <div class="form-group">
                    <label class="form-label">Пароль *</label>
                    <input type="password" id="registerPassword" class="form-input" placeholder="Не менее 6 символов" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">
                    Зарегистрироваться
                </button>
            </form>
        </div>
    </div>

    <!-- Модалка подтверждения телефона (SMS код) -->
    <div class="modal" id="verifyPhoneModal">
        <div class="modal-content">
            <h3 class="modal-title">Подтверждение телефона</h3>
            <div id="verifyPhoneContent">
                <p style="color: var(--graphite-medium); margin-bottom: 20px;">
                    Для активации подписки необходимо подтвердить ваш номер телефона
                </p>
                <div class="form-group">
                    <label class="form-label">Номер телефона</label>
                    <input type="text" id="verifyPhoneNumber" class="form-input" readonly style="background: #f5f5f5;">
                </div>
                <div class="form-group">
                    <label class="form-label">Код из SMS</label>
                    <input type="text" id="verifyPhoneCode" class="form-input" placeholder="Введите 6-значный код" maxlength="6" pattern="[0-9]*" inputmode="numeric">
                </div>
                <button type="button" class="btn btn-primary" onclick="verifyPhoneCode()" style="width: 100%; margin-top: 10px;">
                    Подтвердить
                </button>
                <button type="button" class="btn btn-secondary" onclick="sendVerificationCode()" style="width: 100%; margin-top: 10px;">
                    <i class="fas fa-redo"></i> Отправить код еще раз
                </button>
                <div style="text-align: center; margin-top: 20px;">
                    <p style="color: var(--graphite-medium); font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> Код действителен 10 минут
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Модалка отправки кода -->
    <div class="modal" id="sendCodeModal">
        <div class="modal-content">
            <h3 class="modal-title">Отправка кода подтверждения</h3>
            <div id="sendCodeContent">
                <p style="color: var(--graphite-medium); margin-bottom: 20px;">
                    Введите ваш номер телефона для получения кода подтверждения
                </p>
                <div class="form-group">
                    <label class="form-label">Номер телефона</label>
                    <input type="tel" id="sendCodePhone" class="form-input" placeholder="+7 (999) 123-45-67">
                    <small style="color: var(--graphite-light); font-size: 0.8rem;">Укажите телефон, который использовался при регистрации</small>
                </div>
                <button type="button" class="btn btn-primary" onclick="sendVerificationCode(true)" style="width: 100%; margin-top: 10px;">
                    Отправить код
                </button>
                <div style="text-align: center; margin-top: 20px;">
                    <p style="color: var(--graphite-medium); font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> Код придет в течение минуты
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Весь JavaScript код остается БЕЗ ИЗМЕНЕНИЙ -->
    <!-- Вставляем оригинальный JavaScript код здесь -->
    
<script>
        // ==================== ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ====================
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let currentToken = localStorage.getItem('token') || null;
        let categories = [];
        let services = [];
        let allServices = [];
        let subscriptions = [];
        let userTasks = [];
        let selectedCategory = null;
        let selectedService = null;
        let currentTaskFilter = 'all';
        let currentChatTaskId = null;
        let chatMessages = [];
        let chatPollingInterval = null;
        
        // API базовый URL
        const API_BASE_URL = window.location.origin;
        
        // Статистика сервиса
        let serviceStats = {
            users: 10000,
            tasks: 25000,
            hours: 50000,
            usersWeekly: 12,
            tasksWeekly: 47,
            hoursWeekly: 124
        };
        
        // ==================== ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ====================
        
        // Функция для авторизованных запросов
        async function fetchWithAuth(url, options = {}) {
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers
            };
            
            if (currentToken) {
                headers['Authorization'] = `Bearer ${currentToken}`;
            }
            
            try {
                const response = await fetch(url, {
                    ...options,
                    headers
                });
                
                // Если токен устарел
                if (response.status === 401) {
                    console.log('Токен истек, перенаправляем на авторизацию');
                    localStorage.removeItem('token');
                    localStorage.removeItem('currentUser');
                    currentToken = null;
                    currentUser = null;
                    showNotification('Сессия истекла. Войдите снова.', 'error');
                    
                    setTimeout(() => {
                        navigateToPage('auth');
                    }, 1000);
                    
                    return response;
                }
                
                return response;
            } catch (error) {
                console.error('Ошибка запроса:', error);
                showNotification('Ошибка соединения с сервером', 'error');
                throw error;
            }
        }
        
        // Анимация счетчиков
        function animateCounters() {
            const usersCount = document.getElementById('usersCount');
            const tasksCount = document.getElementById('tasksCount');
            const hoursCount = document.getElementById('hoursCount');
            
            if (usersCount) {
                animateCounter(usersCount, serviceStats.users, 2000);
            }
            if (tasksCount) {
                animateCounter(tasksCount, serviceStats.tasks, 2000);
            }
            if (hoursCount) {
                animateCounter(hoursCount, serviceStats.hours, 2000);
            }
        }
        
        function animateCounter(element, target, duration) {
            const start = 0;
            const increment = target / (duration / 16);
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(current).toLocaleString() + '+';
            }, 16);
        }
        
        // Загрузка логотипа
        async function loadLogo() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/logo`);
                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.data.logo_url) {
                        const logoImg = document.getElementById('logoImg');
                        const authLogoImg = document.getElementById('authLogoImg');
                        if (logoImg) logoImg.src = result.data.logo_url;
                        if (authLogoImg) authLogoImg.src = result.data.logo_url;
                    }
                }
            } catch (error) {
                console.log('Используется логотип по умолчанию');
            }
        }
        
        // Определение начального экрана
        function determineInitialScreen() {
            console.log('📱 Определение начального экрана...');
            
            const storedUser = localStorage.getItem('currentUser');
            const storedToken = localStorage.getItem('token');
            
            if (storedUser && storedToken) {
                try {
                    currentUser = JSON.parse(storedUser);
                    currentToken = storedToken;
                    
                    console.log('✅ Найден сохраненный пользователь:', currentUser.phone);
                    
                    if (!currentUser.phone_verified) {
                        console.log('📱 Телефон не подтвержден, показываем окно подтверждения');
                        openVerifyPhoneModal(currentUser.phone);
                        navigateToPage('auth');
                        return;
                    }
                    
                    if (currentUser.subscription_status !== 'active' || !currentUser.initial_fee_paid) {
                        console.log('📱 Подписка не активна, показываем выбор подписки');
                        navigateToPage('subscription');
                        return;
                    }
                    
                    console.log('✅ Все проверки пройдены, показываем главную');
                    navigateToPage('home');
                    
                } catch (error) {
                    console.error('Ошибка парсинга пользователя:', error);
                    localStorage.clear();
                    navigateToPage('auth');
                }
            } else {
                console.log('👋 Новый пользователь, показываем авторизацию');
                navigateToPage('auth');
            }
        }
        
        // Установка обработчиков событий
        function setupEventListeners() {
            // Форма входа
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    await login();
                });
            }

            // Автоформатирование телефона
            const phoneInputs = document.querySelectorAll('input[type="tel"], input[id*="Phone"]:not([id*="Code"]), input[placeholder*="телефон"], input[placeholder*="телефона"]');
            phoneInputs.forEach(input => {
                if (input.id.includes('Code') || input.placeholder.includes('код')) {
                    return;
                }
                
                input.addEventListener('input', function(e) {
                    formatPhoneInput(this);
                });
                
                input.addEventListener('blur', function(e) {
                    if (this.value && !this.value.startsWith('+')) {
                        this.value = normalizePhone(this.value);
                    }
                });
            });
            
            // Форма регистрации
            const registerForm = document.getElementById('registerForm');
            if (registerForm) {
                registerForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    await register();
                });
            }
            
            // Форма создания задачи
            const taskForm = document.getElementById('createTaskForm');
            if (taskForm) {
                taskForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    await createTask();
                });
            }
            
            // Поиск услуг
            const searchInput = document.getElementById('serviceSearch');
            if (searchInput) {
                searchInput.addEventListener('input', filterServices);
            }
            
            // Закрытие меню пользователя при клике вне его
            document.addEventListener('click', function(event) {
                const userMenu = document.getElementById('userMenu');
                const userAvatar = document.getElementById('userAvatar');
                
                if (userMenu && userMenu.style.display === 'block') {
                    if (!userMenu.contains(event.target) && !userAvatar.contains(event.target)) {
                        userMenu.style.display = 'none';
                    }
                }
                
                // Закрытие модальных окон при клике вне их
                const modals = document.querySelectorAll('.modal.active');
                modals.forEach(modal => {
                    if (event.target === modal) {
                        closeModal(modal.id);
                    }
                });
                
                // Закрытие поп-ап окна при клике вне его
                const popupModal = document.getElementById('tasksPopupModal');
                if (popupModal && event.target === popupModal) {
                    closeTasksPopup();
                }
            });
            
            // Обработка Escape для закрытия модальных окон
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeAllModals();
                    closeUserMenu();
                    closeTasksPopup();
                }
            });
            
            // Обработка Enter в чате
            const inlineChatInput = document.getElementById('inlineChatMessage');
            if (inlineChatInput) {
                inlineChatInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendInlineChatMessage();
                    }
                });
            }
        }

        // Получение информации о подписке
        async function loadSubscriptionInfo() {
            if (!currentUser) return null;
            
            try {
                const response = await fetchWithAuth(`${API_BASE_URL}/api/auth/subscription-info`);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        return data.data;
                    }
                }
            } catch (error) {
                console.error('Ошибка получения информации о подписке:', error);
            }
            return null;
        }

        // Показать уведомление о подписке при входе
        async function showSubscriptionNotification() {
            if (!currentUser || currentUser.role !== 'client') return;
            
            const subscriptionInfo = await loadSubscriptionInfo();
            if (!subscriptionInfo) return;
            
            const { subscription_status, subscription_expires, days_remaining, next_charge_date } = subscriptionInfo;
            
            if (subscription_status === 'active' && subscription_expires) {
                const expiryDate = new Date(subscription_expires);
                const formattedDate = expiryDate.toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
                
                const nextCharge = new Date(next_charge_date);
                const nextChargeFormatted = nextCharge.toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
                
                let message = `✅ Ваша подписка активна`;
                
                if (days_remaining > 0) {
                    message += `\n⏰ Действует еще ${days_remaining} ${getDayWord(days_remaining)} до ${formattedDate}`;
                    message += `\n💰 Следующее списание: ${nextChargeFormatted}`;
                    
                    if (days_remaining <= 7) {
                        message += `\n⚠️ Подписка скоро закончится! Продлите вовремя.`;
                    }
                } else {
                    message += `\n⚠️ Подписка истекает сегодня!`;
                    message += `\n💰 Следующее списание: ${nextChargeFormatted}`;
                }
                
                setTimeout(() => {
                    showNotification(message, 'info');
                }, 1000);
            }
        }

        // Функция для правильного склонения слова "день"
        function getDayWord(days) {
            if (days % 10 === 1 && days % 100 !== 11) {
                return 'день';
            } else if ([2, 3, 4].includes(days % 10) && ![12, 13, 14].includes(days % 100)) {
                return 'дня';
            } else {
                return 'дней';
            }
        }
        
        // Проверка авторизации
        async function checkAuth() {
            if (!currentToken) return;
            
            try {
                const response = await fetchWithAuth(`${API_BASE_URL}/api/auth/check`);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        currentUser = data.data.user;
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        console.log('Пользователь авторизован:', currentUser.email);
                    }
                } else {
                    localStorage.removeItem('token');
                    localStorage.removeItem('currentUser');
                    currentToken = null;
                    currentUser = null;
                    console.log('Токен невалиден, пользователь разлогинен');
                }
            } catch (error) {
                console.error('Ошибка проверки авторизации:', error);
                localStorage.removeItem('token');
                localStorage.removeItem('currentUser');
                currentToken = null;
                currentUser = null;
            }
        }
        
        // Навигация по страницам
        function navigateToPage(pageId) {
            if (chatPollingInterval) {
                clearInterval(chatPollingInterval);
                chatPollingInterval = null;
                currentChatTaskId = null;
            }
            
            closeUserMenu();
            closeTasksPopup();
            
            // Скрываем все страницы
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Показываем нужную страницу
            const pageElement = document.getElementById(pageId + '-page');
            if (pageElement) {
                pageElement.classList.add('active');
            } else {
                console.error('Страница не найдена:', pageId);
                return;
            }
            
            // Управляем видимостью нижней навигации
            const bottomNav = document.getElementById('bottomNav');
            const floatingBtn = document.getElementById('floatingTasksBtn');
            
            if (currentUser && currentUser.phone_verified && 
                currentUser.subscription_status === 'active' && 
                currentUser.initial_fee_paid) {
                
                if (!['auth', 'subscription-required'].includes(pageId)) {
                    bottomNav.style.display = 'flex';
                    floatingBtn.style.display = 'flex';
                    
                    document.querySelectorAll('.nav-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    if (['home', 'profile', 'tasks', 'all-services'].includes(pageId)) {
                        const navItem = document.querySelector(`.nav-item[data-page="${pageId}"]`);
                        if (navItem) {
                            navItem.classList.add('active');
                        }
                    }
                } else {
                    bottomNav.style.display = 'none';
                    floatingBtn.style.display = 'none';
                }
            } else {
                bottomNav.style.display = 'none';
                floatingBtn.style.display = 'none';
            }
            
            // Загружаем данные для страницы
            switch(pageId) {
                case 'profile':
                    loadUserProfile();
                    break;
                case 'home':
                    loadHomePage();
                    break;
                case 'tasks':
                    loadUserTasks();
                    break;
                case 'subscription':
                    loadSubscriptionPage();
                    break;
                case 'all-services':
                    loadAllServicesPage();
                    break;
                case 'auth':
                    setTimeout(animateCounters, 500);
                    break;
            }
        }
        
        // Загрузка главной страницы
        async function loadHomePage() {
            try {
                await loadCategories();
                renderHomeCategories();
                await loadTopServices();
                updateHomeStats();
            } catch (error) {
                console.error('Ошибка загрузки главной страницы:', error);
                showNotification('Ошибка загрузки главной страницы', 'error');
            }
        }
        
        // Загрузка топ услуг
        async function loadTopServices() {
            try {
                const response = await fetchWithAuth(`${API_BASE_URL}/api/services/top`);
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        renderTopServices(result.data.services);
                        return;
                    }
                }
                
                // Fallback на локальные данные
                const topServicesData = [
                    {
                        id: 1,
                        name: "Уборка квартиры",
                        description: "Полная уборка 2-комнатной квартиры с использованием профессиональной химии",
                        category_name: "Дом и быт",
                        icon: "fas fa-broom"
                    },
                    {
                        id: 2,
                        name: "Няня на день",
                        description: "Присмотр за ребенком в течение дня, развивающие занятия",
                        category_name: "Семья и дети",
                        icon: "fas fa-baby"
                    },
                    {
                        id: 3,
                        name: "Маникюр на дому",
                        description: "Комплексный уход за ногтями и кожей рук",
                        category_name: "Красота и здоровье",
                        icon: "fas fa-hand-sparkles"
                    }
                ];
                
                renderTopServices(topServicesData);
            } catch (error) {
                console.error('Ошибка загрузки топ услуг:', error);
                const container = document.getElementById('topServicesGrid');
                if (container) {
                    container.innerHTML = `
                        <div class="card service-card" onclick="selectService({id: 1, name: 'Уборка квартиры', description: 'Полная уборка с использованием профессиональной химии', category_name: 'Дом и быт'})">
                            <div class="service-image">
                                <i class="fas fa-broom"></i>
                            </div>
                            <div class="service-header">
                                <h4>Уборка квартиры</h4>
                            </div>
                            <p class="service-description">Полная уборка с использованием профессиональной химии</p>
                            <div class="service-footer">
                                <span class="service-price"><i class="fas fa-crown"></i> Включено в подписку</span>
                            </div>
                        </div>
                    `;
                }
            }
        }
        
        function renderTopServices(services) {
            const container = document.getElementById('topServicesGrid');
            if (!container) return;
            
            if (!services || services.length === 0) {
                container.innerHTML = `
                    <div class="card" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <i class="fas fa-exclamation-circle" style="font-size: 3rem; color: var(--graphite-light); margin-bottom: 20px;"></i>
                        <p style="color: var(--graphite-medium);">Услуги не найдены</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            services.forEach(service => {
                const card = document.createElement('div');
                card.className = 'card service-card';
                card.onclick = () => selectService(service);
                card.innerHTML = `
                    <div class="service-image">
                        <i class="${service.icon || 'fas fa-star'}"></i>
                    </div>
                    <div class="service-header">
                        <h4>${service.name}</h4>
                        <span style="font-size: 0.8rem; color: var(--primary-gold);">
                            <i class="fas fa-star"></i> Топ
                        </span>
                    </div>
                    <p class="service-description">${service.description}</p>
                    <div class="service-footer">
                        <span class="service-price"><i class="fas fa-crown"></i> Включено в подписку</span>
                        <span style="color: var(--aqua-teal); font-weight: 600; font-size: 0.9rem;">
                            Выбрать
                        </span>
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        function updateHomeStats() {
            if (!currentUser) return;
            
            const statTasksHome = document.getElementById('statTasksHome');
            const statAvailableHome = document.getElementById('statAvailableHome');
            const statCompletedHome = document.getElementById('statCompletedHome');
            
            if (statTasksHome) {
                statTasksHome.textContent = currentUser.tasks_used || '0';
            }
            
            if (statAvailableHome) {
                const available = (currentUser.tasks_limit || 0) - (currentUser.tasks_used || 0);
                statAvailableHome.textContent = available > 0 ? available : '0';
            }
            
            if (statCompletedHome) {
                statCompletedHome.textContent = currentUser.completed_tasks || '0';
            }
        }
        
        // Загрузка всех услуг
        async function loadAllServices() {
            try {
                console.log('Загрузка всех услуг...');
                
                const response = await fetch(`${API_BASE_URL}/api/services`);
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        allServices = result.data.services;
                        console.log(`Загружено ${allServices.length} услуг с сервера`);
                        return allServices;
                    }
                }
                
                // Fallback на локальные данные
                const mockServices = [
                    { 
                        id: 1, 
                        name: "Уборка квартиры", 
                        description: "Полная уборка квартиры с использованием профессиональной химии", 
                        category_name: "Дом и быт", 
                        category_id: 1,
                        icon: "fas fa-broom"
                    },
                    { 
                        id: 2, 
                        name: "Глажка белья", 
                        description: "Аккуратная глажка вещей с учетом требований к тканям", 
                        category_name: "Дом и быт", 
                        category_id: 1,
                        icon: "fas fa-tshirt"
                    }
                ];
                
                allServices = mockServices;
                console.log(`Используем локальные данные (${allServices.length} услуг)`);
                return allServices;
                
            } catch (error) {
                console.error('Ошибка загрузки услуг:', error);
                allServices = [];
                return [];
            }
        }
        
        // Загрузка страницы всех услуг
        async function loadAllServicesPage() {
            try {
                await loadCategories();
                renderAllCategoriesForServices();
            } catch (error) {
                console.error('Ошибка загрузки страницы услуг:', error);
                showNotification('Ошибка загрузки услуг', 'error');
            }
        }
        
        function renderAllCategoriesForServices() {
            const container = document.getElementById('allServicesList');
            if (!container) return;
            
            if (!categories || categories.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <i class="fas fa-exclamation-circle" style="font-size: 3rem; color: var(--graphite-light); margin-bottom: 20px;"></i>
                        <p style="color: var(--graphite-medium);">Категории не найдены</p>
                    </div>
                `;
                return;
            }
            
            container.className = 'square-grid';
            container.innerHTML = '';
            
            categories.forEach(category => {
                const card = document.createElement('div');
                card.className = 'category-card-square';
                card.onclick = () => {
                    selectCategoryForServices(category);
                };
                
                const categoryIcon = category.icon || getCategoryIcon(category.display_name);
                
                card.innerHTML = `
                    <div class="category-image-container">
                        ${category.image_url ? 
                            `<img src="${category.image_url}" alt="${category.display_name}" loading="lazy">` :
                            `<div style="width: 100%; height: 100%; background: linear-gradient(135deg, var(--pink-light), var(--soft-pink)); display: flex; align-items: center; justify-content: center;">
                                <i class="${categoryIcon}" style="font-size: 3rem; color: var(--lavender-purple);"></i>
                            </div>`
                        }
                        <div class="category-icon-badge">
                            <i class="${categoryIcon}"></i>
                        </div>
                    </div>
                    <div class="category-content">
                        <h3 class="category-title">${category.display_name}</h3>
                        <p class="category-description">${category.description}</p>
                        <div class="category-footer">
                            <span class="services-count">
                                <i class="fas fa-list"></i>
                                ${category.services_count || 0} услуг
                            </span>
                            <span class="select-service-btn">
                                Выбрать <i class="fas fa-arrow-right"></i>
                            </span>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
            
            const backBtn = document.getElementById('backToCategoriesBtn');
            if (backBtn) {
                backBtn.style.display = 'none';
            }
            
            const pageTitle = document.getElementById('servicesPageTitle');
            if (pageTitle) {
                pageTitle.textContent = 'Все услуги';
            }
            
            const searchInput = document.getElementById('serviceSearch');
            if (searchInput) {
                searchInput.value = '';
            }
            
            selectedCategory = null;
        }
        
        // Выбор категории на странице услуг
        async function selectCategoryForServices(category) {
            console.log('Выбрана категория на странице услуг:', category);
            
            if (!currentUser) {
                showNotification('Для просмотра услуг необходимо войти в систему', 'warning');
                showLoginModal();
                return;
            }
            
            if (currentUser.subscription_status !== 'active' || !currentUser.initial_fee_paid) {
                showNotification('Для просмотра услуг необходима активная подписка', 'warning');
                navigateToPage('subscription-required');
                return;
            }
            
            selectedCategory = category;
            
            try {
                const response = await fetchWithAuth(`${API_BASE_URL}/api/categories/${category.id}/services`);
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        services = result.data.services;
                        renderServicesInCategory();
                        return;
                    }
                }
                
                // Fallback на локальные данные
                const filteredServices = allServices.filter(service => service.category_id === category.id);
                
                if (filteredServices.length > 0) {
                    services = filteredServices;
                    renderServicesInCategory();
                } else {
                    showNotification('В этой категории пока нет услуг', 'info');
                }
            } catch (error) {
                console.error('Ошибка загрузки услуг:', error);
                showNotification('Ошибка загрузки услуг', 'error');
            }
        }

        function renderServicesInCategory() {
            const container = document.getElementById('allServicesList');
            const pageTitle = document.querySelector('#all-services-page .section-title');
            
            if (!container) return;
            
            if (!services || services.length === 0) {
                container.className = 'square-grid';
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px; justify-content: center;">
                            <button class="btn btn-secondary" onclick="loadAllServicesPage()" style="padding: 8px 16px;">
                                <i class="fas fa-arrow-left"></i>
                            </button>
                            <h3 style="font-size: 1.2rem;">${selectedCategory.display_name}</h3>
                        </div>
                        <i class="fas fa-exclamation-circle" style="font-size: 3rem; color: var(--graphite-light); margin-bottom: 20px;"></i>
                        <p style="color: var(--graphite-medium);">В этой категории пока нет услуг</p>
                        <button class="btn btn-primary" onclick="loadAllServicesPage()" style="margin-top: 20px;">
                            <i class="fas fa-arrow-left"></i>
                            Назад к категориям
                        </button>
                    </div>
                `;
                return;
            }
            
            if (pageTitle) {
                pageTitle.textContent = selectedCategory.display_name;
            }
            
            container.className = 'square-grid';
            container.innerHTML = `
                <div style="grid-column: 1 / -1; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <button class="btn btn-secondary" onclick="loadAllServicesPage()" style="padding: 8px 16px;">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h3 style="font-size: 1.5rem; font-weight: 600;">${selectedCategory.display_name}</h3>
                        <span style="margin-left: auto; color: var(--graphite-medium); font-size: 0.9rem;">
                            ${services.length} услуг
                        </span>
                    </div>
                    <p style="color: var(--graphite-medium); margin-bottom: 20px; padding-left: 48px;">
                        ${selectedCategory.description}
                    </p>
                </div>
            `;
            
            services.forEach(service => {
                const card = document.createElement('div');
                card.className = 'category-card-square';
                card.onclick = () => selectService(service);
                
                const serviceIcon = service.icon || selectedCategory.icon || 'fas fa-star';
                
                card.innerHTML = `
                    <div class="category-image-container">
                        ${service.image_url || selectedCategory.image_url ? 
                            `<img src="${service.image_url || selectedCategory.image_url}" alt="${service.name}" loading="lazy">` :
                            `<div style="width: 100%; height: 100%; background: linear-gradient(135deg, var(--pink-light), var(--soft-pink)); display: flex; align-items: center; justify-content: center;">
                                <i class="${serviceIcon}" style="font-size: 3rem; color: var(--lavender-purple);"></i>
                            </div>`
                        }
                        <div class="category-icon-badge">
                            <i class="${serviceIcon}"></i>
                        </div>
                    </div>
                    <div class="category-content">
                        <h3 class="category-title">${service.name}</h3>
                        <p class="category-description">${service.description}</p>
                        <div class="category-footer">
                            <span class="services-count">
                                <i class="fas fa-crown" style="color: var(--primary-gold);"></i>
                                Включено в подписку
                            </span>
                            <span class="select-service-btn">
                                Выбрать <i class="fas fa-arrow-right"></i>
                            </span>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
            
            const backBtn = document.getElementById('backToCategoriesBtn');
            if (backBtn) {
                backBtn.style.display = 'block';
            }
            
            const servicesPageTitle = document.getElementById('servicesPageTitle');
            if (servicesPageTitle) {
                servicesPageTitle.textContent = selectedCategory.display_name;
            }
        }
        
        // Фильтрация услуг по поиску
        function filterServices() {
            const searchInput = document.getElementById('serviceSearch');
            const searchTerm = searchInput.value.toLowerCase().trim();
            
            const container = document.getElementById('allServicesList');
            if (!container) return;
            
            const isViewingCategories = !selectedCategory;
            if (isViewingCategories) {
                if (searchTerm) {
                    showNotification('Для поиска выберите сначала категорию', 'info');
                    searchInput.value = '';
                }
                return;
            }
            
            if (!services || services.length === 0) return;
            
            let filteredServices = services;
            
            if (searchTerm) {
                filteredServices = services.filter(service => 
                    service.name.toLowerCase().includes(searchTerm) ||
                    service.description.toLowerCase().includes(searchTerm)
                );
            }
            
            if (filteredServices.length === 0) {
                container.innerHTML = `
                    <div class="card" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <i class="fas fa-search" style="font-size: 3rem; color: var(--graphite-light); margin-bottom: 20px;"></i>
                        <p style="color: var(--graphite-medium;">По запросу "${searchTerm}" ничего не найдено</p>
                        <button class="btn btn-primary" onclick="loadAllServicesPage()" style="margin-top: 20px;">
                            <i class="fas fa-arrow-left"></i>
                            Назад к категориям
                        </button>
                    </div>
                `;
                return;
            }
            
            const header = container.querySelector('div[style*="grid-column"]');
            container.innerHTML = '';
            if (header) {
                container.appendChild(header);
            }
            
            filteredServices.forEach(service => {
                const card = document.createElement('div');
                card.className = 'category-card-square';
                card.onclick = () => selectService(service);
                
                let serviceIcon = service.icon || selectedCategory.icon || 'fas fa-star';
                
                card.innerHTML = `
                    <div class="category-image-container">
                        ${service.image_url || selectedCategory.image_url ? 
                            `<img src="${service.image_url || selectedCategory.image_url}" alt="${service.name}" loading="lazy">` :
                            `<div style="width: 100%; height: 100%; background: linear-gradient(135deg, var(--pink-light), var(--soft-pink)); display: flex; align-items: center; justify-content: center;">
                                <i class="${serviceIcon}" style="font-size: 3rem; color: var(--lavender-purple);"></i>
                            </div>`
                        }
                        <div class="category-icon-badge">
                            <i class="${serviceIcon}"></i>
                        </div>
                    </div>
                    <div class="category-content">
                        <h3 class="category-title">${service.name}</h3>
                        <p class="category-description">${service.description}</p>
                        <div class="category-footer">
                            <span class="services-count">
                                <i class="fas fa-crown" style="color: var(--primary-gold);"></i>
                                Включено в подписку
                            </span>
                            <span class="select-service-btn">
                                Выбрать <i class="fas fa-arrow-right"></i>
                            </span>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Загрузка категорий
        async function loadCategories() {
            try {
                console.log('Загрузка категорий с сервера...');
                
                const response = await fetch(`${API_BASE_URL}/api/categories`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    categories = result.data.categories;
                    console.log(`Загружено ${categories.length} категорий с сервера`);
                    return categories;
                } else {
                    throw new Error(result.error || 'Ошибка загрузки категорий');
                }
                
            } catch (error) {
                console.error('Ошибка загрузки категорий:', error.message);
                
                // Fallback на локальные данные
                const mockCategories = [
                    {
                        id: 1,
                        name: "home",
                        display_name: "Дом и быт",
                        description: "Уборка, ремонт, помощь по хозяйству",
                        icon: "fas fa-home",
                        services_count: 8
                    },
                    {
                        id: 2,
                        name: "family",
                        display_name: "Семья и дети",
                        description: "Няни, репетиторы, помощь с детьми",
                        icon: "fas fa-child",
                        services_count: 6
                    },
                    {
                        id: 3,
                        name: "beauty",
                        display_name: "Красота и здоровье",
                        description: "Маникюр, парикмахер, массаж на дому",
                        icon: "fas fa-spa",
                        services_count: 5
                    },
                    {
                        id: 4,
                        name: "education",
                        display_name: "Образование",
                        description: "Репетиторы, курсы, подготовка к экзаменам",
                        icon: "fas fa-graduation-cap",
                        services_count: 4
                    },
                    {
                        id: 5,
                        name: "pets",
                        display_name: "Питомцы",
                        description: "Выгул, уход, передержка животных",
                        icon: "fas fa-paw",
                        services_count: 3
                    },
                    {
                        id: 6,
                        name: "entertainment",
                        display_name: "Развлечения",
                        description: "Организация праздников, аниматоры",
                        icon: "fas fa-glass-cheers",
                        services_count: 2
                    }
                ];
                categories = mockCategories;
                console.log(`Используем локальные данные (${categories.length} категорий)`);
                return categories;
            }
        }

        // Получение иконки для категории
        function getCategoryIcon(categoryName) {
            const icons = {
                'Дом и быт': 'fas fa-home',
                'Семья и дети': 'fas fa-child',
                'Красота и здоровье': 'fas fa-spa',
                'Образование': 'fas fa-graduation-cap',
                'Покупки и доставка': 'fas fa-shopping-cart',
                'Развлечения': 'fas fa-glass-cheers',
                'home_and_household': 'fas fa-home',
                'family_and_children': 'fas fa-child',
                'beauty_and_health': 'fas fa-spa',
                'courses_and_education': 'fas fa-graduation-cap',
                'shopping_and_delivery': 'fas fa-shopping-cart',
                'events_and_organization': 'fas fa-glass-cheers'
            };
            return icons[categoryName] || 'fas fa-star';
        }
        
        function renderHomeCategories() {
            const container = document.getElementById('categoriesGrid');
            if (!container) return;
            
            const homeCategories = categories.slice(0, 4);
            
            if (homeCategories.length === 0) {
                container.innerHTML = `
                    <div class="card" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <i class="fas fa-exclamation-circle" style="font-size: 3rem; color: var(--graphite-light); margin-bottom: 20px;"></i>
                        <p style="color: var(--graphite-medium);">Категории не найдены</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            homeCategories.forEach(category => {
                const card = document.createElement('div');
                card.className = 'card category-card';
                card.onclick = () => selectCategory(category);
                
                const imageContent = category.image_url 
                    ? `<img src="${category.image_url}" alt="${category.display_name}" 
                         style="width: 100%; height: 100%; object-fit: cover;">
                        <div style="position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.9); 
                                  padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; z-index: 2;">
                            <i class="${category.icon}" style="color: var(--lavender-purple);"></i>
                        </div>`
                    : `<div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; 
                             background: linear-gradient(135deg, var(--pink-light), var(--soft-pink));">
                            <i class="${category.icon}" style="font-size: 2.5rem; color: var(--lavender-purple);"></i>
                        </div>`;
                
                card.innerHTML = `
                    <div class="category-image" data-category="${category.display_name}">
                        ${imageContent}
                    </div>
                    <h3>${category.display_name}</h3>
                    <p>${category.description}</p>
                    <span class="service-price"><i class="fas fa-crown"></i> Включено в подписку</span>
                `;
                container.appendChild(card);
            });
        }
        
        // Выбор категории
        async function selectCategory(category) {
            console.log('Выбрана категория:', category);
            
            if (!currentUser) {
                showNotification('Для выбора категории необходимо войти в систему', 'warning');
                showLoginModal();
                return;
            }
            
            if (currentUser.subscription_status !== 'active' || !currentUser.initial_fee_paid) {
                showNotification('Для выбора категории необходима активная подписка', 'warning');
                navigateToPage('subscription-required');
                return;
            }
            
            selectedCategory = category;
            
            try {
                const response = await fetchWithAuth(`${API_BASE_URL}/api/categories/${category.id}/services`);
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        services = result.data.services;
                        
                        if (services.length > 0) {
                            navigateToPage('all-services');
                            selectCategoryForServices(category);
                            return;
                        }
                    }
                }
                
                // Fallback на локальные данные
                const filteredServices = allServices.filter(service => service.category_id === category.id);
                
                if (filteredServices.length > 0) {
                    services = filteredServices;
                    navigateToPage('all-services');
                    selectCategoryForServices(category);
                } else {
                    showNotification('В этой категории пока нет услуг', 'info');
                }
            } catch (error) {
                console.error('Ошибка загрузки услуг:', error);
                showNotification('Ошибка загрузки услуг', 'error');
            }
        }
        
        // Выбор услуги
        function selectService(service) {
            console.log('Выбрана услуга:', service);
            
            if (!currentUser) {
                showNotification('Для выбора услуги необходимо войти в систему', 'warning');
                showLoginModal();
                return;
            }
            
            if (currentUser.subscription_status !== 'active' || !currentUser.initial_fee_paid) {
                showNotification('Для выбора услуги необходима активная подписку', 'warning');
                navigateToPage('subscription-required');
                return;
            }
            
            selectedService = service;
            navigateToPage('create-task');
            updateTaskForm();
        }
        
        function updateTaskForm() {
            if (selectedCategory) {
                const categoryDisplay = document.getElementById('selectedCategoryDisplay');
                if (categoryDisplay) {
                    categoryDisplay.textContent = selectedCategory.display_name;
                    categoryDisplay.style.color = 'var(--graphite-dark)';
                }
            }
            
            if (selectedService) {
                const serviceDisplay = document.getElementById('selectedServiceDisplay');
                if (serviceDisplay) {
                    serviceDisplay.textContent = selectedService.name;
                    serviceDisplay.style.color = 'var(--graphite-dark)';
                }
            }
            
            const contactInput = document.getElementById('taskContact');
            if (contactInput && currentUser && currentUser.phone) {
                contactInput.value = currentUser.phone;
            }
        }
        
        function checkSubscription() {
            if (!currentUser) {
                showNotification('Для создания задачи необходимо войти в систему', 'warning');
                showLoginModal();
                return;
            }
            
            if (currentUser.subscription_status !== 'active' || !currentUser.initial_fee_paid) {
                navigateToPage('subscription-required');
            } else {
                navigateToPage('all-services');
            }
        }
        
        // Отмена создания задачи
        function cancelTask() {
            selectedCategory = null;
            selectedService = null;
            
            const taskForm = document.getElementById('createTaskForm');
            if (taskForm) {
                taskForm.reset();
            }
            
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const deadlineInput = document.getElementById('taskDeadline');
            if (deadlineInput) {
                deadlineInput.value = tomorrow.toISOString().split('T')[0];
                deadlineInput.min = new Date().toISOString().split('T')[0];
            }
            
            const categoryDisplay = document.getElementById('selectedCategoryDisplay');
            if (categoryDisplay) {
                categoryDisplay.textContent = 'Не выбрана';
                categoryDisplay.style.color = 'var(--graphite-medium)';
            }
            
            const serviceDisplay = document.getElementById('selectedServiceDisplay');
            if (serviceDisplay) {
                serviceDisplay.textContent = 'Не выбрана';
                serviceDisplay.style.color = 'var(--graphite-medium)';
            }
            
            navigateToPage('home');
        }
        
        // Создание задачи
        async function createTask() {
            if (!currentUser) {
                showNotification('Для создания задачи необходимо войти в систему', 'error');
                return;
            }
            
            if (currentUser.subscription_status !== 'active' || !currentUser.initial_fee_paid) {
                showNotification('Для создания задачи необходима активная подписка', 'error');
                navigateToPage('subscription-required');
                return;
            }
            
            const taskTitle = document.getElementById('taskTitle')?.value;
            const taskDescription = document.getElementById('taskDescription')?.value;
            const taskAddress = document.getElementById('taskAddress')?.value;
            const taskDeadline = document.getElementById('taskDeadline')?.value;
            const taskContact = document.getElementById('taskContact')?.value;
            const additionalRequirements = document.getElementById('additionalRequirements')?.value;
            
            if (!taskTitle || !taskDescription || !taskAddress || !taskDeadline || !taskContact) {
                showNotification('Заполните все обязательные поля', 'error');
                return;
            }
            
            let autoCategoryId = selectedCategory?.id;
            let autoServiceId = selectedService?.id;
            
            if (!autoCategoryId) {
                const titleLower = taskTitle.toLowerCase();
                const descLower = taskDescription.toLowerCase();
                
                const textForAnalysis = titleLower + ' ' + descLower;
                
                const categoryKeywords = {
                    'уборк': 1, 'чистк': 1, 'мыть': 1, 'стирк': 1, 'глажк': 1, 'уход за дом': 1,
                    'клининг': 1, 'помощь по дому': 1, 'бытов': 1,
                    'нян': 2, 'ребен': 2, 'дет': 2, 'присмотр': 2, 'няня': 2, 'уход за ребен': 2,
                    'гулян': 2, 'помощь с дет': 2,
                    'маникюр': 3, 'педикюр': 3, 'стрижк': 3, 'парикмахер': 3, 'массаж': 3,
                    'космет': 3, 'красот': 3, 'уход за собой': 3,
                    'репетитор': 4, 'учеб': 4, 'занят': 4, 'обучен': 4, 'подготовк': 4,
                    'курс': 4, 'образован': 4,
                    'покупк': 5, 'доставк': 5, 'закупк': 5, 'товар': 5, 'продукт': 5,
                    'супермаркет': 5, 'магазин': 5,
                    'организац': 6, 'праздн': 6, 'мероприят': 6, 'аниматор': 6, 'развлечен': 6
                };
                
                for (const [keyword, categoryId] of Object.entries(categoryKeywords)) {
                    if (textForAnalysis.includes(keyword)) {
                        autoCategoryId = categoryId;
                        console.log(`Автоматически определена категория ${categoryId} по слову "${keyword}"`);
                        break;
                    }
                }
                
                if (!autoCategoryId && categories.length > 0) {
                    autoCategoryId = categories[0].id;
                    console.log(`Используем первую доступную категорию: ${autoCategoryId}`);
                }
            }
            
            if (!autoCategoryId) {
                showNotification('Не удалось определить категорию. Выберите категорию вручную.', 'error');
                return;
            }
            
            const deadlineDate = new Date(taskDeadline);
            if (deadlineDate < new Date()) {
                showNotification('Дата дедлайна не может быть в прошлом', 'error');
                return;
            }
            
            try {
                showLoading('Создание задачи...');
                
                const response = await fetchWithAuth(`${API_BASE_URL}/api/tasks`, {
                    method: 'POST',
                    body: JSON.stringify({
                        title: taskTitle,
                        description: taskDescription,
                        category_id: autoCategoryId,
                        service_id: autoServiceId || null,
                        priority: 'medium',
                        deadline: taskDeadline,
                        address: taskAddress,
                        contact_info: taskContact,
                        additional_requirements: additionalRequirements || ''
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Ошибка создания задачи');
                }
                
                showNotification('Задача успешно создана! Мы ищем подходящую исполнительницу.', 'success');
                
                if (currentUser.tasks_used) {
                    currentUser.tasks_used = parseInt(currentUser.tasks_used) + 1;
                } else {
                    currentUser.tasks_used = 1;
                }
                
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                updateUserInterface();
                updateHomeStats();
                
                cancelTask();
                
                setTimeout(() => {
                    showNotification('Задача опубликована. Исполнители увидят её в списке доступных задач.', 'info');
                }, 3000);
                
            } catch (error) {
                console.error('Ошибка создания задачи:', error);
                showNotification(error.message || 'Ошибка создания задачи', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Загрузка подписок
        async function loadSubscriptions() {
            try {
                console.log('Загрузка подписок с сервера...');
                
                const response = await fetch(`${API_BASE_URL}/api/subscriptions`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    subscriptions = result.data.subscriptions;
                    console.log(`Загружено ${subscriptions.length} подписок с сервера`);
                    return subscriptions;
                } else {
                    throw new Error(result.error || 'Ошибка загрузки подписок');
                }
                
            } catch (error) {
                console.error('Ошибка загрузки подписок:', error.message);
                
                // Fallback на локальные данные
                const mockSubscriptions = [
                    {
                        id: 1,
                        name: "essential",
                        display_name: "Эссеншл",
                        description: "Базовый набор услуг для повседневных задач",
                        price_monthly: 2990,
                        initial_fee: 2000,
                        is_popular: false,
                        features: [
                            "10 задач в месяц",
                            "Базовые категории услуг",
                            "Поддержка в чате",
                            "Рейтинг исполнителей"
                        ]
                    },
                    {
                        id: 2,
                        name: "premium",
                        display_name: "Премиум",
                        description: "Расширенный доступ ко всем возможностям сервиса",
                        price_monthly: 5990,
                        initial_fee: 3000,
                        is_popular: true,
                        features: [
                            "Неограниченное количество задач",
                            "Все категории услуг",
                            "Приоритетная поддержка 24/7",
                            "Персональный помощник",
                            "Экспресс-исполнители",
                            "Скидки на дополнительные услуги"
                        ]
                    },
                    {
                        id: 3,
                        name: "family",
                        display_name: "Для семьи",
                        description: "Идеально для мам и семей с детьми",
                        price_monthly: 7990,
                        initial_fee: 4000,
                        is_popular: false,
                        features: [
                            "Неограниченное количество задач",
                            "Все категории услуг",
                            "Проверенные няни и репетиторы",
                            "Семейная поддержка",
                            "Детские мероприятия",
                            "Экстренная помощь"
                        ]
                    }
                ];
                
                subscriptions = mockSubscriptions;
                console.log(`Используем локальные данные (${subscriptions.length} подписок)`);
                return subscriptions;
            }
        }
        
        // Загрузка страницы подписок
        async function loadSubscriptionPage() {
            try {
                await loadSubscriptions();
                renderSubscriptions();
            } catch (error) {
                console.error('Ошибка загрузки страницы подписок:', error);
                showNotification('Ошибка загрузки подписок', 'error');
            }
        }
        
        function renderSubscriptions() {
            const subscriptionContainer = document.getElementById('subscriptionSelection');
            if (subscriptionContainer) {
                if (!subscriptions || subscriptions.length === 0) {
                    subscriptionContainer.innerHTML = `
                        <div class="card" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                            <i class="fas fa-exclamation-circle" style="font-size: 3rem; color: var(--graphite-light); margin-bottom: 20px;"></i>
                            <p style="color: var(--graphite-medium);">Подписки не найдены</p>
                        </div>
                    `;
                    return;
                }
                
                subscriptionContainer.innerHTML = '';
                subscriptions.forEach(sub => {
                    const card = document.createElement('div');
                    card.className = `card subscription-card ${sub.is_popular ? 'popular' : ''}`;
                    
                    if (sub.is_popular) {
                        card.innerHTML += '<div class="popular-badge">Популярный</div>';
                    }
                    
                    const features = Array.isArray(sub.features) ? sub.features : [];
                    
                    card.innerHTML += `
                        <h3>${sub.display_name}</h3>
                        <p style="color: var(--graphite-medium); margin-bottom: 15px;">${sub.description}</p>
                        
                        <div class="subscription-price">
                            ${formatNumber(sub.price_monthly)}<span>₽/мес</span>
                        </div>
                        
                        <div style="color: var(--graphite-light); font-size: 0.9rem; margin-bottom: 15px;">
                            Вступительный взнос: ${formatNumber(sub.initial_fee)}₽
                        </div>
                        
                        <ul class="subscription-features">
                            ${features.map(feature => `<li><i class="fas fa-check"></i> ${feature}</li>`).join('')}
                        </ul>
                        
                        <button class="btn ${sub.is_popular ? 'btn-primary' : 'btn-secondary'}" style="width: 100%; margin-top: 20px;" onclick="selectSubscription('${sub.name}')">
                            ${currentUser && currentUser.subscription_plan === sub.name ? 'Текущий тариф' : 'Выбрать тариф'}
                        </button>
                    `;
                    
                    subscriptionContainer.appendChild(card);
                });
            }
        }

        // Открыть модалку подтверждения телефона
        function openVerifyPhoneModal(phoneNumber) {
            closeAllModals();
            const modal = document.getElementById('verifyPhoneModal');
            if (modal) {
                const phoneInput = document.getElementById('verifyPhoneNumber');
                if (phoneInput && phoneNumber) {
                    phoneInput.value = phoneNumber;
                }
                modal.classList.add('active');
                document.getElementById('verifyPhoneCode')?.focus();
            }
        }

        // Открыть модалку отправки кода
        function openSendCodeModal() {
            closeAllModals();
            const modal = document.getElementById('sendCodeModal');
            if (modal) {
                modal.classList.add('active');
                document.getElementById('sendCodePhone')?.focus();
            }
        }

        // Закрыть модалку подтверждения телефона
        function closeVerifyPhoneModal() {
            closeModal('verifyPhoneModal');
        }

        // Отправить код подтверждения
        async function sendVerificationCode(fromSendModal = false) {
            let phoneNumber;
            
            if (fromSendModal) {
                phoneNumber = document.getElementById('sendCodePhone').value;
                if (!phoneNumber) {
                    showNotification('Введите номер телефона', 'error');
                    return;
                }
            } else {
                phoneNumber = document.getElementById('verifyPhoneNumber').value;
            }
            
            if (!phoneNumber) {
                showNotification('Номер телефона не найден', 'error');
                return;
            }
            
            try {
                showLoading('Отправка SMS кода...');
                
                const response = await fetch(`${API_BASE_URL}/api/auth/send-verification-code`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        phone: normalizePhone(phoneNumber)
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Ошибка отправки кода');
                }
                
                showNotification('Код подтверждения отправлен! Проверьте SMS на телефоне', 'success');
                
                if (fromSendModal) {
                    closeModal('sendCodeModal');
                    openVerifyPhoneModal(phoneNumber);
                } else {
                    document.getElementById('verifyPhoneCode').value = '';
                    document.getElementById('verifyPhoneCode').focus();
                }
                
            } catch (error) {
                console.error('Ошибка отправки кода:', error);
                showNotification(error.message, 'error');
            } finally {
                hideLoading();
            }
        }

       async function verifyPhoneCode() {
    const phoneNumber = document.getElementById('verifyPhoneNumber').value;
    const code = document.getElementById('verifyPhoneCode').value;
    
    if (!phoneNumber || !code) {
        showNotification('Введите код подтверждения', 'error');
        return;
    }
    
    if (code.length !== 6) {
        showNotification('Код должен содержать 6 цифр', 'error');
        return;
    }
    
    try {
        showLoading('Проверка кода...');
        
        const response = await fetch(`${API_BASE_URL}/api/auth/verify-phone`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': currentToken ? `Bearer ${currentToken}` : ''
            },
            body: JSON.stringify({
                phone: normalizePhone(phoneNumber),
                code: code
            })
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        
        if (!result.success) {
            throw new Error(result.error || 'Ошибка подтверждения телефона');
        }
        
        // Сохраняем токен и обновляем пользователя
        currentToken = result.data.token;
        currentUser = result.data.user;
        
        localStorage.setItem('token', currentToken);
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        
        showNotification('Телефон успешно подтвержден!', 'success');
        closeVerifyPhoneModal();
            
        if (currentUser) {
            currentUser.phone_verified = true;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            updateUserInterface();
        }
        
        // Проверяем, нужно ли переходить к выбору подписки
        if (currentUser && !currentUser.subscription_plan) {
            showNotification('Регистрация завершена! Добро пожаловать!', 'success');
            
            // В демо-режиме сразу показываем подписку
            if (result.data.demo_mode_after_verification) {
                setTimeout(() => {
                    navigateToPage('subscription');
                }, 1000);
            } else {
                setTimeout(() => {
                    navigateToPage('auth'); // Возвращаем на экран авторизации
                }, 1000);
            }
        } else if (currentUser && currentUser.subscription_status === 'active') {
            showNotification('Аккаунт подтвержден! Теперь вы можете создавать задачи.', 'success');
            
            setTimeout(() => {
                navigateToPage('home');
            }, 1000);
        } else {
            showNotification('Теперь вы можете активировать подписку', 'success');
            
            setTimeout(() => {
                navigateToPage('subscription');
            }, 1000);
        }
        
    } catch (error) {
        console.error('Ошибка подтверждения телефона:', error);
        showNotification(error.message, 'error');
    } finally {
        hideLoading();
    }
}
        
        async function selectSubscription(subscriptionName) {
            if (!currentUser) {
                showNotification('Для выбора подписки необходимо войти в систему', 'error');
                showLoginModal();
                return;
            }
            
            if (!currentToken) {
                showNotification('Требуется авторизация. Войдите снова.', 'error');
                showLoginModal();
                return;
            }
            
            if (!currentUser.phone_verified) {
                showNotification('Сначала подтвердите телефон', 'error');
                openVerifyPhoneModal(currentUser.phone);
                return;
            }
            
            try {
                showLoading('Активация подписки...');
                
                const response = await fetchWithAuth(`${API_BASE_URL}/api/subscriptions/select`, {
                    method: 'POST',
                    body: JSON.stringify({
                        subscription_plan: subscriptionName
                    })
                });
                
                if (!response) {
                    return;
                }
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `Ошибка активации подписки`);
                }
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Ошибка активации подписки');
                }
                
                // Обновляем данные пользователя
                if (result.data.user) {
                    currentUser = result.data.user;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    // Если в демо-режиме, сразу перенаправляем на главную
                    if (result.data.demo_mode) {
                        showNotification('Подписка успешно активирована!', 'success');
                        
                        setTimeout(() => {
                            navigateToPage('home');
                            showNotification('Теперь вы можете создавать задачи!', 'success');
                        }, 1000);
                        return;
                    }
                }
                
                showNotification('Подписка успешно активирована!', 'success');
                
                updateUserInterface();
                
                setTimeout(() => {
                    navigateToPage('home');
                }, 1000);
                
            } catch (error) {
                console.error('Ошибка выбора подписки:', error);
                
                // Если требуется оплата вступительного взноса
                if (error.message.includes('вступительный взнос')) {
                    showNotification(error.message, 'warning');
                    
                    setTimeout(() => {
                        showNotification('В демо-режиме оплата не требуется. Попробуйте снова.', 'info');
                    }, 2000);
                } else {
                    showNotification(error.message, 'error');
                }
            } finally {
                hideLoading();
            }
        }
        
        // Обновление интерфейса пользователя
        function updateUserInterface() {
            const userAvatar = document.getElementById('userAvatar');
            const profileAvatar = document.getElementById('profileAvatar');
            const profileName = document.getElementById('profileName');
            const profileEmail = document.getElementById('profileEmail');
            const menuUserName = document.getElementById('menuUserName');
            const menuUserEmail = document.getElementById('menuUserEmail');
            const loginMenuBtn = document.getElementById('loginMenuBtn');
            const logoutMenuBtn = document.getElementById('logoutMenuBtn');
            const adminAccessBtn = document.getElementById('adminAccessBtn');
            const performerAccessBtn = document.getElementById('performerAccessBtn');
            const performerPanelLink = document.getElementById('performerPanelLink');
            const bottomNav = document.getElementById('bottomNav');
            const floatingBtn = document.getElementById('floatingTasksBtn');
            
            if (currentUser) {
                const firstLetter = currentUser.first_name ? currentUser.first_name.charAt(0).toUpperCase() : 'П';
                
                if (userAvatar) userAvatar.innerHTML = currentUser.first_name ? firstLetter : '<i class="fas fa-user"></i>';
                if (profileAvatar) profileAvatar.innerHTML = currentUser.first_name ? firstLetter : '<i class="fas fa-user"></i>';
                if (profileName) profileName.textContent = currentUser.first_name || 'Пользователь';
                if (profileEmail) profileEmail.textContent = currentUser.email || '';
                if (menuUserName) menuUserName.textContent = currentUser.first_name || 'Пользователь';
                if (menuUserEmail) menuUserEmail.textContent = currentUser.email || '';
                
                if (loginMenuBtn) loginMenuBtn.style.display = 'none';
                if (logoutMenuBtn) logoutMenuBtn.style.display = 'block';
                
                // Проверяем условия для показа нижней навигации
                const shouldShowNav = currentUser && 
                                      currentUser.phone_verified && 
                                      currentUser.subscription_status === 'active' && 
                                      currentUser.initial_fee_paid;
                
                if (bottomNav) {
                    bottomNav.style.display = shouldShowNav ? 'flex' : 'none';
                }
                
                if (floatingBtn) {
                    floatingBtn.style.display = shouldShowNav ? 'flex' : 'none';
                }
                
                if (adminAccessBtn && (currentUser.role === 'admin' || currentUser.role === 'superadmin' || currentUser.role === 'manager')) {
                    adminAccessBtn.style.display = 'flex';
                }
                
                if (performerAccessBtn && currentUser.role === 'performer') {
                    performerAccessBtn.style.display = 'flex';
                }
                
                if (performerPanelLink && (currentUser.role === 'performer' || currentUser.role === 'admin' || currentUser.role === 'superadmin' || currentUser.role === 'manager')) {
                    performerPanelLink.style.display = 'block';
                }
                
                updateProfileStats();
                updateProfileSubscriptionCard();
                
            } else {
                if (userAvatar) userAvatar.innerHTML = '<i class="fas fa-user"></i>';
                if (profileAvatar) profileAvatar.innerHTML = '<i class="fas fa-user"></i>';
                if (profileName) profileName.textContent = 'Гость';
                if (profileEmail) profileEmail.textContent = 'Войдите в аккаунт';
                if (menuUserName) menuUserName.textContent = 'Гость';
                if (menuUserEmail) menuUserEmail.textContent = '';
                
                if (loginMenuBtn) loginMenuBtn.style.display = 'block';
                if (logoutMenuBtn) logoutMenuBtn.style.display = 'none';
                if (adminAccessBtn) adminAccessBtn.style.display = 'none';
                if (performerAccessBtn) performerAccessBtn.style.display = 'none';
                if (performerPanelLink) performerPanelLink.style.display = 'none';
                if (bottomNav) bottomNav.style.display = 'none';
                if (floatingBtn) floatingBtn.style.display = 'none';
                
                const statTasks = document.getElementById('statTasks');
                const statRating = document.getElementById('statRating');
                const statBalance = document.getElementById('statBalance');
                
                if (statTasks) statTasks.textContent = '0';
                if (statRating) statRating.textContent = '0';
                if (statBalance) statBalance.textContent = '0₽';
            }
        }
        
        function updateProfileStats() {
            if (!currentUser) return;
            
            const statTasks = document.getElementById('statTasks');
            const statRating = document.getElementById('statRating');
            const statBalance = document.getElementById('statBalance');
            
            if (statTasks) statTasks.textContent = currentUser.tasks_used || '0';
            if (statRating) statRating.textContent = currentUser.rating || '0';
            if (statBalance) statBalance.textContent = (currentUser.balance || '0') + '₽';
        }
        
        function updateProfileSubscriptionCard() {
            if (!currentUser) return;
            
            const card = document.getElementById('profileSubscriptionCard');
            if (!card) return;
            
            if (currentUser.subscription_status === 'active' && currentUser.initial_fee_paid) {
                const planName = subscriptions.find(sub => sub.name === currentUser.subscription_plan)?.display_name || currentUser.subscription_plan;
                const expiresDate = currentUser.subscription_expires ? new Date(currentUser.subscription_expires) : null;
                
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div>
                            <h3 style="font-size: 1.3rem; font-weight: 600; margin-bottom: 5px;">${planName}</h3>
                            <p style="color: var(--graphite-medium); font-size: 0.9rem;">
                                ${expiresDate ? `Активна до ${expiresDate.toLocaleDateString('ru-RU')}` : 'Активна'}
                            </p>
                        </div>
                        <span style="background: rgba(56, 178, 172, 0.1); color: var(--success); padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">Активна</span>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary" style="flex: 1;" onclick="navigateToPage('subscription')">
                            <i class="fas fa-exchange-alt"></i>
                            Сменить тариф
                        </button>
                        <button class="btn btn-secondary" style="flex: 1;" onclick="showHelp()">
                            <i class="fas fa-question-circle"></i>
                            Поддержка
                        </button>
                    </div>
                `;
            } else {
                card.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-crown empty-state-icon"></i>
                        <h3 class="empty-state-title">Подписка не активна</h3>
                        <p class="empty-state-description">Активируйте подписку для доступа ко всем возможностям</p>
                        <button class="btn btn-primary" onclick="navigateToPage('subscription')">
                            <i class="fas fa-crown"></i>
                            Активировать подписку
                        </button>
                    </div>
                `;
            }
        }
        
        // Загрузка профиля пользователя
        async function loadUserProfile() {
            if (!currentUser) {
                const container = document.getElementById('profileTasksList');
                if (container) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-user empty-state-icon"></i>
                            <h3 class="empty-state-title">Войдите в аккаунт</h3>
                            <p class="empty-state-description">Войдите в аккаунт, чтобы видеть свои задачи</p>
                            <button class="btn btn-primary" onclick="showLoginModal()">
                                <i class="fas fa-sign-in-alt"></i>
                                Войти в аккаунт
                            </button>
                        </div>
                    `;
                }
                return;
            }
            
            try {
                updateUserInterface();
                await loadRecentTasks();
            } catch (error) {
                console.error('Ошибка загрузки профиля:', error);
            }
        }
        
        // Загрузка последних задач для профиля
        async function loadRecentTasks() {
            try {
                const response = await fetchWithAuth(`${API_BASE_URL}/api/tasks/recent`);
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        userTasks = result.data.tasks;
                        const container = document.getElementById('profileTasksList');
                        
                        if (userTasks.length > 0) {
                            renderRecentTasks(container);
                        } else if (container) {
                            container.innerHTML = `
                                <div class="empty-state">
                                    <i class="fas fa-tasks empty-state-icon"></i>
                                    <h3 class="empty-state-title">Задач пока нет</h3>
                                    <p class="empty-state-description">Создайте свою первую задачу</p>
                                </div>
                            `;
                        }
                        return;
                    }
                }
                
                // Fallback на локальные данные
                const mockTasks = currentUser.tasks_used > 0 ? [
                    {
                        id: 1,
                        title: "Уборка квартиры",
                        status: "completed",
                        category_name: "Дом и быт",
                        created_at: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString()
                    }
                ] : [];
                
                userTasks = mockTasks;
                
                const container = document.getElementById('profileTasksList');
                
                if (userTasks.length > 0) {
                    renderRecentTasks(container);
                } else if (container) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-tasks empty-state-icon"></i>
                            <h3 class="empty-state-title">Задач пока нет</h3>
                            <p class="empty-state-description">Создайте свою первую задачу</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Ошибка загрузки задач:', error);
            }
        }
        
        function renderRecentTasks(container) {
            if (!container || !userTasks || userTasks.length === 0) return;
            
            container.innerHTML = '';
            
            userTasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = 'card task-item';
                taskElement.style.cursor = 'pointer';
                taskElement.onclick = () => showTaskDetailsCompact(task.id);
                
                const statusText = getStatusText(task.status);
                const statusClass = task.status ? `task-status ${task.status}` : 'task-status';
                
                taskElement.innerHTML = `
                    <div class="task-header">
                        <div class="task-title">${task.title}</div>
                        <span class="${statusClass}">${statusText}</span>
                    </div>
                    <div style="color: var(--graphite-medium); font-size: 0.9rem; margin-bottom: 8px;">
                        ${task.category_name || ''}
                    </div>
                    <div style="color: var(--graphite-light); font-size: 0.8rem;">
                        <i class="far fa-calendar" style="margin-right: 8px;"></i>
                        ${new Date(task.created_at).toLocaleDateString('ru-RU')}
                    </div>
                `;
                container.appendChild(taskElement);
            });
        }
        
        // Загрузка задач пользователя с фильтрацией
        async function loadUserTasks(filter = 'all') {
            try {
                currentTaskFilter = filter;
                
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                const activeTab = document.querySelector(`.tab[onclick*="${filter}"]`);
                if (activeTab) {
                    activeTab.classList.add('active');
                }
                
                const response = await fetchWithAuth(`${API_BASE_URL}/api/tasks?status=${filter}`);
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        userTasks = result.data.tasks;
                        
                        renderUserTasksCards();
                        renderUserTasksTable();
                        return;
                    }
                }
                
                // Fallback на локальные данные
                const mockTasks = [
                    {
                        id: 1,
                        task_number: "TASK-001",
                        title: "Уборка 2-комнатной квартиры",
                        category_name: "Дом и быт",
                        status: "completed",
                        created_at: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                        price: null
                    },
                    {
                        id: 2,
                        task_number: "TASK-002",
                        title: "Няня для ребенка 5 лет",
                        category_name: "Семья и дети",
                        status: "in_progress",
                        created_at: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                        price: null
                    }
                ];
                
                let filteredTasks = mockTasks;
                if (filter !== 'all') {
                    filteredTasks = mockTasks.filter(task => task.status === filter);
                }
                
                userTasks = filteredTasks;
                
                renderUserTasksCards();
                renderUserTasksTable();
                
            } catch (error) {
                console.error('Ошибка загрузки задач:', error);
                showNotification('Ошибка загрузки задач', 'error');
            }
        }
        
        // Рендер карточек задач для мобильных
        function renderUserTasksCards() {
            const container = document.getElementById('userTasksCards');
            if (!container) return;
            
            if (!userTasks || userTasks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-tasks empty-state-icon"></i>
                        <h3 class="empty-state-title">Задач пока нет</h3>
                        <p class="empty-state-description">Создайте свою первую задачу, чтобы получить помощь от профессиональных помощниц</p>
                        <button class="btn btn-primary" onclick="checkSubscription()">
                            <i class="fas fa-plus"></i>
                            Создать задачу
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            userTasks.forEach(task => {
                const taskCard = document.createElement('div');
                taskCard.className = 'task-card';
                taskCard.onclick = () => showTaskDetailsCompact(task.id);
                
                const statusText = getStatusText(task.status);
                const statusClass = `status-${task.status}`;
                
                taskCard.innerHTML = `
                    <div class="task-card-row">
                        <div class="task-card-label">Номер:</div>
                        <div class="task-card-value">${task.task_number}</div>
                    </div>
                    <div class="task-card-row">
                        <div class="task-card-label">Задача:</div>
                        <div class="task-card-value">${task.title}</div>
                    </div>
                    <div class="task-card-row">
                        <div class="task-card-label">Категория:</div>
                        <div class="task-card-value">${task.category_name || ''}</div>
                    </div>
                    <div class="task-card-row">
                        <div class="task-card-label">Статус:</div>
                        <div class="task-card-value">
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                    </div>
                    <div class="task-card-row">
                        <div class="task-card-label">Создана:</div>
                        <div class="task-card-value">${new Date(task.created_at).toLocaleDateString('ru-RU')}</div>
                    </div>
                    <div class="task-card-actions">
                        <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); showTaskDetailsCompact(${task.id})">
                            <i class="fas fa-eye"></i> Подробнее
                        </button>
                    </div>
                `;
                
                container.appendChild(taskCard);
            });
        }
        
        // Рендер таблицы задач для десктопа
        function renderUserTasksTable() {
            const container = document.getElementById('userTasksTable');
            if (!container) return;
            
            if (!userTasks || userTasks.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            const table = document.createElement('table');
            table.className = 'task-history-table';
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Номер задачи</th>
                        <th>Название</th>
                        <th>Категория</th>
                        <th>Статус</th>
                        <th>Дата создания</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody>
                    ${userTasks.map(task => `
                        <tr>
                            <td>${task.task_number}</td>
                            <td>${task.title}</td>
                            <td>${task.category_name || ''}</td>
                            <td><span class="task-status ${task.status}">${getStatusText(task.status)}</span></td>
                            <td>${new Date(task.created_at).toLocaleDateString('ru-RU')}</td>
                            <td>
                                <button class="btn btn-secondary btn-sm" onclick="showTaskDetailsCompact(${task.id})" style="padding: 4px 8px; font-size: 0.8rem;">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            `;
            
            container.innerHTML = '';
            container.appendChild(table);
        }

        // Компактный просмотр задачи с API
        async function showTaskDetailsCompact(taskId) {
            try {
                showLoading('Загрузка задачи...');
                
                const response = await fetchWithAuth(`${API_BASE_URL}/api/tasks/${taskId}`);
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        const task = result.data.task;
                        
                        const chatResponse = await fetchWithAuth(`${API_BASE_URL}/api/tasks/${taskId}/messages`);
                        let messages = [];
                        
                        if (chatResponse.ok) {
                            const chatResult = await chatResponse.json();
                            if (chatResult.success) {
                                messages = chatResult.data.messages;
                            }
                        }
                        
                        renderTaskDetailsCompact(task, messages);
                        navigateToPage('task-details');
                        return;
                    }
                }
                
                // Fallback на локальные данные
                const mockTask = {
                    id: taskId,
                    task_number: `TASK-00${taskId}`,
                    title: "Уборка 2-комнатной квартиры",
                    description: "Полная уборка 2-комнатной квартиры площадью 60 кв.м.",
                    status: "in_progress",
                    category_name: "Дом и быт",
                    address: "ул. Примерная, д. 10, кв. 25",
                    deadline: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString(),
                    created_at: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString(),
                    created_at: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                    priority: "medium",
                    price: null,
                    additional_requirements: "Использовать гипоаллергенные средства для уборки.",
                    performer_first_name: "Анна",
                    performer_last_name: "Иванова",
                    performer_rating: "4.8",
                    performer_phone: "+7 (999) 123-45-67"
                };
                
                const mockMessages = [
                    {
                        id: 1,
                        message: "Здравствуйте! Когда можно приступить к работе?",
                        user_id: currentUser ? currentUser.id : 1,
                        first_name: currentUser ? currentUser.first_name : "Вы",
                        last_name: currentUser ? currentUser.last_name : "",
                        created_at: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                        is_read: true
                    }
                ];
                
                renderTaskDetailsCompact(mockTask, mockMessages);
                navigateToPage('task-details');
                
            } catch (error) {
                console.error('Ошибка загрузки задачи:', error);
                showNotification('Ошибка загрузки задачи', 'error');
            } finally {
                hideLoading();
            }
        }

        // Рендер деталей задачи
        function renderTaskDetailsCompact(task, messages) {
            const container = document.getElementById('taskCompactDetails');
            
            const statusInfo = getStatusInfo(task.status);
            const priorityInfo = {
                'low': {text: 'Низкий', color: '#4CAF50'},
                'medium': {text: 'Средний', color: '#FF9800'},
                'high': {text: 'Высокий', color: '#F44336'},
                'urgent': {text: 'Срочный', color: '#9C27B0'}
            }[task.priority] || {text: 'Средний', color: '#FF9800'};
            
            container.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
                    <div>
                        <h3 style="color: var(--graphite-dark); margin-bottom: 8px; font-size: 1.2rem;">${task.title}</h3>
                        <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                            <span class="status-badge status-${task.status}" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; background: ${statusInfo.color ? statusInfo.color + '15' : 'rgba(45,45,45,0.1)'}; color: ${statusInfo.color || 'var(--graphite-dark)'}">
                                <i class="${statusInfo.icon || 'fas fa-circle'}"></i>
                                ${statusInfo.name}
                            </span>
                            <span style="font-size: 0.9rem; color: var(--graphite-medium);">
                                <i class="far fa-calendar"></i> ${new Date(task.created_at).toLocaleDateString('ru-RU')}
                            </span>
                            <span style="font-size: 0.9rem; color: var(--graphite-medium);">
                                <i class="fas fa-hashtag"></i> ${task.task_number}
                            </span>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary-pink);">
                            ${task.price ? formatNumber(task.price) + ' ₽' : '<i class="fas fa-crown"></i> Включено в подписку'}
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px;">
                    <div>
                        <div style="font-size: 0.8rem; color: var(--graphite-medium); margin-bottom: 4px;">Категория</div>
                        <div style="font-weight: 500;">${task.category_name || '-'}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.8rem; color: var(--graphite-medium); margin-bottom: 4px;">Адрес</div>
                        <div style="font-weight: 500;">${task.address || '-'}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.8rem; color: var(--graphite-medium); margin-bottom: 4px;">Дедлайн</div>
                        <div style="font-weight: 500;">${new Date(task.deadline).toLocaleDateString('ru-RU')}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.8rem; color: var(--graphite-medium); margin-bottom: 4px;">Приоритет</div>
                        <div style="font-weight: 500; color: ${priorityInfo.color}">${priorityInfo.text}</div>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 0.8rem; color: var(--graphite-medium); margin-bottom: 8px;">Описание</div>
                    <div style="background: rgba(45,45,45,0.02); padding: 12px; border-radius: 8px; border: 1px solid rgba(45,45,45,0.05);">
                        ${task.description}
                    </div>
                </div>
                
                ${task.additional_requirements ? `
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 0.8rem; color: var(--graphite-medium); margin-bottom: 8px;">Дополнительные требования</div>
                    <div style="background: rgba(45,45,45,0.02); padding: 12px; border-radius: 8px; border: 1px solid rgba(45,45,45,0.05); font-size: 0.9rem;">
                        ${task.additional_requirements}
                    </div>
                </div>
                ` : ''}
                
                ${task.performer_first_name ? `
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 0.8rem; color: var(--graphite-medium); margin-bottom: 8px;">Исполнитель</div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--primary-gradient); 
                             display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">
                            ${task.performer_first_name.charAt(0)}
                        </div>
                        <div>
                            <div style="font-weight: 600;">${task.performer_first_name} ${task.performer_last_name || ''}</div>
                            <div style="font-size: 0.8rem; color: var(--graphite-medium);">
                                Рейтинг: ${task.performer_rating || 'Нет рейтинга'} | Телефон: ${task.performer_phone || 'скрыт'}
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}
                
                <div style="display: flex; gap: 10px; margin-top: 24px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="toggleTaskChat(${task.id})" id="toggleChatBtn" style="flex: 1;">
                        <i class="fas fa-comments"></i>
                        ${messages.length > 0 ? `Чат (${messages.length})` : 'Открыть чат'}
                    </button>
                    
                    ${task.status === 'new' || task.status === 'searching' || task.status === 'assigned' ? `
                    <button class="btn btn-secondary" onclick="updateTaskStatus(${task.id}, 'cancelled')">
                        <i class="fas fa-times"></i>
                        Отменить
                    </button>
                    ` : ''}
                    
                    ${(task.status === 'assigned' || task.status === 'in_progress') && currentUser?.role === 'client' ? `
                    <button class="btn btn-success" onclick="completeTask(${task.id})">
                        <i class="fas fa-check"></i>
                        Завершить
                    </button>
                    ` : ''}
                </div>
            `;
            
            currentChatTaskId = task.id;
            chatMessages = messages;
            
            if (messages.length > 0) {
                showInlineChat();
            }
            
            document.getElementById('chatHeaderTitle').textContent = `Чат по задаче: ${task.title.substring(0, 30)}${task.title.length > 30 ? '...' : ''}`;
        }

        // Переключение видимости чата
        function toggleTaskChat(taskId) {
            const chatSection = document.getElementById('taskChatSection');
            const toggleBtn = document.getElementById('toggleChatBtn');
            
            if (chatSection.style.display === 'none' || chatSection.style.display === '') {
                showInlineChat();
                if (toggleBtn) {
                    toggleBtn.innerHTML = '<i class="fas fa-times"></i> Скрыть чат';
                    toggleBtn.classList.remove('btn-primary');
                    toggleBtn.classList.add('btn-secondary');
                }
            } else {
                chatSection.style.display = 'none';
                if (toggleBtn) {
                    toggleBtn.innerHTML = '<i class="fas fa-comments"></i> Показать чат';
                    toggleBtn.classList.remove('btn-secondary');
                    toggleBtn.classList.add('btn-primary');
                }
            }
        }

        // Показать встроенный чат
        function showInlineChat() {
            const chatSection = document.getElementById('taskChatSection');
            const messagesContainer = document.getElementById('inlineChatMessages');
            
            chatSection.style.display = 'block';
            renderInlineChatMessages();
            
            setTimeout(() => {
                if (messagesContainer) {
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
            }, 100);
            
            setTimeout(() => {
                const input = document.getElementById('inlineChatMessage');
                if (input) {
                    input.focus();
                }
            }, 200);
        }

        // Рендер сообщений встроенного чата
        function renderInlineChatMessages() {
            const container = document.getElementById('inlineChatMessages');
            if (!container) return;
            
            if (chatMessages.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--graphite-medium);">
                        <i class="fas fa-comments" style="font-size: 2rem; opacity: 0.3; margin-bottom: 16px;"></i>
                        <p>Пока нет сообщений</p>
                        <p style="font-size: 0.9rem; margin-top: 8px;">Начните обсуждение задачи</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = chatMessages.map(msg => {
                const isCurrentUser = msg.user_id === currentUser?.id;
                const senderName = isCurrentUser 
                    ? 'Вы' 
                    : `${msg.first_name || 'Пользователь'} ${msg.last_name || ''}`;
                
                return `
                    <div style="display: flex; ${isCurrentUser ? 'justify-content: flex-end;' : ''} margin-bottom: 12px;">
                        <div style="max-width: 70%; ${isCurrentUser ? 'background: linear-gradient(135deg, var(--soft-pink), #E1C0D0);' : 'background: white; border: 1px solid rgba(45,45,45,0.1)'}; 
                             padding: 10px 14px; border-radius: 18px; ${isCurrentUser ? 'border-bottom-right-radius: 4px;' : 'border-bottom-left-radius: 4px;'} box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                            ${!isCurrentUser ? `
                                <div style="font-size: 0.75rem; font-weight: 600; color: var(--graphite-medium); margin-bottom: 4px;">
                                    ${senderName}
                                </div>
                            ` : ''}
                            <div style="margin-bottom: 4px; font-size: 0.9rem; line-height: 1.4;">${msg.message}</div>
                            <div style="font-size: 0.7rem; color: var(--graphite-light); text-align: ${isCurrentUser ? 'right' : 'left'}">
                                ${new Date(msg.created_at).toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'})}
                                ${msg.is_read && !isCurrentUser ? ' <i class="fas fa-check" style="color: var(--success); font-size: 0.6rem;"></i>' : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Отправка сообщения из встроенного чата с API
        async function sendInlineChatMessage() {
            if (!currentChatTaskId) return;
            
            const input = document.getElementById('inlineChatMessage');
            const message = input.value.trim();
            
            if (!message) return;
            
            const sendBtn = input.nextElementSibling;
            const originalHtml = sendBtn.innerHTML;
            sendBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            sendBtn.disabled = true;
            
            try {
                const response = await fetchWithAuth(`${API_BASE_URL}/api/tasks/${currentChatTaskId}/messages`, {
                    method: 'POST',
                    body: JSON.stringify({
                        message: message
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Ошибка отправки сообщения');
                }
                
                const newMessage = result.data.message;
                chatMessages.push(newMessage);
                
                input.value = '';
                renderInlineChatMessages();
                
                setTimeout(() => {
                    const container = document.getElementById('inlineChatMessages');
                    if (container) {
                        container.scrollTop = container.scrollHeight;
                    }
                }, 100);
                
                showNotification('Сообщение отправлено', 'success');
                
            } catch (error) {
                console.error('Ошибка отправки сообщения:', error);
                showNotification('Ошибка отправки сообщения', 'error');
            } finally {
                sendBtn.innerHTML = originalHtml;
                sendBtn.disabled = false;
                input.focus();
            }
        }

        // Обновление статуса задачи с API
        async function updateTaskStatus(taskId, status) {
            if (!confirm('Вы уверены, что хотите изменить статус задачи?')) {
                return;
            }
            
            try {
                showLoading('Обновление статуса...');
                
                const response = await fetchWithAuth(`${API_BASE_URL}/api/tasks/${taskId}/status`, {
                    method: 'PUT',
                    body: JSON.stringify({
                        status: status
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Ошибка обновления статуса');
                }
                
                showNotification('Статус задачи обновлен', 'success');
                
                setTimeout(() => {
                    showTaskDetailsCompact(taskId);
                }, 500);
                
            } catch (error) {
                console.error('Ошибка обновления статуса задачи:', error);
                showNotification(error.message, 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Завершение задачи с API
        async function completeTask(taskId) {
            if (!confirm('Вы уверены, что хотите отметить задачу как выполненную?')) {
                return;
            }
            
            try {
                showLoading('Завершение задачи...');
                
                const response = await fetchWithAuth(`${API_BASE_URL}/api/tasks/${taskId}/complete`, {
                    method: 'PUT'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Ошибка завершения задачи');
                }
                
                showNotification('Задача отмечена как выполненная', 'success');
                
                setTimeout(() => {
                    showTaskDetailsCompact(taskId);
                }, 500);
                
            } catch (error) {
                console.error('Ошибка завершения задачи:', error);
                showNotification(error.message, 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Получение текста статуса
        function getStatusText(status) {
            const statusMap = {
                'new': 'Новая',
                'searching': 'Поиск исполнителя',
                'assigned': 'Назначена',
                'in_progress': 'В работе',
                'completed': 'Выполнена',
                'cancelled': 'Отменена'
            };
            return statusMap[status] || status;
        }
        
        // Получение информации о статусе
        function getStatusInfo(status) {
            const statuses = {
                'new': { name: 'Новая', icon: 'fas fa-star', color: '#1976D2' },
                'searching': { name: 'Поиск исполнителя', icon: 'fas fa-search', color: '#FF9800' },
                'assigned': { name: 'Назначена', icon: 'fas fa-user-check', color: '#2196F3' },
                'in_progress': { name: 'В работе', icon: 'fas fa-cogs', color: '#673AB7' },
                'completed': { name: 'Выполнена', icon: 'fas fa-check-circle', color: '#4CAF50' },
                'cancelled': { name: 'Отменена', icon: 'fas fa-times-circle', color: '#F44336' }
            };
            return statuses[status] || { name: status, icon: 'fas fa-question-circle', color: '#9E9E9E' };
        }
        
        // Навигация на панель исполнителя
        function navigateToPerformerPanel() {
            window.location.href = '/performer.html';
        }
        
        // Функция входа с API
        async function login() {
            try {
                const phoneEmail = document.getElementById('loginPhoneInput').value;
                const password = document.getElementById('loginPasswordInput').value;
                
                if (!phoneEmail || !password) {
                    showNotification('Заполните все поля', 'error');
                    return;
                }
                
                const isPhone = /^[\+]?[0-9\s\-\(\)]+$/.test(phoneEmail.replace(/\s/g, ''));
                
                let loginData;
                if (isPhone) {
                    const normalizedPhone = normalizePhone(phoneEmail);
                    console.log('Введен телефон:', phoneEmail, 'Нормализован:', normalizedPhone);
                    loginData = { phone: normalizedPhone, password };
                } else {
                    loginData = { email: phoneEmail, password };
                }
                
                showLoading('Вход в систему...');
                
                const response = await fetch(`${API_BASE_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(loginData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error);
                }
                
                currentUser = result.data.user;
                currentToken = result.data.token;
                
                localStorage.setItem('token', currentToken);
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                showNotification('Успешный вход!', 'success');
                closeModal('loginModal');
                updateUserInterface();
                
                determineInitialScreen();
                
                setTimeout(() => {
                    showSubscriptionNotification();
                }, 1500);
                
            } catch (error) {
                console.error('Ошибка входа:', error);
                showNotification(error.message, 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Функция регистрации
        async function register() {
            try {
                const firstName = document.getElementById('registerFirstName').value;
                const lastName = document.getElementById('registerLastName').value;
                const email = document.getElementById('registerEmail').value;
                const phone = document.getElementById('registerPhone').value;
                const password = document.getElementById('registerPassword').value;
                
                if (!firstName || !phone || !password) {
                    showNotification('Заполните имя, телефон и пароль', 'error');
                    return;
                }
                
                const normalizedPhone = normalizePhone(phone);
                console.log('📱 Регистрация пользователя:', normalizedPhone);
                
                if (password.length < 6) {
                    showNotification('Пароль должен содержать не менее 6 символов', 'error');
                    return;
                }
                
                showLoading('Регистрация...');
                
                const response = await fetch(`${API_BASE_URL}/api/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        phone: normalizedPhone,
                        password: password,
                        first_name: firstName,
                        last_name: lastName,
                        email: email || null,
                        subscription_plan: 'essential'
                    })
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Ошибка регистрации:', errorText);
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error);
                }
                
                // Сохраняем пользователя (но не токен, т.к. его нет до подтверждения телефона)
                currentUser = result.data.user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                showNotification('Регистрация почти завершена! Подтвердите телефон.', 'info');
                closeModal('registerModal');
                
                // ВАЖНО: После регистрации сразу переходим к подтверждению телефона
                if (result.data.requires_phone_verification) {
                    console.log('📱 Требуется подтверждение телефона');
                    
                    // Открываем окно подтверждения
                    setTimeout(() => {
                        openVerifyPhoneModal(result.data.phone || normalizedPhone);
                        
                        // На этом этапе пользователь НЕ должен видеть главную
                        // Показываем auth страницу, но с другим сообщением
                        navigateToPage('auth');
                        
                        // Обновляем сообщение на auth странице
                        const authPage = document.getElementById('auth-page');
                        if (authPage) {
                            const authContent = authPage.querySelector('.auth-content');
                            if (authContent) {
                                authContent.innerHTML = `
                                    <div class="card auth-card">
                                        <div class="logo" style="justify-content: center; margin-bottom: 20px;">
                                            <span class="logo-woman">WOMAN</span>
                                            <span class="logo-help">HELP</span>
                                        </div>
                                        <i class="fas fa-mobile-alt auth-icon"></i>
                                        <h2 class="section-title">Подтверждение телефона</h2>
                                        <p class="section-subtitle">
                                            Мы отправили SMS с кодом на номер ${result.data.phone || normalizedPhone}<br>
                                            Введите код в открывшемся окне
                                        </p>
                                        <div class="auth-actions">
                                            <button class="btn btn-secondary" onclick="openVerifyPhoneModal('${result.data.phone || normalizedPhone}')">
                                                <i class="fas fa-redo"></i>
                                                Показать окно ввода кода
                                            </button>
                                        </div>
                                    </div>
                                `;
                            }
                        }
                    }, 500);
                }
                
            } catch (error) {
                console.error('Ошибка регистрации:', error);
                showNotification(error.message, 'error');
            } finally {
                hideLoading();
            }
        }
        
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('currentUser');
            currentToken = null;
            currentUser = null;
            updateUserInterface();
            showNotification('Вы успешно вышли из системы', 'success');
            navigateToPage('auth');
            closeUserMenu();
        }
        
        // Модальные окна
        function showLoginModal() {
            closeAllModals();
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.classList.add('active');
                document.getElementById('loginPhoneInput')?.focus();
            }
            closeUserMenu();
        }
        
        function showRegisterModal() {
            closeAllModals();
            const modal = document.getElementById('registerModal');
            if (modal) {
                modal.classList.add('active');
                document.getElementById('registerFirstName')?.focus();
            }
        }
        
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
            }
        }
        
        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('active');
            });
        }
        
        // Вспомогательные функции
        function formatNumber(num) {
            if (!num && num !== 0) return '0';
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
        }
        
        // Функция для автоматического форматирования телефона при вводе
        function formatPhoneInput(input) {
            if (input.id && (input.id.includes('Code') || input.id.includes('code'))) {
                return;
            }
            
            if (input.placeholder && (input.placeholder.includes('код') || input.placeholder.includes('Код'))) {
                return;
            }
            
            let value = input.value.replace(/\D/g, '');
            
            if (value.length > 0) {
                if (value.startsWith('7') || value.startsWith('8')) {
                    if (value.length === 1) {
                        input.value = '+7';
                    } else if (value.length <= 4) {
                        input.value = '+7 (' + value.substring(1, 4);
                    } else if (value.length <= 7) {
                        input.value = '+7 (' + value.substring(1, 4) + ') ' + value.substring(4, 7);
                    } else if (value.length <= 9) {
                        input.value = '+7 (' + value.substring(1, 4) + ') ' + value.substring(4, 7) + '-' + value.substring(7, 9);
                    } else {
                        input.value = '+7 (' + value.substring(1, 4) + ') ' + value.substring(4, 7) + '-' + value.substring(7, 9) + '-' + value.substring(9, 11);
                    }
                } else if (value.startsWith('9')) {
                    if (value.length <= 3) {
                        input.value = '+7 (' + value.substring(0, 3);
                    } else if (value.length <= 6) {
                        input.value = '+7 (' + value.substring(0, 3) + ') ' + value.substring(3, 6);
                    } else if (value.length <= 8) {
                        input.value = '+7 (' + value.substring(0, 3) + ') ' + value.substring(3, 6) + '-' + value.substring(6, 8);
                    } else {
                        input.value = '+7 (' + value.substring(0, 3) + ') ' + value.substring(3, 6) + '-' + value.substring(6, 8) + '-' + value.substring(8, 10);
                    }
                }
            }
        }

        // Функция для нормализации телефона
        function normalizePhone(phone) {
            if (!phone) return '';
            
            let cleaned = phone.replace(/\D/g, '');
            
            if (/^[78]\d{10}$/.test(cleaned)) {
                return '+7' + cleaned.substring(1);
            } else if (/^9\d{9}$/.test(cleaned)) {
                return '+7' + cleaned;
            } else if (cleaned.startsWith('7') || cleaned.startsWith('8')) {
                return '+' + cleaned;
            } else if (cleaned.startsWith('7')) {
                return '+' + cleaned;
            }
            
            return phone;
        }
        
        function showNotification(message, type = 'success') {
            const oldNotifications = document.querySelectorAll('.notification');
            oldNotifications.forEach(notif => notif.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = 'fas fa-check-circle';
            if (type === 'error') icon = 'fas fa-exclamation-circle';
            if (type === 'warning') icon = 'fas fa-exclamation-triangle';
            if (type === 'info') icon = 'fas fa-info-circle';
            
            notification.innerHTML = `
                <i class="${icon}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 5000);
        }
        
        function showLoading(message = 'Загрузка...') {
            const loadingEl = document.createElement('div');
            loadingEl.id = 'globalLoading';
            loadingEl.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(255, 255, 255, 0.9);
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                z-index: 9999;
            `;
            
            loadingEl.innerHTML = `
                <div class="spinner"></div>
                <p style="margin-top: 20px; color: var(--graphite-dark);">${message}</p>
            `;
            
            document.body.appendChild(loadingEl);
        }
        
        function hideLoading() {
            const loadingEl = document.getElementById('globalLoading');
            if (loadingEl) {
                loadingEl.remove();
            }
        }
        
        // Меню пользователя
        function toggleUserMenu() {
            const menu = document.getElementById('userMenu');
            if (menu) {
                menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
            }
        }
        
        function closeUserMenu() {
            const menu = document.getElementById('userMenu');
            if (menu) {
                menu.style.display = 'none';
            }
        }
        
        // Вспомогательные функции для страниц
        function filterTasks(status) {
            loadUserTasks(status);
        }
        
        function showHelp() {
            showNotification('Свяжитесь с поддержкой по email: support@womanhelp.ru', 'info');
            closeUserMenu();
        }

        // ==================== ПОП-АП ОКНО ЗАДАЧ ====================
        
        // Показать поп-ап окно с задачами
        function showTasksPopup() {
            closeUserMenu();
            const modal = document.getElementById('tasksPopupModal');
            if (modal) {
                modal.style.display = 'flex';
                loadPopupTasks();
            }
        }
        
        // Закрыть поп-ап окно с задачами
        function closeTasksPopup() {
            const modal = document.getElementById('tasksPopupModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // Загрузка задач для поп-ап окна
        async function loadPopupTasks() {
            try {
                const container = document.getElementById('popupTasksList');
                if (!container) return;
                
                container.innerHTML = '<div style="text-align: center; padding: 20px;"><div class="spinner"></div><p>Загрузка задач...</p></div>';
                
                await loadUserTasks(currentTaskFilter);
                
                renderPopupTasks();
            } catch (error) {
                console.error('Ошибка загрузки задач для поп-ап:', error);
                const container = document.getElementById('popupTasksList');
                if (container) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <i class="fas fa-exclamation-circle" style="font-size: 2rem; color: var(--graphite-light); margin-bottom: 16px;"></i>
                            <p style="color: var(--graphite-medium);">Ошибка загрузки задач</p>
                        </div>
                    `;
                }
            }
        }
        
        // Рендер задач в поп-ап окне
        function renderPopupTasks() {
            const container = document.getElementById('popupTasksList');
            if (!container || !userTasks) return;
            
            if (userTasks.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <i class="fas fa-tasks" style="font-size: 2rem; color: var(--graphite-light); margin-bottom: 16px;"></i>
                        <p style="color: var(--graphite-medium); margin-bottom: 20px;">Задач пока нет</p>
                        <button class="btn btn-primary" onclick="closeTasksPopup(); checkSubscription();">
                            <i class="fas fa-plus"></i>
                            Создать задачу
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            userTasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = 'task-quick-item';
                taskElement.onclick = () => {
                    closeTasksPopup();
                    showTaskDetailsCompact(task.id);
                };
                
                const statusText = getStatusText(task.status);
                const statusClass = `status-${task.status}`;
                
                taskElement.innerHTML = `
                    <div class="task-quick-header">
                        <div class="task-quick-title">${task.title}</div>
                        <span class="status-badge ${statusClass}">${statusText}</span>
                    </div>
                    <div class="task-quick-info">
                        <i class="fas fa-tag"></i> ${task.category_name || ''}
                    </div>
                    <div class="task-quick-date">
                        <i class="far fa-calendar"></i> ${new Date(task.created_at).toLocaleDateString('ru-RU')}
                    </div>
                `;
                
                container.appendChild(taskElement);
            });
        }
        
        // ==================== ФУНКЦИИ ДЛЯ ГАЙДОВ ====================
        
        function showGuide(guideId) {
            const guides = {
                'getting-started': {
                    title: 'Начало работы',
                    content: `
                        <h3>Как создать свою первую задачу:</h3>
                        <ol>
                            <li>Войдите в систему или зарегистрируйтесь</li>
                            <li>Выберите подходящую подписку</li>
                            <li>Перейдите в раздел "Услуги" или "Все услуги"</li>
                            <li>Выберите категорию и конкретную услугу</li>
                            <li>Заполните форму создания задачи с деталями</li>
                            <li>Нажмите "Создать задачу"</li>
                        </ol>
                        
                        <h3>Что происходит после создания задачи:</h3>
                        <ul>
                            <li>Задача публикуется в системе</li>
                            <li>Исполнительницы видят её в своих доступных задачах</li>
                            <li>Исполнительница принимает вашу задачу</li>
                            <li>Вы получаете уведомление о назначении</li>
                            <li>В чате задачи обсуждаете детали с исполнительницей</li>
                        </ul>
                        
                        <div class="mt-20">
                            <button class="btn btn-primary" onclick="navigateToPage('all-services')">
                                <i class="fas fa-play-circle"></i>
                                Начать сейчас
                            </button>
                        </div>
                    `
                },
                'tips': {
                    title: 'Советы по задачам',
                    content: `
                        <h3>Как правильно описать задачу:</h3>
                        <ul>
                            <li><strong>Будьте конкретны:</strong> Чем подробнее описание, тем точнее исполнитель поймет ваши ожидания</li>
                            <li><strong>Указывайте адрес точно:</strong> Включая подъезд, этаж, код домофона</li>
                            <li><strong>Определите приоритет:</strong> Выберите срочность задачи</li>
                            <li><strong>Укажите бюджет:</strong> Если у вас есть представление о стоимости</li>
                            <li><strong>Добавьте фото:</strong> Если задача требует визуализации</li>
                        </ul>
                        
                        <h3>Как работать с исполнительницами:</h3>
                        <ul>
                            <li>Отвечайте на сообщения в чате своевременно</li>
                            <li>Будьте вежливы и уважительны</li>
                            <li>Заранее обсудите все детали</li>
                            <li><strong>Будьте готовы предоставить доступ:</strong> Убедитесь, что исполнительница может попасть по указанному адресу</li>
                            <li><strong>Оценивайте работу:</strong> После выполнения задачи оставьте честный отзыв</li>
                        </ul>
                        
                        <div class="mt-20">
                            <button class="btn btn-primary" onclick="navigateToPage('all-services')">
                                <i class="fas fa-plus"></i>
                                Создать свою задачу
                            </button>
                        </div>
                    `
                },
                'safety': {
                    title: 'Безопасность',
                    content: `
                        <h3>Основные правила безопасности:</h3>
                        <ul>
                            <li><strong>Проверяйте рейтинг:</strong> Выбирайте исполнительниц с высоким рейтингом и отзывами</li>
                            <li><strong>Не передавайте деньги заранее:</strong> Все платежи обрабатываются через защищенную систему</li>
                            <li><strong>Храните ценности:</strong> Уберите ценные вещи перед визитом помощницы</li>
                            <li><strong>Используйте наш чат:</strong> Все общение должно происходить через встроенный чат</li>
                            <li><strong>Сообщайте о проблемах:</strong> Если что-то пошло не так, немедленно свяжитесь с поддержкой</li>
                        </ul>
                        
                        <h3>Безопасность при передаче доступа:</h3>
                        <ul>
                            <li>Предоставляйте доступ только на время выполнения работы</li>
                            <li>Используйте временные коды для домофонов</li>
                            <li>Не сообщайте постоянные пароли</li>
                            <li>Присутствуйте при выполнении работ, если это возможно</li>
                        </ul>
                        
                        <div class="mt-20">
                            <button class="btn btn-primary" onclick="showHelp()">
                                <i class="fas fa-shield-alt"></i>
                                Связаться со службой безопасности
                            </button>
                        </div>
                    `
                }
            };

            if (guides[guideId]) {
                const guide = guides[guideId];
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.id = 'guideModal';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 class="modal-title">${guide.title}</h3>
                            <button class="close-popup-btn" onclick="closeGuideModal()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div style="margin-bottom: 20px;">
                            ${guide.content}
                        </div>
                        <button class="btn btn-primary" onclick="closeGuideModal()" style="width: 100%;">
                            <i class="fas fa-check"></i>
                            Закрыть
                        </button>
                    </div>
                `;
                document.body.appendChild(modal);
                modal.style.display = 'flex';
            }
        }

        function closeGuideModal() {
            const modal = document.getElementById('guideModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // ==================== ИНИЦИАЛИЗАЦИЯ ====================
        
        // Инициализация при загрузке страницы
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('🌐 WOMAN HELP v2.0 - Инициализация...');
            
            // Инициализация счетчиков статистики
            animateCounters();
            
            // Загружаем логотип
            await loadLogo();
            
            // Загружаем данные
            await checkAuth();
            await loadCategories();
            await loadAllServices();
            await loadSubscriptions();
            
            // Устанавливаем обработчики событий
            setupEventListeners();
            
            // Устанавливаем начальную страницу
            determineInitialScreen();
            
            // Устанавливаем минимальную дату для deadline
            const deadlineInput = document.getElementById('taskDeadline');
            if (deadlineInput) {
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                deadlineInput.min = new Date().toISOString().split('T')[0];
                deadlineInput.value = tomorrow.toISOString().split('T')[0];
            }
            
            updateUserInterface();
            
            console.log('✅ WOMAN HELP готов к работе!');
            
            setTimeout(() => {
                if (!currentUser) {
                    console.log('👋 Добро пожаловать в WOMAN HELP!');
                }
            }, 1000);
        });

        // ==================== ПУБЛИЧНЫЕ ФУНКЦИИ ДЛЯ HTML ====================
        window.showLoginModal = showLoginModal;
        window.showRegisterModal = showRegisterModal;
        window.navigateToPage = navigateToPage;
        window.showTasksPopup = showTasksPopup;
        window.checkSubscription = checkSubscription;
        window.showTaskDetailsCompact = showTaskDetailsCompact;
        window.openSendCodeModal = openSendCodeModal;
        window.sendVerificationCode = sendVerificationCode;
        window.verifyPhoneCode = verifyPhoneCode;
        window.selectSubscription = selectSubscription;
        window.showGuide = showGuide;
        window.closeGuideModal = closeGuideModal;
        window.filterServices = filterServices;
        window.setServiceFilter = setServiceFilter;
        window.selectCategory = selectCategory;
        window.selectService = selectService;
        window.cancelTask = cancelTask;
        window.showHelp = showHelp;
        window.navigateToPerformerPanel = navigateToPerformerPanel;
        window.logout = logout;
        window.openVerifyPhoneModal = openVerifyPhoneModal;
        window.filterTasks = filterTasks;
        window.toggleTaskChat = toggleTaskChat;
        window.sendInlineChatMessage = sendInlineChatMessage;
        window.updateTaskStatus = updateTaskStatus;
        window.completeTask = completeTask;
        window.closeTasksPopup = closeTasksPopup;

        // ==================== ПУБЛИЧНЫЕ ФУНКЦИИ ДЛЯ ПАНЕЛИ ИСПОЛНИТЕЛЯ ====================
        window.performerLogin = performerLogin;
        window.loadAvailableTasksForPerformer = loadAvailableTasksForPerformer;

        // Общие функции для доступа из других файлов
        window.showNotification = showNotification;
        window.showLoading = showLoading;
        window.hideLoading = hideLoading;

        // Экспортируем данные для отладки
        window.currentUser = currentUser;
        window.categories = categories;
        window.services = services;
        window.allServices = allServices;
        window.userTasks = userTasks;
    </script>
</body>
</html> 
