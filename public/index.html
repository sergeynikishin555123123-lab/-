<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>üéÄ –ñ–µ–Ω—Å–∫–∏–π –ö–æ–Ω—Å—å–µ—Ä–∂ | –ü—Ä–µ–º–∏—É–º —Å–µ—Ä–≤–∏—Å –¥–ª—è –∂–µ–Ω—â–∏–Ω</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ */
        :root {
            --ivory-bg: #F9F7F3;
            --graphite-dark: #3D3D3D;
            --graphite-medium: #5A5A5A;
            --graphite-light: #8A8A8A;
            --pastel-pink: #F2DDE6;
            --pink-light: #FAEFF5;
            --gold-metallic: #C5A880;
            --gold-dark: #A78B65;
            --lavender: #B9AFFF;
            --lavender-light: #E0DDFF;
            --aquamarine: #7FE0D1;
            --aqua-dark: #5AC8B7;
            --white: #FFFFFF;
            --success: #38B2AC;
            --warning: #ED8936;
            --error: #FC8181;
            --info: #4299E1;
            
            --shadow-sm: 0 2px 8px rgba(61, 61, 61, 0.05);
            --shadow: 0 4px 16px rgba(61, 61, 61, 0.08);
            --shadow-lg: 0 8px 32px rgba(61, 61, 61, 0.12);
            --shadow-xl: 0 20px 40px rgba(61, 61, 61, 0.15);
            
            --radius-sm: 8px;
            --radius: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-full: 9999px;
            
            --transition-fast: 0.15s ease;
            --transition: 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 0.4s ease;
            
            --nav-height: 70px;
            --bottom-nav-height: 60px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--ivory-bg);
            color: var(--graphite-dark);
            line-height: 1.6;
            min-height: 100vh;
            font-weight: 400;
            padding-top: var(--nav-height);
            padding-bottom: var(--bottom-nav-height);
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 16px;
            width: 100%;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è —Å–≤–µ—Ä—Ö—É */
        .top-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--nav-height);
            background: var(--white);
            border-bottom: 1px solid rgba(61, 61, 61, 0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }
        
        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--graphite-dark);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            color: var(--gold-metallic);
            font-size: 1.8rem;
        }
        
        .user-avatar {
            width: 42px;
            height: 42px;
            background: linear-gradient(135deg, var(--lavender-light), var(--pastel-pink));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--graphite-dark);
            font-weight: 600;
            border: 2px solid rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .user-avatar:hover {
            transform: scale(1.05);
        }
        
        .user-menu {
            display: none;
            position: absolute;
            top: 70px;
            right: 20px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-xl);
            padding: 10px;
            min-width: 200px;
            z-index: 1001;
            border: 1px solid rgba(61, 61, 61, 0.1);
            animation: fadeIn 0.2s ease;
        }
        
        .nav-menu-item {
            display: flex;
            align-items: center;
            padding: 10px;
            text-decoration: none;
            color: var(--graphite-dark);
            border-radius: var(--radius-sm);
            transition: var(--transition-fast);
            gap: 10px;
            width: 100%;
        }
        
        .nav-menu-item:hover {
            background: rgba(61, 61, 61, 0.05);
        }
        
        /* –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--bottom-nav-height);
            background: var(--white);
            border-top: 1px solid rgba(61, 61, 61, 0.08);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 10px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.98);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: var(--graphite-medium);
            padding: 8px 12px;
            border-radius: var(--radius);
            transition: var(--transition-fast);
            min-width: 70px;
            cursor: pointer;
        }
        
        .nav-item.active {
            color: var(--gold-metallic);
            background: rgba(197, 168, 128, 0.08);
        }
        
        .nav-item i {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }
        
        .nav-item span {
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .page {
            display: none;
            animation: fadeIn 0.3s ease;
            min-height: calc(100vh - var(--nav-height) - var(--bottom-nav-height));
            padding: 20px 0;
            width: 100%;
        }
        
        .page.active {
            display: block;
        }
        
        /* –°–µ–∫—Ü–∏–∏ */
        .section {
            margin-bottom: 30px;
            width: 100%;
        }
        
        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--graphite-dark);
            margin-bottom: 20px;
        }
        
        .section-subtitle {
            font-size: 1rem;
            color: var(--graphite-medium);
            margin-bottom: 24px;
            line-height: 1.5;
        }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 20px;
            border: 1px solid rgba(61, 61, 61, 0.08);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            width: 100%;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--gold-metallic), var(--gold-dark));
            color: white;
            box-shadow: 0 4px 12px rgba(197, 168, 128, 0.3);
        }
        
        .btn-secondary {
            background: white;
            color: var(--graphite-dark);
            border: 2px solid rgba(61, 61, 61, 0.1);
        }
        
        /* Hero —Å–µ–∫—Ü–∏—è */
        .hero {
            background: linear-gradient(135deg, rgba(249, 247, 243, 0.9), rgba(250, 239, 245, 0.7));
            border-radius: var(--radius-xl);
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .hero:before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200px;
            height: 200px;
            background: linear-gradient(135deg, var(--lavender-light), transparent);
            border-radius: 50%;
            opacity: 0.3;
        }
        
        .hero:after {
            content: '';
            position: absolute;
            bottom: -30%;
            left: -30%;
            width: 150px;
            height: 150px;
            background: linear-gradient(135deg, transparent, var(--pastel-pink));
            border-radius: 50%;
            opacity: 0.3;
        }
        
        .hero-content {
            position: relative;
            z-index: 1;
        }
        
        .hero h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--graphite-dark);
            line-height: 1.2;
        }
        
        .hero p {
            font-size: 1.1rem;
            color: var(--graphite-medium);
            margin-bottom: 24px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* –°–µ—Ç–∫–∏ */
        .grid {
            display: grid;
            gap: 16px;
            width: 100%;
        }
        
        .grid-2 {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        }
        
        /* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ */
        .category-card {
            text-align: center;
            padding: 20px 16px;
            cursor: pointer;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .category-icon {
            font-size: 2.5rem;
            color: var(--gold-metallic);
            margin-bottom: 12px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .category-card h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .category-card p {
            color: var(--graphite-medium);
            font-size: 0.85rem;
            margin-bottom: 16px;
            flex-grow: 1;
        }
        
        /* –£—Å–ª—É–≥–∏ */
        .service-card {
            padding: 16px;
            cursor: pointer;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }
        
        .service-header h4 {
            font-size: 1.1rem;
            font-weight: 600;
            flex: 1;
            margin-right: 10px;
        }
        
        .service-description {
            color: var(--graphite-medium);
            font-size: 0.9rem;
            margin-bottom: 16px;
            line-height: 1.4;
            flex-grow: 1;
        }
        
        .service-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }
        
        .service-price {
            color: var(--success);
            font-weight: 600;
            font-size: 0.9rem;
            background: rgba(56, 178, 172, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
        }
        
        /* –ü—Ä–æ—Ñ–∏–ª—å */
        .profile-header {
            background: linear-gradient(135deg, var(--gold-metallic), var(--gold-dark));
            color: white;
            padding: 30px 20px;
            border-radius: var(--radius-xl);
            margin-bottom: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .profile-avatar {
            width: 100px;
            height: 100px;
            background: white;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gold-metallic);
            font-size: 2.5rem;
            font-weight: 700;
            border: 4px solid rgba(255, 255, 255, 0.3);
        }
        
        .profile-name {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .profile-email {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 16px;
        }
        
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 12px;
            border-radius: var(--radius);
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }
        
        /* –ü–æ–¥–ø–∏—Å–∫–∏ */
        .subscription-card {
            padding: 24px 20px;
            text-align: center;
            border: 2px solid rgba(61, 61, 61, 0.1);
            position: relative;
            cursor: pointer;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .subscription-card.popular {
            border-color: var(--gold-metallic);
        }
        
        .popular-badge {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gold-metallic);
            color: white;
            padding: 4px 16px;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .subscription-card h3 {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .subscription-price {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gold-metallic);
            margin: 16px 0;
        }
        
        .subscription-price span {
            font-size: 0.9rem;
            color: var(--graphite-medium);
        }
        
        .subscription-features {
            text-align: left;
            margin: 20px 0;
            flex-grow: 1;
        }
        
        .subscription-features li {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--graphite-medium);
            font-size: 0.9rem;
        }
        
        .subscription-features i {
            color: var(--success);
            font-size: 0.9rem;
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 100px;
            right: 16px;
            z-index: 3000;
            background: white;
            border-radius: var(--radius);
            padding: 16px;
            box-shadow: var(--shadow-lg);
            border-left: 4px solid var(--success);
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 90%;
            width: 350px;
        }
        
        .notification.error {
            border-left-color: var(--error);
        }
        
        .notification.warning {
            border-left-color: var(--warning);
        }
        
        .notification.info {
            border-left-color: var(--info);
        }
        
        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        .loader {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(61, 61, 61, 0.1);
            border-top: 4px solid var(--gold-metallic);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: var(--radius-lg);
            max-width: 400px;
            width: 100%;
            animation: modalSlideIn 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--graphite-dark);
        }
        
        .form-group {
            margin-bottom: 20px;
            width: 100%;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--graphite-dark);
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 1.5px solid rgba(61, 61, 61, 0.1);
            border-radius: var(--radius-sm);
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--gold-metallic);
            box-shadow: 0 0 0 3px rgba(197, 168, 128, 0.15);
        }
        
        /* –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ */
        .create-task-form {
            margin-top: 20px;
        }
        
        /* –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á */
        .task-list {
            margin-top: 20px;
        }
        
        .task-item {
            margin-bottom: 16px;
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .task-title {
            font-weight: 600;
            font-size: 1.1rem;
            flex: 1;
        }
        
        .task-status {
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .task-status.new {
            background: #E3F2FD;
            color: #1976D2;
        }
        
        .task-status.in_progress {
            background: #FFF3E0;
            color: #EF6C00;
        }
        
        .task-status.completed {
            background: #E8F5E9;
            color: #2E7D32;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .container {
                padding: 0 12px;
            }
            
            .hero h1 {
                font-size: 1.8rem;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
            
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .grid-3 {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .profile-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .subscription-card {
                margin-bottom: 20px;
            }
            
            /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∑–∞–¥–∞—á –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            .task-detail-grid {
                grid-template-columns: 1fr !important;
                gap: 10px !important;
            }
            
            .task-quick-item {
                padding: 12px !important;
                margin-bottom: 8px !important;
            }
            
            .task-quick-header {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 8px !important;
            }
            
            .action-buttons {
                flex-wrap: wrap !important;
                gap: 5px !important;
            }
            
            .btn {
                padding: 8px 12px !important;
                font-size: 0.85rem !important;
            }
            
            .table-container {
                overflow-x: auto;
                font-size: 0.85rem;
            }
            
            table {
                min-width: 600px;
            }
            
            .modal-content {
                padding: 20px !important;
                margin: 10px !important;
            }
            
            .chat-modal-content {
                height: 90vh !important;
                max-width: 100% !important;
                margin: 0 !important;
                border-radius: 0 !important;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 0 8px !important;
            }
            
            .hero {
                padding: 20px;
            }
            
            .hero h1 {
                font-size: 1.6rem;
            }
            
            .section-title {
                font-size: 1.4rem !important;
            }
            
            .grid-3 {
                grid-template-columns: 1fr;
            }
            
            .profile-stats {
                grid-template-columns: 1fr;
                gap: 8px !important;
            }
            
            .stat-item {
                padding: 10px !important;
            }
            
            .nav-item span {
                font-size: 0.7rem;
            }
            
            .nav-item i {
                font-size: 1rem !important;
                margin-bottom: 2px !important;
            }
            
            .notification {
                width: 90%;
                right: 5%;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .bottom-nav {
                height: 55px !important;
                padding: 0 5px !important;
            }
            
            .nav-item span {
                font-size: 0.65rem !important;
            }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–ª–∞–Ω—à–µ—Ç–æ–≤ */
        @media (min-width: 769px) and (max-width: 1024px) {
            .grid-3 {
                grid-template-columns: repeat(2, 1fr) !important;
            }
            
            .container {
                padding: 0 16px !important;
            }
        }
        
        /* –•–æ–≤–µ—Ä—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ */
        @media (min-width: 1025px) {
            .card:hover {
                transform: translateY(-4px);
                box-shadow: var(--shadow);
            }
            
            .btn:hover {
                transform: translateY(-2px);
            }
            
            .btn-primary:hover {
                box-shadow: 0 8px 20px rgba(197, 168, 128, 0.4);
            }
            
            .btn-secondary:hover {
                background: rgba(61, 61, 61, 0.02);
                border-color: var(--graphite-light);
                transform: translateY(-1px);
            }
        }
        
        /* –ê–¥–º–∏–Ω –∫–Ω–æ–ø–∫–∞ */
        .admin-access-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            z-index: 1000;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--gold-metallic), var(--gold-dark));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(197, 168, 128, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(197, 168, 128, 0); }
            100% { box-shadow: 0 0 0 0 rgba(197, 168, 128, 0); }
        }
        
        /* –£—Ç–∏–ª–∏—Ç—ã */
        .text-center {
            text-align: center;
        }
        
        .mt-20 {
            margin-top: 20px;
        }
        
        .mb-20 {
            margin-bottom: 20px;
        }
        
        .w-100 {
            width: 100%;
        }
        
        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —Ç–µ–∫—Å—Ç–∞ */
        a {
            text-decoration: none;
            color: inherit;
        }
        
        button {
            font-family: 'Inter', sans-serif;
        }
        
        /* –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã */
        ::placeholder {
            color: var(--graphite-light);
            opacity: 0.7;
        }
        
        /* –§–æ–∫—É—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è */
        :focus {
            outline: 2px solid var(--gold-metallic);
            outline-offset: 2px;
        }
        
        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--ivory-bg);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--gold-metallic);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--gold-dark);
        }
        
        /* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
        .auth-screen {
            min-height: 70vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .auth-content {
            text-align: center;
            max-width: 400px;
            margin: 0 auto;
            width: 100%;
        }
        
        .auth-card {
            padding: 40px 30px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
        }
        
        .auth-icon {
            font-size: 4rem;
            color: var(--gold-metallic);
            margin-bottom: 20px;
        }
        
        .auth-actions {
            margin-top: 30px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .task-history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .task-history-table th {
            background: rgba(61, 61, 61, 0.05);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: var(--graphite-dark);
            border-bottom: 2px solid rgba(61, 61, 61, 0.1);
        }
        
        .task-history-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(61, 61, 61, 0.08);
            vertical-align: top;
        }
        
        .task-history-table tr:hover {
            background: rgba(61, 61, 61, 0.02);
        }
        
        /* –¢–∞–±—ã –¥–ª—è –∑–∞–¥–∞—á */
        .tabs {
            display: flex;
            border-bottom: 1px solid rgba(61, 61, 61, 0.1);
            margin-bottom: 20px;
            overflow-x: auto;
        }
        
        .tab {
            padding: 12px 20px;
            font-weight: 500;
            color: var(--graphite-medium);
            border-bottom: 3px solid transparent;
            cursor: pointer;
            white-space: nowrap;
            transition: var(--transition-fast);
        }
        
        .tab.active {
            color: var(--gold-metallic);
            border-bottom-color: var(--gold-metallic);
        }
        
        /* –î–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏ */
        .task-details {
            background: white;
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid rgba(61, 61, 61, 0.08);
        }
        
        /* –ü—É—Å—Ç—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }
        
        .empty-state-icon {
            font-size: 4rem;
            color: rgba(61, 61, 61, 0.1);
            margin-bottom: 20px;
        }
        
        .empty-state-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--graphite-dark);
            margin-bottom: 10px;
        }
        
        .empty-state-description {
            color: var(--graphite-medium);
            max-width: 300px;
            margin: 0 auto 20px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —á–∞—Ç–∞ –≤ –¥–µ—Ç–∞–ª—è—Ö –∑–∞–¥–∞—á–∏ */
        .chat-container {
            background: white;
            border-radius: var(--radius-lg);
            border: 1px solid rgba(61, 61, 61, 0.08);
            overflow: hidden;
            margin-top: 24px;
        }
        
        .chat-header {
            padding: 16px 20px;
            background: var(--pink-light);
            border-bottom: 1px solid rgba(61, 61, 61, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--graphite-dark);
        }
        
        .chat-messages-container {
            height: 400px;
            overflow-y: auto;
            padding: 20px;
            background: rgba(249, 247, 243, 0.5);
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .chat-message {
            display: flex;
            max-width: 80%;
            animation: fadeInMessage 0.3s ease;
        }
        
        .chat-message.sent {
            margin-left: auto;
            flex-direction: row-reverse;
        }
        
        .message-bubble {
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            box-shadow: var(--shadow-sm);
            word-break: break-word;
        }
        
        .chat-message.sent .message-bubble {
            background: linear-gradient(135deg, var(--pastel-pink), #F0C8DE);
            color: var(--graphite-dark);
            border-bottom-right-radius: 4px;
        }
        
        .chat-message.received .message-bubble {
            background: white;
            border: 1px solid rgba(61, 61, 61, 0.1);
            color: var(--graphite-dark);
            border-bottom-left-radius: 4px;
        }
        
        .message-sender {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--graphite-medium);
        }
        
        .chat-message.sent .message-sender {
            text-align: right;
        }
        
        .message-time {
            font-size: 0.7rem;
            color: var(--graphite-light);
            margin-top: 4px;
        }
        
        .chat-message.sent .message-time {
            text-align: right;
        }
        
        .chat-input-area {
            padding: 16px 20px;
            border-top: 1px solid rgba(61, 61, 61, 0.08);
            background: white;
            display: flex;
            gap: 10px;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid rgba(61, 61, 61, 0.1);
            border-radius: 24px;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            resize: none;
            min-height: 48px;
            max-height: 120px;
            transition: var(--transition);
        }
        
        .chat-input:focus {
            outline: none;
            border-color: var(--gold-metallic);
            box-shadow: 0 0 0 3px rgba(197, 168, 128, 0.1);
        }
        
        .send-message-btn {
            background: linear-gradient(135deg, var(--gold-metallic), var(--gold-dark));
            color: white;
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .send-message-btn:disabled {
            background: var(--graphite-light);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .no-messages {
            text-align: center;
            padding: 40px 20px;
            color: var(--graphite-medium);
        }
        
        .no-messages i {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.3;
        }
        
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 8px 16px;
            background: white;
            border: 1px solid rgba(61, 61, 61, 0.1);
            border-radius: 16px;
            width: fit-content;
            margin-top: 8px;
        }
        
        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: var(--graphite-light);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-6px); }
        }
        
        @keyframes fadeInMessage {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á (–ø–æ–ø-–∞–ø –æ–∫–Ω–∞) */
        .tasks-popup-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }
        
        .tasks-popup-content {
            background: white;
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            animation: popupSlideIn 0.3s ease;
        }
        
        @keyframes popupSlideIn {
            from { opacity: 0; transform: translateY(-20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .tasks-popup-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--gold-metallic), var(--gold-dark));
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .tasks-popup-header h3 {
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .close-popup-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .tasks-popup-body {
            padding: 20px;
            max-height: calc(80vh - 80px);
            overflow-y: auto;
        }
        
        .task-quick-item {
            padding: 16px;
            border: 1px solid rgba(61, 61, 61, 0.08);
            border-radius: var(--radius);
            margin-bottom: 12px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .task-quick-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .task-quick-title {
            font-weight: 600;
            font-size: 1rem;
        }
        
        .task-quick-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .task-quick-info {
            color: var(--graphite-medium);
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .task-quick-date {
            color: var(--graphite-light);
            font-size: 0.8rem;
        }
        
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –∑–∞–¥–∞—á–∏ */
        .task-detail-section {
            margin-bottom: 30px;
        }
        
        .task-detail-section h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--graphite-dark);
            padding-bottom: 8px;
            border-bottom: 2px solid var(--lavender-light);
        }
        
        .task-detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .task-detail-item {
            background: rgba(61, 61, 61, 0.02);
            padding: 16px;
            border-radius: var(--radius);
            border: 1px solid rgba(61, 61, 61, 0.05);
        }
        
        .task-detail-item h4 {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--graphite-medium);
            margin-bottom: 8px;
        }
        
        .task-detail-item p {
            color: var(--graphite-dark);
            font-size: 1rem;
            line-height: 1.4;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–¥–∞—á */
        .quick-tasks-btn {
            position: fixed;
            bottom: 80px;
            left: 20px;
            z-index: 1000;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--gold-metallic), var(--gold-dark));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            animation: pulse 2s infinite;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ –ø–∞–Ω–µ–ª–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è */
        .performer-access-btn {
            position: fixed;
            bottom: 140px;
            right: 20px;
            z-index: 1000;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #3498DB, #2980B9);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            animation: pulse 2s infinite;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ —á–∞—Ç–∞ */
        .chat-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            padding: 20px;
        }
        
        .chat-modal-content {
            background: white;
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 800px;
            height: 80vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: var(--shadow-xl);
        }
    </style>
</head>
<body>
    <!-- –í–µ—Ä—Ö–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="top-nav">
        <a href="#" class="logo" onclick="navigateToPage('home')">
            <i class="fas fa-crown logo-icon"></i>
            <span>–ö–æ–Ω—Å—å–µ—Ä–∂</span>
        </a>
        
        <div class="user-avatar" id="userAvatar" onclick="toggleUserMenu()">
            –ì
        </div>
        
        <!-- –ú–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div class="user-menu" id="userMenu">
            <div style="padding: 10px; border-bottom: 1px solid rgba(61, 61, 61, 0.1);">
                <div style="font-weight: 600;" id="menuUserName">–ì–æ—Å—Ç—å</div>
                <div style="font-size: 0.9rem; color: var(--graphite-medium);" id="menuUserEmail"></div>
            </div>
            <div style="padding: 5px 0;">
                <a href="#" class="nav-menu-item" onclick="navigateToPage('profile')">
                    <i class="fas fa-user"></i>–ü—Ä–æ—Ñ–∏–ª—å
                </a>
                <a href="#" class="nav-menu-item" onclick="showTasksPopup()">
                    <i class="fas fa-tasks"></i>–ú–æ–∏ –∑–∞–¥–∞—á–∏
                </a>
                <a href="#" class="nav-menu-item" onclick="navigateToPerformerPanel()" id="performerPanelLink" style="display: none;">
                    <i class="fas fa-user-tie"></i>–ü–∞–Ω–µ–ª—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
                </a>
                <a href="#" class="nav-menu-item" onclick="showLoginModal()" id="loginMenuBtn">
                    <i class="fas fa-sign-in-alt"></i>–í–æ–π—Ç–∏
                </a>
                <a href="#" class="nav-menu-item" onclick="logout()" id="logoutMenuBtn" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i>–í—ã–π—Ç–∏
                </a>
            </div>
        </div>
    </nav>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (—Å—Ç—Ä–∞–Ω–∏—Ü—ã) -->
    <main>
        <!-- –≠–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö) -->
        <div id="auth-page" class="page active">
            <div class="container auth-screen">
                <div class="auth-content">
                    <div class="card auth-card">
                        <i class="fas fa-crown auth-icon"></i>
                        <h2 class="section-title">–ñ–µ–Ω—Å–∫–∏–π –ö–æ–Ω—Å—å–µ—Ä–∂</h2>
                        <p class="section-subtitle">–ü—Ä–µ–º–∏—É–º —Å–µ—Ä–≤–∏—Å –ø–æ–º–æ—â–∏ –¥–ª—è –∂–µ–Ω—â–∏–Ω. –û—Å—Ç–∞–≤–ª—è–π—Ç–µ –±—ã—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∞–º –∏ –Ω–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å —Å–≤–æ–±–æ–¥–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º.</p>
                        
                        <!-- –í auth-actions –∑–∞–º–µ–Ω–∏—Ç–µ -->
<div class="auth-actions">
    <button class="btn btn-primary" onclick="window.showLoginModal()">
        <i class="fas fa-sign-in-alt"></i>
        –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
    </button>
    <button class="btn btn-secondary" onclick="window.showRegisterModal()">
        <i class="fas fa-user-plus"></i>
        –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
    </button>
</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –ø–æ–¥–ø–∏—Å–∫–∏ (–¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏) -->
        <div id="subscription-required-page" class="page">
            <div class="container auth-screen">
                <div class="auth-content">
                    <div class="card auth-card">
                        <i class="fas fa-crown auth-icon"></i>
                        <h2 class="section-title">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å–∫–∞</h2>
                        <p class="section-subtitle">–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º —Å–µ—Ä–≤–∏—Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</p>
                        
                        <div class="mb-20" style="text-align: left; background: rgba(197, 168, 128, 0.05); padding: 16px; border-radius: var(--radius);">
                            <p style="margin-bottom: 10px;"><i class="fas fa-check" style="color: var(--success); margin-right: 8px;"></i> –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á</p>
                            <p style="margin-bottom: 10px;"><i class="fas fa-check" style="color: var(--success); margin-right: 8px;"></i> –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —É—Å–ª—É–≥</p>
                            <p style="margin-bottom: 10px;"><i class="fas fa-check" style="color: var(--success); margin-right: 8px;"></i> –õ–∏—á–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ 24/7</p>
                            <p><i class="fas fa-check" style="color: var(--success); margin-right: 8px;"></i> –ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ —É—Å–ª—É–≥</p>
                        </div>
                        
                        <div class="auth-actions">
                            <button class="btn btn-primary" onclick="navigateToPage('subscription')">
                                <i class="fas fa-crown"></i>
                                –í—ã–±—Ä–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
                            </button>
                            <button class="btn btn-secondary" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i>
                                –í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Å –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–æ–π) -->
        <div id="home-page" class="page">
            <div class="container">
                <!-- Hero —Å–µ–∫—Ü–∏—è -->
                <section class="hero">
                    <div class="hero-content">
                        <h1>–ñ–µ–Ω—Å–∫–∏–π –ö–æ–Ω—Å—å–µ—Ä–∂</h1>
                        <p>–ü—Ä–µ–º–∏—É–º —Å–µ—Ä–≤–∏—Å –ø–æ–º–æ—â–∏ –¥–ª—è –∂–µ–Ω—â–∏–Ω. –û—Å—Ç–∞–≤–ª—è–π—Ç–µ –±—ã—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∞–º –∏ –Ω–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å —Å–≤–æ–±–æ–¥–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º.</p>
                        <button class="btn btn-primary" onclick="checkSubscription()">
                            <i class="fas fa-plus-circle"></i>
                            –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
                        </button>
                    </div>
                </section>
                
                <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                <section class="section">
                    <h2 class="section-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
                    <p class="section-subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏</p>
                    
                    <div class="grid grid-2" id="categoriesGrid">
                        <div class="loader" style="grid-column: 1 / -1; text-align: center;">
                            <div class="spinner"></div>
                            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...</p>
                        </div>
                    </div>
                </section>
                
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <section class="section">
                    <div class="card">
                        <h2 class="section-title">–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                        <div class="profile-stats" id="homeStats">
                            <div class="stat-item">
                                <div class="stat-value" id="statTasksHome">0</div>
                                <div class="stat-label">–°–æ–∑–¥–∞–Ω–æ –∑–∞–¥–∞—á</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="statAvailableHome">0</div>
                                <div class="stat-label">–î–æ—Å—Ç—É–ø–Ω–æ –∑–∞–¥–∞—á</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="statCompletedHome">0</div>
                                <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
        <div id="categories-page" class="page">
            <div class="container">
                <section class="section">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                        <button class="btn btn-secondary" onclick="navigateToPage('home')" style="padding: 8px 16px;">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h2 class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h2>
                    </div>
                    
                    <div class="grid grid-2" id="allCategoriesGrid">
                        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </section>
            </div>
        </div>
        
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ª—É–≥ -->
        <div id="services-page" class="page">
            <div class="container">
                <section class="section">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                        <button class="btn btn-secondary" onclick="navigateToPage('categories')" style="padding: 8px 16px;">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h2 class="section-title" id="servicesCategoryTitle">–£—Å–ª—É–≥–∏</h2>
                    </div>
                    
                    <div class="grid grid-2" id="servicesList">
                        <!-- –£—Å–ª—É–≥–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </section>
            </div>
        </div>
        
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
        <div id="create-task-page" class="page">
            <div class="container">
                <section class="section">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                        <button class="btn btn-secondary" onclick="cancelTask()" style="padding: 8px 16px;">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h2 class="section-title">–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</h2>
                    </div>
                    
                    <div class="card">
                        <form id="createTaskForm" class="create-task-form">
                            <div class="form-group">
                                <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                                <div class="form-input" style="background: #f9f9f9; padding: 12px; border-radius: var(--radius-sm);" id="selectedCategoryDisplay">
                                    –ù–µ –≤—ã–±—Ä–∞–Ω–∞
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">–£—Å–ª—É–≥–∞</label>
                                <div class="form-input" style="background: #f9f9f9; padding: 12px; border-radius: var(--radius-sm);" id="selectedServiceDisplay">
                                    –ù–µ –≤—ã–±—Ä–∞–Ω–∞
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="taskTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ *</label>
                                <input type="text" id="taskTitle" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –£–±–æ—Ä–∫–∞ 2-–∫–æ–º–Ω–∞—Ç–Ω–æ–π –∫–≤–∞—Ä—Ç–∏—Ä—ã" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="taskDescription">–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ *</label>
                                <textarea id="taskDescription" class="form-input" rows="4" placeholder="–û–ø–∏—à–∏—Ç–µ –¥–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏..." required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="taskAddress">–ê–¥—Ä–µ—Å *</label>
                                <input type="text" id="taskAddress" class="form-input" placeholder="–ì–¥–µ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–¥–∞—á—É" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="taskDeadline">–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è *</label>
                                <input type="date" id="taskDeadline" class="form-input" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="taskContact">–ö–æ–Ω—Ç–∞–∫—Ç –¥–ª—è —Å–≤—è–∑–∏ *</label>
                                <input type="text" id="taskContact" class="form-input" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ Telegram" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="additionalRequirements">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è</label>
                                <textarea id="additionalRequirements" class="form-input" rows="2" placeholder="–õ—é–±—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è..."></textarea>
                            </div>
                            
                            <div style="display: flex; gap: 12px; margin-top: 30px;">
                                <button type="button" class="btn btn-secondary" onclick="cancelTask()" style="flex: 1;">
                                    –û—Ç–º–µ–Ω–∞
                                </button>
                                <button type="submit" class="btn btn-primary" style="flex: 1;">
                                    –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
                                </button>
                            </div>
                        </form>
                    </div>
                </section>
            </div>
        </div>
        
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div id="tasks-page" class="page">
            <div class="container">
                <section class="section">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                        <button class="btn btn-secondary" onclick="navigateToPage('home')" style="padding: 8px 16px;">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h2 class="section-title">–ú–æ–∏ –∑–∞–¥–∞—á–∏</h2>
                    </div>
                    
                    <!-- –¢–∞–±—ã -->
                    <div class="tabs" id="tasksTabs">
                        <div class="tab active" onclick="filterTasks('all')">–í—Å–µ</div>
                        <div class="tab" onclick="filterTasks('new')">–ù–æ–≤—ã–µ</div>
                        <div class="tab" onclick="filterTasks('in_progress')">–í —Ä–∞–±–æ—Ç–µ</div>
                        <div class="tab" onclick="filterTasks('completed')">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</div>
                    </div>
                    
                    <div class="task-list" id="userTasksList">
                        <div class="empty-state">
                            <i class="fas fa-tasks empty-state-icon"></i>
                            <h3 class="empty-state-title">–ó–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                            <p class="empty-state-description">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ–º–æ—â—å –æ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–æ–º–æ—â–Ω–∏—Ü</p>
                            <button class="btn btn-primary" onclick="checkSubscription()">
                                <i class="fas fa-plus"></i>
                                –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
                            </button>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–µ—Ç–∞–ª–µ–π –∑–∞–¥–∞—á–∏ -->
        <div id="task-details-page" class="page">
            <div class="container">
                <section class="section">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                        <button class="btn btn-secondary" onclick="navigateToPage('tasks')" style="padding: 8px 16px;">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h2 class="section-title">–î–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏</h2>
                    </div>
                    
                    <div id="taskDetailsContent">
                        <!-- –î–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </section>
            </div>
        </div>
        
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
        <div id="profile-page" class="page">
            <div class="container">
                <!-- –®–∞–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
                <div class="profile-header">
                    <div class="profile-avatar" id="profileAvatar">
                        –ì
                    </div>
                    <div class="profile-name" id="profileName">–ì–æ—Å—Ç—å</div>
                    <div class="profile-email" id="profileEmail">–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç</div>
                    
                    <div class="profile-stats" id="profileStats">
                        <div class="stat-item">
                            <div class="stat-value" id="statTasks">0</div>
                            <div class="stat-label">–ó–∞–¥–∞—á</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="statRating">0</div>
                            <div class="stat-label">–†–µ–π—Ç–∏–Ω–≥</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="statBalance">0‚ÇΩ</div>
                            <div class="stat-label">–ë–∞–ª–∞–Ω—Å</div>
                        </div>
                    </div>
                </div>
                
                <!-- –ü–æ–¥–ø–∏—Å–∫–∞ -->
                <section class="section">
                    <h2 class="section-title">–ü–æ–¥–ø–∏—Å–∫–∞</h2>
                    <div class="card" id="profileSubscriptionCard">
                        <div class="empty-state">
                            <i class="fas fa-crown empty-state-icon"></i>
                            <h3 class="empty-state-title">–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞</h3>
                            <p class="empty-state-description">–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º</p>
                            <button class="btn btn-primary" onclick="navigateToPage('subscription')">
                                <i class="fas fa-crown"></i>
                                –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
                            </button>
                        </div>
                    </div>
                </section>
                
                <!-- –ú–æ–∏ –∑–∞–¥–∞—á–∏ -->
                <section class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 class="section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–¥–∞—á–∏</h2>
                        <button class="btn btn-secondary" onclick="navigateToPage('tasks')" style="padding: 8px 16px;">
                            <i class="fas fa-list"></i>
                            –í—Å–µ –∑–∞–¥–∞—á–∏
                        </button>
                    </div>
                    <div class="task-list" id="profileTasksList">
                        <div class="empty-state">
                            <i class="fas fa-tasks empty-state-icon"></i>
                            <h3 class="empty-state-title">–ó–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                            <p class="empty-state-description">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É</p>
                        </div>
                    </div>
                </section>
                
                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è -->
                <section class="section">
                    <h2 class="section-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                    <div class="card">
                        <div style="padding: 10px 0;">
                            <a href="#" class="nav-menu-item" onclick="navigateToPage('subscription')" style="display: block; padding: 12px; text-decoration: none; color: var(--graphite-dark); border-radius: var(--radius-sm); transition: var(--transition-fast); margin-bottom: 8px;">
                                <i class="fas fa-crown" style="margin-right: 12px; color: var(--gold-metallic);"></i>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π
                            </a>
                            <!-- –î–û–ë–ê–í–¨–¢–ï –≠–¢–£ –ö–ù–û–ü–ö–£ -->
                            <a href="#" class="nav-menu-item" onclick="openSendCodeModal()" style="display: block; padding: 12px; text-decoration: none; color: var(--graphite-dark); border-radius: var(--radius-sm); transition: var(--transition-fast); margin-bottom: 8px;">
                                <i class="fas fa-mobile-alt" style="margin-right: 12px; color: var(--gold-metallic);"></i>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω
                            </a>
                            <!-- –ö–û–ù–ï–¶ –î–û–ë–ê–í–õ–ï–ù–ò–Ø -->
                            <a href="#" class="nav-menu-item" onclick="showHelp()" style="display: block; padding: 12px; text-decoration: none; color: var(--graphite-dark); border-radius: var(--radius-sm); transition: var(--transition-fast); margin-bottom: 8px;">
                                <i class="fas fa-question-circle" style="margin-right: 12px; color: var(--gold-metallic);"></i>–ü–æ–º–æ—â—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞
                            </a>
                            <a href="#" class="nav-menu-item" onclick="logout()" style="display: block; padding: 12px; text-decoration: none; color: var(--graphite-dark); border-radius: var(--radius-sm); transition: var(--transition-fast);">
                                <i class="fas fa-sign-out-alt" style="margin-right: 12px; color: var(--error);"></i>–í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
                            </a>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥–ø–∏—Å–æ–∫ -->
        <div id="subscription-page" class="page">
            <div class="container subscription-screen">
                <div class="subscription-content">
                    <div class="card" style="padding: 40px 20px;">
                        <div style="text-align: center; margin-bottom: 30px;">
                            <i class="fas fa-crown" style="font-size: 3.5rem; color: var(--gold-metallic); margin-bottom: 20px;"></i>
                            <h2 class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É</h2>
                            <p class="section-subtitle">–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</p>
                        </div>
                        
                        <div class="grid grid-2" id="subscriptionSelection">
                            <!-- –ü–æ–¥–ø–∏—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                        
                        <div style="text-align: center; margin-top: 30px;">
                            <p style="color: var(--graphite-medium); font-size: 0.9rem;">
                                <i class="fas fa-info-circle"></i> –í—Å–µ —É—Å–ª—É–≥–∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ –ø–æ–¥–ø–∏—Å–∫—É, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Å –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–æ–π) -->
    <nav class="bottom-nav" id="bottomNav" style="display: none;">
        <a href="#" class="nav-item active" onclick="navigateToPage('home')" data-page="home">
            <i class="fas fa-home"></i>
            <span>–ì–ª–∞–≤–Ω–∞—è</span>
        </a>
        <a href="#" class="nav-item" onclick="checkSubscription()" id="createTaskBtn">
            <i class="fas fa-plus-circle"></i>
            <span>–°–æ–∑–¥–∞—Ç—å</span>
        </a>
        <a href="#" class="nav-item" onclick="showTasksPopup()" id="quickTasksBtn">
            <i class="fas fa-tasks"></i>
            <span>–ó–∞–¥–∞—á–∏</span>
        </a>
        <a href="#" class="nav-item" onclick="navigateToPage('profile')" data-page="profile">
            <i class="fas fa-user"></i>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </a>
    </nav>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–¥–∞—á -->
    <a href="#" class="quick-tasks-btn" onclick="showTasksPopup()" id="floatingTasksBtn" style="display: none;">
        <i class="fas fa-tasks"></i>
    </a>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ -->
    <a href="/admin.html" class="admin-access-btn" id="adminAccessBtn" style="display: none;">
        <i class="fas fa-crown"></i>
    </a>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –ø–∞–Ω–µ–ª–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è -->
    <a href="/performer.html" class="performer-access-btn" id="performerAccessBtn" style="display: none;">
        <i class="fas fa-user-tie"></i>
    </a>
    
    <!-- –ü–æ–ø-–∞–ø –æ–∫–Ω–æ —Å–æ —Å–ø–∏—Å–∫–æ–º –∑–∞–¥–∞—á -->
    <div class="tasks-popup-modal" id="tasksPopupModal" style="display: none;">
        <div class="tasks-popup-content">
            <div class="tasks-popup-header">
                <h3>–ú–æ–∏ –∑–∞–¥–∞—á–∏</h3>
                <button class="close-popup-btn" onclick="closeTasksPopup()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="tasks-popup-body">
                <div id="popupTasksList">
                    <!-- –ó–∞–¥–∞—á–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    
    <!-- –ú–æ–¥–∞–ª–∫–∞ –≤—Ö–æ–¥–∞ -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <h3 class="modal-title">–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç</h3>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ Email</label>
                    <input type="text" id="loginPhoneInput" class="form-input" placeholder="+79991234567 –∏–ª–∏ –≤–∞—à@email.com" required>
                    <small style="color: var(--graphite-light); font-size: 0.8rem;">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ email, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</small>
                </div>
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="loginPasswordInput" class="form-input" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">
                    –í–æ–π—Ç–∏
                </button>
            </form>
            <div style="text-align: center; margin-top: 20px;">
                <p style="color: var(--graphite-medium); font-size: 0.9rem;">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? 
                    <a href="#" onclick="showRegisterModal()" style="color: var(--gold-metallic); text-decoration: none; font-weight: 600;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                </p>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <h3 class="modal-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
            <form id="registerForm">
                <div class="form-group">
                    <label class="form-label">–ò–º—è *</label>
                    <input type="text" id="registerFirstName" class="form-input" placeholder="–í–∞—à–µ –∏–º—è" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–§–∞–º–∏–ª–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input type="text" id="registerLastName" class="form-input" placeholder="–í–∞—à–∞ —Ñ–∞–º–∏–ª–∏—è">
                </div>
                <div class="form-group">
                    <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                    <input type="tel" id="registerPhone" class="form-input" placeholder="+7 (999) 123-45-67" required>
                    <small style="color: var(--graphite-light); font-size: 0.8rem;">–¢–µ–ª–µ—Ñ–æ–Ω –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –≤—Ö–æ–¥–∞</small>
                </div>
                <div class="form-group">
                    <label class="form-label">Email (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input type="email" id="registerEmail" class="form-input" placeholder="–≤–∞—à@email.com">
                    <small style="color: var(--graphite-light); font-size: 0.8rem;">–î–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</small>
                </div>
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å *</label>
                    <input type="password" id="registerPassword" class="form-input" placeholder="–ù–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">
                    –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                </button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (SMS –∫–æ–¥) -->
    <div class="modal" id="verifyPhoneModal">
        <div class="modal-content">
            <h3 class="modal-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞</h3>
            <div id="verifyPhoneContent">
                <p style="color: var(--graphite-medium); margin-bottom: 20px;">
                    –î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                </p>
                <div class="form-group">
                    <label class="form-label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                    <input type="text" id="verifyPhoneNumber" class="form-input" readonly style="background: #f5f5f5;">
                </div>
               <div class="form-group">
    <label class="form-label">–ö–æ–¥ –∏–∑ SMS</label>
    <input type="text" id="verifyPhoneCode" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥" maxlength="6" pattern="[0-9]*" inputmode="numeric">
</div>
                <button type="button" class="btn btn-primary" onclick="verifyPhoneCode()" style="width: 100%; margin-top: 10px;">
                    –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                </button>
                <button type="button" class="btn btn-secondary" onclick="sendVerificationCode()" style="width: 100%; margin-top: 10px;">
                    <i class="fas fa-redo"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –µ—â–µ —Ä–∞–∑
                </button>
                <div style="text-align: center; margin-top: 20px;">
                    <p style="color: var(--graphite-medium); font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> –ö–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 10 –º–∏–Ω—É—Ç
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞ -->
    <div class="modal" id="sendCodeModal">
        <div class="modal-content">
            <h3 class="modal-title">–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</h3>
            <div id="sendCodeContent">
                <p style="color: var(--graphite-medium); margin-bottom: 20px;">
                    –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                </p>
                <div class="form-group">
    <label class="form-label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
    <input type="tel" id="sendCodePhone" class="form-input" placeholder="+7 (999) 123-45-67">
    <small style="color: var(--graphite-light); font-size: 0.8rem;">–£–∫–∞–∂–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</small>
</div>
                <button type="button" class="btn btn-primary" onclick="sendVerificationCode(true)" style="width: 100%; margin-top: 10px;">
                    –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥
                </button>
                <div style="text-align: center; margin-top: 20px;">
                    <p style="color: var(--graphite-medium); font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> –ö–æ–¥ –ø—Ä–∏–¥–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ –º–∏–Ω—É—Ç—ã
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let currentToken = localStorage.getItem('token') || null;
        let categories = [];
        let services = [];
        let subscriptions = [];
        let userTasks = [];
        let selectedCategory = null;
        let selectedService = null;
        let currentTaskFilter = 'all';
        let currentChatTaskId = null;
        let chatMessages = [];
        let chatPollingInterval = null;
        
        // API –±–∞–∑–æ–≤—ã–π URL
        const API_BASE_URL = window.location.origin;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            await checkAuth();
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫–æ–π —ç–∫—Ä–∞–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å
            determineInitialScreen();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            await loadCategories();
            await loadSubscriptions();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateUserInterface();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –¥–ª—è –¥–µ–¥–ª–∞–π–Ω–∞
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const deadlineInput = document.getElementById('taskDeadline');
            if (deadlineInput) {
                deadlineInput.value = tomorrow.toISOString().split('T')[0];
                deadlineInput.min = new Date().toISOString().split('T')[0];
            }
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–æ—Ä–º
            setupEventListeners();
            
            console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
        });
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function determineInitialScreen() {
            if (!currentUser) {
                // –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                navigateToPage('auth');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
            if (!currentUser.phone_verified) {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                showNotification('–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞', 'warning');
                openVerifyPhoneModal(currentUser.phone);
                return;
            }
            
            if (currentUser.subscription_status !== 'active' || !currentUser.initial_fee_paid) {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ø–æ–¥–ø–∏—Å–∫–∏
                navigateToPage('subscription-required');
                return;
            }
            
            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–æ–π - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é
            navigateToPage('home');
        }
        
        function setupEventListeners() {
            // –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    await login();
                });
            }

// –ê–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø—Ä–∏ –≤–≤–æ–¥–µ
const phoneInputs = document.querySelectorAll('input[type="tel"], input[id*="Phone"]:not([id*="Code"]), input[placeholder*="—Ç–µ–ª–µ—Ñ–æ–Ω"], input[placeholder*="—Ç–µ–ª–µ—Ñ–æ–Ω–∞"]');
phoneInputs.forEach(input => {
    // –ò—Å–∫–ª—é—á–∞–µ–º –ø–æ–ª–µ –¥–ª—è –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    if (input.id.includes('Code') || input.placeholder.includes('–∫–æ–¥')) {
        return;
    }
    
    input.addEventListener('input', function(e) {
        formatPhoneInput(this);
    });
    
    input.addEventListener('blur', function(e) {
        if (this.value && !this.value.startsWith('+')) {
            this.value = normalizePhone(this.value);
        }
    });
});
            
            // –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            const registerForm = document.getElementById('registerForm');
            if (registerForm) {
                registerForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    await register();
                });
            }
            
            // –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
            const taskForm = document.getElementById('createTaskForm');
            if (taskForm) {
                taskForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    await createTask();
                });
            }
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            document.addEventListener('click', function(event) {
                const userMenu = document.getElementById('userMenu');
                const userAvatar = document.getElementById('userAvatar');
                
                if (userMenu && userMenu.style.display === 'block') {
                    if (!userMenu.contains(event.target) && !userAvatar.contains(event.target)) {
                        userMenu.style.display = 'none';
                    }
                }
                
                // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
                const modals = document.querySelectorAll('.modal.active');
                modals.forEach(modal => {
                    if (event.target === modal) {
                        closeModal(modal.id);
                    }
                });
                
                // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–ø-–∞–ø –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
                const popupModal = document.getElementById('tasksPopupModal');
                if (popupModal && event.target === popupModal) {
                    closeTasksPopup();
                }
                
                // –ó–∞–∫—Ä—ã—Ç–∏–µ —á–∞—Ç–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
                const chatModal = document.getElementById('taskChatModal');
                if (chatModal && event.target === chatModal) {
                    closeChatModal();
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ Escape –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeAllModals();
                    closeUserMenu();
                    closeTasksPopup();
                    closeChatModal();
                }
            });
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–¥–ø–∏—Å–∫–µ
        async function loadSubscriptionInfo() {
            if (!currentUser) return null;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/auth/subscription-info`, {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        return data.data;
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–¥–ø–∏—Å–∫–µ:', error);
            }
            return null;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–æ–¥–ø–∏—Å–∫–µ –ø—Ä–∏ –≤—Ö–æ–¥–µ
        async function showSubscriptionNotification() {
            if (!currentUser || currentUser.role !== 'client') return;
            
            const subscriptionInfo = await loadSubscriptionInfo();
            if (!subscriptionInfo) return;
            
            const { subscription_status, subscription_expires, days_remaining, next_charge_date } = subscriptionInfo;
            
            if (subscription_status === 'active' && subscription_expires) {
                const expiryDate = new Date(subscription_expires);
                const formattedDate = expiryDate.toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
                
                const nextCharge = new Date(next_charge_date);
                const nextChargeFormatted = nextCharge.toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
                
                let message = `‚úÖ –í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞`;
                
                if (days_remaining > 0) {
                    message += `\n‚è∞ –î–µ–π—Å—Ç–≤—É–µ—Ç –µ—â–µ ${days_remaining} ${getDayWord(days_remaining)} –¥–æ ${formattedDate}`;
                    message += `\nüí∞ –°–ª–µ–¥—É—é—â–µ–µ —Å–ø–∏—Å–∞–Ω–∏–µ: ${nextChargeFormatted}`;
                    
                    if (days_remaining <= 7) {
                        message += `\n‚ö†Ô∏è –ü–æ–¥–ø–∏—Å–∫–∞ —Å–∫–æ—Ä–æ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è! –ü—Ä–æ–¥–ª–∏—Ç–µ –≤–æ–≤—Ä–µ–º—è.`;
                    }
                } else {
                    message += `\n‚ö†Ô∏è –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç —Å–µ–≥–æ–¥–Ω—è!`;
                    message += `\nüí∞ –°–ª–µ–¥—É—é—â–µ–µ —Å–ø–∏—Å–∞–Ω–∏–µ: ${nextChargeFormatted}`;
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–∏–¥–µ–ª –µ–≥–æ
                setTimeout(() => {
                    showNotification(message, 'info');
                }, 1000);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–∫–ª–æ–Ω–µ–Ω–∏—è —Å–ª–æ–≤–∞ "–¥–µ–Ω—å"
        function getDayWord(days) {
            if (days % 10 === 1 && days % 100 !== 11) {
                return '–¥–µ–Ω—å';
            } else if ([2, 3, 4].includes(days % 10) && ![12, 13, 14].includes(days % 100)) {
                return '–¥–Ω—è';
            } else {
                return '–¥–Ω–µ–π';
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        async function checkAuth() {
            if (!currentToken) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/auth/check`, {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        currentUser = data.data.user;
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', currentUser.email);
                    }
                } else {
                    // –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π, —É–¥–∞–ª—è–µ–º –µ–≥–æ
                    localStorage.removeItem('token');
                    localStorage.removeItem('currentUser');
                    currentToken = null;
                    currentUser = null;
                    console.log('–¢–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–ª–æ–≥–∏–Ω–µ–Ω');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
                localStorage.removeItem('token');
                localStorage.removeItem('currentUser');
                currentToken = null;
                currentUser = null;
            }
        }
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
        function navigateToPage(pageId) {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–ø—Ä–æ—Å —á–∞—Ç–∞ –ø—Ä–∏ —É—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            if (chatPollingInterval) {
                clearInterval(chatPollingInterval);
                chatPollingInterval = null;
                currentChatTaskId = null;
            }
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            closeUserMenu();
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–ø-–∞–ø –æ–∫–Ω–æ
            closeTasksPopup();
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            const pageElement = document.getElementById(pageId + '-page');
            if (pageElement) {
                pageElement.classList.add('active');
            } else {
                console.error('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:', pageId);
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∏–∂–Ω—é—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Å –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–æ–π
            const bottomNav = document.getElementById('bottomNav');
            const floatingBtn = document.getElementById('floatingTasksBtn');
            
            if (currentUser && currentUser.subscription_status === 'active' && currentUser.initial_fee_paid) {
                bottomNav.style.display = 'flex';
                floatingBtn.style.display = 'flex';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                if (pageId !== 'create-task' && pageId !== 'subscription' && pageId !== 'categories' && pageId !== 'services' && pageId !== 'tasks' && pageId !== 'task-details') {
                    const navItem = document.querySelector(`.nav-item[data-page="${pageId}"]`);
                    if (navItem) {
                        navItem.classList.add('active');
                    }
                }
            } else {
                bottomNav.style.display = 'none';
                floatingBtn.style.display = 'none';
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            switch(pageId) {
                case 'profile':
                    loadUserProfile();
                    break;
                case 'categories':
                    loadAllCategories();
                    break;
                case 'home':
                    loadHomePage();
                    break;
                case 'tasks':
                    loadUserTasks();
                    break;
                case 'subscription':
                    loadSubscriptionPage();
                    break;
                case 'subscription-required':
                    // –ù–∏—á–µ–≥–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–ª—è —ç—Ç–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
                    break;
                case 'auth':
                    // –ù–∏—á–µ–≥–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–ª—è —ç—Ç–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
                    break;
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        async function loadHomePage() {
            try {
                await loadCategories();
                renderHomeCategories();
                updateHomeStats();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã', 'error');
            }
        }
        
        function updateHomeStats() {
            if (!currentUser) return;
            
            const statTasksHome = document.getElementById('statTasksHome');
            const statAvailableHome = document.getElementById('statAvailableHome');
            const statCompletedHome = document.getElementById('statCompletedHome');
            
            if (statTasksHome) {
                statTasksHome.textContent = currentUser.tasks_used || '0';
            }
            
            if (statAvailableHome) {
                const available = (currentUser.tasks_limit || 0) - (currentUser.tasks_used || 0);
                statAvailableHome.textContent = available > 0 ? available : '0';
            }
            
            if (statCompletedHome) {
                statCompletedHome.textContent = currentUser.completed_tasks || '0';
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        async function loadCategories() {
            try {
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...');
                const response = await fetch(`${API_BASE_URL}/api/categories`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                if (data.success) {
                    categories = data.data.categories;
                    console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${categories.length} –∫–∞—Ç–µ–≥–æ—Ä–∏–π`);
                    return categories;
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π', 'error');
                return [];
            }
        }
        
        function renderHomeCategories() {
            const container = document.getElementById('categoriesGrid');
            if (!container) return;
            
            // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ 4 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            const homeCategories = categories.slice(0, 4);
            
            if (homeCategories.length === 0) {
                container.innerHTML = `
                    <div class="card" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <i class="fas fa-exclamation-circle" style="font-size: 3rem; color: var(--graphite-light); margin-bottom: 20px;"></i>
                        <p style="color: var(--graphite-medium);">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            homeCategories.forEach(category => {
                const card = document.createElement('div');
                card.className = 'card category-card';
                card.onclick = () => selectCategory(category);
                card.innerHTML = `
                    <div class="category-icon">
                        <i class="${category.icon}"></i>
                    </div>
                    <h3>${category.display_name}</h3>
                    <p>${category.description}</p>
                    <span class="service-price">–í–∫–ª—é—á–µ–Ω–æ –≤ –ø–æ–¥–ø–∏—Å–∫—É</span>
                `;
                container.appendChild(card);
            });
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        async function loadAllCategories() {
            try {
                const container = document.getElementById('allCategoriesGrid');
                if (!container) return;
                
                container.innerHTML = '<div class="loader" style="grid-column: 1 / -1; text-align: center;"><div class="spinner"></div><p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...</p></div>';
                
                await loadCategories();
                
                if (categories.length === 0) {
                    container.innerHTML = `
                        <div class="card" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                            <i class="fas fa-exclamation-circle" style="font-size: 3rem; color: var(--graphite-light); margin-bottom: 20px;"></i>
                            <p style="color: var(--graphite-medium);">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = '';
                categories.forEach(category => {
                    const card = document.createElement('div');
                    card.className = 'card category-card';
                    card.onclick = () => selectCategory(category);
                    card.innerHTML = `
                        <div class="category-icon">
                            <i class="${category.icon}"></i>
                        </div>
                        <h3>${category.display_name}</h3>
                        <p>${category.description}</p>
                        <span class="service-price">${category.services_count || 0} —É—Å–ª—É–≥</span>
                    `;
                    container.appendChild(card);
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π', 'error');
            }
        }
        
        // –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        async function selectCategory(category) {
            console.log('–í—ã–±—Ä–∞–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è:', category);
            
            if (!currentUser) {
                showNotification('–î–ª—è –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'warning');
                showLoginModal();
                return;
            }
            
            if (currentUser.subscription_status !== 'active' || !currentUser.initial_fee_paid) {
                showNotification('–î–ª—è –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞', 'warning');
                navigateToPage('subscription-required');
                return;
            }
            
            selectedCategory = category;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/categories/${category.id}/services`);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Å–ª—É–≥');
                
                const data = await response.json();
                if (data.success) {
                    selectedCategory = data.data.category;
                    services = data.data.services;
                    
                    navigateToPage('services');
                    renderServices();
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Å–ª—É–≥');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Å–ª—É–≥:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Å–ª—É–≥', 'error');
            }
        }
        
        function renderServices() {
            const container = document.getElementById('servicesList');
            const title = document.getElementById('servicesCategoryTitle');
            
            if (selectedCategory && title) {
                title.textContent = selectedCategory.display_name;
            }
            
            if (!container) return;
            
            if (!services || services.length === 0) {
                container.innerHTML = `
                    <div class="card" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <i class="fas fa-exclamation-circle" style="font-size: 3rem; color: var(--graphite-light); margin-bottom: 20px;"></i>
                        <p style="color: var(--graphite-medium);">–£—Å–ª—É–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                        <button class="btn btn-secondary" onclick="navigateToPage('categories')">
                            <i class="fas fa-arrow-left"></i>
                            –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            services.forEach(service => {
                const card = document.createElement('div');
                card.className = 'card service-card';
                card.onclick = () => selectService(service);
                card.innerHTML = `
                    <div class="service-header">
                        <h4>${service.name}</h4>
                    </div>
                    <p class="service-description">${service.description}</p>
                    <div class="service-footer">
                        <span class="service-price">–í–∫–ª—é—á–µ–Ω–æ –≤ –ø–æ–¥–ø–∏—Å–∫—É</span>
                        <span class="btn btn-primary btn-sm">
                            –í—ã–±—Ä–∞—Ç—å
                        </span>
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        // –í—ã–±–æ—Ä —É—Å–ª—É–≥–∏
        function selectService(service) {
            console.log('–í—ã–±—Ä–∞–Ω–∞ —É—Å–ª—É–≥–∞:', service);
            
            if (!currentUser) {
                showNotification('–î–ª—è –≤—ã–±–æ—Ä–∞ —É—Å–ª—É–≥–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'warning');
                showLoginModal();
                return;
            }
            
            if (currentUser.subscription_status !== 'active' || !currentUser.initial_fee_paid) {
                showNotification('–î–ª—è –≤—ã–±–æ—Ä–∞ —É—Å–ª—É–≥–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞', 'warning');
                navigateToPage('subscription-required');
                return;
            }
            
            selectedService = service;
            navigateToPage('create-task');
            updateTaskForm();
        }
        
        function updateTaskForm() {
            if (selectedCategory) {
                const categoryDisplay = document.getElementById('selectedCategoryDisplay');
                if (categoryDisplay) {
                    categoryDisplay.textContent = selectedCategory.display_name;
                    categoryDisplay.style.color = 'var(--graphite-dark)';
                }
            }
            
            if (selectedService) {
                const serviceDisplay = document.getElementById('selectedServiceDisplay');
                if (serviceDisplay) {
                    serviceDisplay.textContent = selectedService.name;
                    serviceDisplay.style.color = 'var(--graphite-dark)';
                }
            }
            
            // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞
            const contactInput = document.getElementById('taskContact');
            if (contactInput && currentUser && currentUser.phone) {
                contactInput.value = currentUser.phone;
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∑–∞–¥–∞—á–∏
        function checkSubscription() {
            if (!currentUser) {
                showNotification('–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'warning');
                showLoginModal();
                return;
            }
            
            if (currentUser.subscription_status !== 'active' || !currentUser.initial_fee_paid) {
                navigateToPage('subscription-required');
            } else {
                navigateToPage('categories');
            }
        }
        
        // –û—Ç–º–µ–Ω–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
        function cancelTask() {
            selectedCategory = null;
            selectedService = null;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
            const taskForm = document.getElementById('createTaskForm');
            if (taskForm) {
                taskForm.reset();
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ–¥–ª–∞–π–Ω
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const deadlineInput = document.getElementById('taskDeadline');
            if (deadlineInput) {
                deadlineInput.value = tomorrow.toISOString().split('T')[0];
                deadlineInput.min = new Date().toISOString().split('T')[0];
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —É—Å–ª—É–≥–∏
            const categoryDisplay = document.getElementById('selectedCategoryDisplay');
            if (categoryDisplay) {
                categoryDisplay.textContent = '–ù–µ –≤—ã–±—Ä–∞–Ω–∞';
                categoryDisplay.style.color = 'var(--graphite-medium)';
            }
            
            const serviceDisplay = document.getElementById('selectedServiceDisplay');
            if (serviceDisplay) {
                serviceDisplay.textContent = '–ù–µ –≤—ã–±—Ä–∞–Ω–∞';
                serviceDisplay.style.color = 'var(--graphite-medium)';
            }
            
            navigateToPage('home');
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
async function createTask() {
    if (!currentUser) {
        showNotification('–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
        return;
    }
    
    if (currentUser.subscription_status !== 'active' || !currentUser.initial_fee_paid) {
        showNotification('–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞', 'error');
        return;
    }
    
    if (!selectedCategory || !selectedService) {
        showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ —É—Å–ª—É–≥—É', 'error');
        return;
    }
    
    const taskTitle = document.getElementById('taskTitle')?.value;
    const taskDescription = document.getElementById('taskDescription')?.value;
    const taskAddress = document.getElementById('taskAddress')?.value;
    const taskDeadline = document.getElementById('taskDeadline')?.value;
    const taskContact = document.getElementById('taskContact')?.value;
    const additionalRequirements = document.getElementById('additionalRequirements')?.value;
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!taskTitle || !taskDescription || !taskAddress || !taskDeadline || !taskContact) {
        showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã
    const deadlineDate = new Date(taskDeadline);
    if (deadlineDate < new Date()) {
        showNotification('–î–∞—Ç–∞ –¥–µ–¥–ª–∞–π–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –ø—Ä–æ—à–ª–æ–º', 'error');
        return;
    }
    
    try {
        showLoading('–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏...');
        
        const taskData = {
            title: taskTitle,
            description: taskDescription,
            category_id: selectedCategory.id,
            service_id: selectedService.id,
            deadline: taskDeadline,
            address: taskAddress,
            contact_info: taskContact,
            additional_requirements: additionalRequirements || '',
            priority: 'medium',
            status: 'searching'  // –í–∞–∂–Ω–æ: —Å—Ä–∞–∑—É —Å—Ç–∞–≤–∏–º —Å—Ç–∞—Ç—É—Å "–≤ –ø–æ–∏—Å–∫–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è"
        };
        
        console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–¥–∞—á–∏:', taskData);
        
        const response = await fetch(`${API_BASE_URL}/api/tasks`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${currentToken}`
            },
            body: JSON.stringify(taskData)
        });
        
        const data = await response.json();
        
        if (data.success) {
            showNotification('–ó–∞–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞! –ú—ã –∏—â–µ–º –ø–æ–¥—Ö–æ–¥—è—â—É—é –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∏—Ü—É.', 'success');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (data.data.user) {
                currentUser = data.data.user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateUserInterface();
            updateHomeStats();
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
            cancelTask();
            
            // –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
            setTimeout(() => {
                showNotification('–ó–∞–¥–∞—á–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ —É–≤–∏–¥—è—Ç –µ—ë –≤ —Å–ø–∏—Å–∫–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–¥–∞—á.', 'info');
            }, 3000);
            
        } else {
            throw new Error(data.error || `HTTP ${response.status}: –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏`);
        }
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏:', error);
        showNotification(error.message, 'error');
    } finally {
        hideLoading();
    }
}
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫
        async function loadSubscriptions() {
            try {
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫...');
                const response = await fetch(`${API_BASE_URL}/api/subscriptions`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                if (data.success) {
                    subscriptions = data.data.subscriptions;
                    console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${subscriptions.length} –ø–æ–¥–ø–∏—Å–æ–∫`);
                    return subscriptions;
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–ø–∏—Å–æ–∫');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–ø–∏—Å–æ–∫:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–ø–∏—Å–æ–∫', 'error');
                return [];
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–¥–ø–∏—Å–æ–∫
        async function loadSubscriptionPage() {
            try {
                await loadSubscriptions();
                renderSubscriptions();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–¥–ø–∏—Å–æ–∫:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–ø–∏—Å–æ–∫', 'error');
            }
        }
        
        function renderSubscriptions() {
            // –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥–ø–∏—Å–æ–∫
            const subscriptionContainer = document.getElementById('subscriptionSelection');
            if (subscriptionContainer) {
                if (!subscriptions || subscriptions.length === 0) {
                    subscriptionContainer.innerHTML = `
                        <div class="card" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                            <i class="fas fa-exclamation-circle" style="font-size: 3rem; color: var(--graphite-light); margin-bottom: 20px;"></i>
                            <p style="color: var(--graphite-medium);">–ü–æ–¥–ø–∏—Å–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                        </div>
                    `;
                    return;
                }
                
                subscriptionContainer.innerHTML = '';
                subscriptions.forEach(sub => {
                    const card = document.createElement('div');
                    card.className = `card subscription-card ${sub.is_popular ? 'popular' : ''}`;
                    
                    if (sub.is_popular) {
                        card.innerHTML += '<div class="popular-badge">–ü–æ–ø—É–ª—è—Ä–Ω—ã–π</div>';
                    }
                    
                    const features = Array.isArray(sub.features) ? sub.features : JSON.parse(sub.features || '[]');
                    
                    card.innerHTML += `
                        <h3>${sub.display_name}</h3>
                        <p style="color: var(--graphite-medium); margin-bottom: 15px;">${sub.description}</p>
                        
                        <div class="subscription-price">
                            ${formatNumber(sub.price_monthly)}<span>‚ÇΩ/–º–µ—Å</span>
                        </div>
                        
                        <div style="color: var(--graphite-light); font-size: 0.9rem; margin-bottom: 15px;">
                            –í—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å: ${formatNumber(sub.initial_fee)}‚ÇΩ
                        </div>
                        
                        <ul class="subscription-features">
                            ${features.map(feature => `<li><i class="fas fa-check"></i> ${feature}</li>`).join('')}
                        </ul>
                        
                        <button class="btn ${sub.is_popular ? 'btn-primary' : 'btn-secondary'}" style="width: 100%; margin-top: 20px;" onclick="selectSubscription('${sub.name}')">
                            ${currentUser && currentUser.subscription_plan === sub.name ? '–¢–µ–∫—É—â–∏–π —Ç–∞—Ä–∏—Ñ' : '–í—ã–±—Ä–∞—Ç—å —Ç–∞—Ä–∏—Ñ'}
                        </button>
                    `;
                    
                    subscriptionContainer.appendChild(card);
                });
            }
        }

        // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        function openVerifyPhoneModal(phoneNumber) {
            closeAllModals();
            const modal = document.getElementById('verifyPhoneModal');
            if (modal) {
                const phoneInput = document.getElementById('verifyPhoneNumber');
                if (phoneInput && phoneNumber) {
                    phoneInput.value = phoneNumber;
                }
                modal.classList.add('active');
                document.getElementById('verifyPhoneCode')?.focus();
            }
        }

        // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞
        function openSendCodeModal() {
            closeAllModals();
            const modal = document.getElementById('sendCodeModal');
            if (modal) {
                modal.classList.add('active');
                document.getElementById('sendCodePhone')?.focus();
            }
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        function closeVerifyPhoneModal() {
            closeModal('verifyPhoneModal');
        }

        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        async function sendVerificationCode(fromSendModal = false) {
            let phoneNumber;
            
            if (fromSendModal) {
                // –ë–µ—Ä–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω –∏–∑ –º–æ–¥–∞–ª–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
                phoneNumber = document.getElementById('sendCodePhone').value;
                if (!phoneNumber) {
                    showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞', 'error');
                    return;
                }
            } else {
                // –ë–µ—Ä–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω –∏–∑ –º–æ–¥–∞–ª–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                phoneNumber = document.getElementById('verifyPhoneNumber').value;
            }
            
            if (!phoneNumber) {
                showNotification('–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return;
            }
            
            try {
                showLoading('–û—Ç–ø—Ä–∞–≤–∫–∞ SMS –∫–æ–¥–∞...');
                
                const response = await fetch(`${API_BASE_URL}/api/auth/send-verification`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ phone: phoneNumber })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SMS –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ', 'success');
                    
                    if (fromSendModal) {
                        // –ï—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ –∏–∑ –º–æ–¥–∞–ª–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏, –∑–∞–∫—Ä—ã–≤–∞–µ–º –µ–µ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –≤–≤–æ–¥–∞ –∫–æ–¥–∞
                        closeModal('sendCodeModal');
                        openVerifyPhoneModal(phoneNumber);
                    } else {
                        // –ï—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ –∏–∑ –º–æ–¥–∞–ª–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è, –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º UI
                        document.getElementById('verifyPhoneCode').value = '';
                        document.getElementById('verifyPhoneCode').focus();
                    }
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞:', error);
                showNotification(error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        // –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω —Å –∫–æ–¥–æ–º
        async function verifyPhoneCode() {
            const phoneNumber = document.getElementById('verifyPhoneNumber').value;
            const code = document.getElementById('verifyPhoneCode').value;
            
            if (!phoneNumber || !code) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è', 'error');
                return;
            }
            
            if (code.length !== 6) {
                showNotification('–ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 6 —Ü–∏—Ñ—Ä', 'error');
                return;
            }
            
            try {
                showLoading('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞...');
                
                const response = await fetch(`${API_BASE_URL}/api/auth/verify-phone`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ phone: phoneNumber, code: code })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('–¢–µ–ª–µ—Ñ–æ–Ω —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω!', 'success');
                    closeVerifyPhoneModal();
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    if (data.data.token) {
                        localStorage.setItem('token', data.data.token);
                        localStorage.setItem('currentUser', JSON.stringify(data.data.user));
                        currentToken = data.data.token;
                        currentUser = data.data.user;
                        updateUserInterface();
                    }
                    
                    // –ï—Å–ª–∏ —ç—Ç–æ –Ω–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                    if (data.data.is_new_registration) {
                        showNotification('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!', 'success');
                        
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–∫—Ä–∞–Ω
                        setTimeout(() => {
                            determineInitialScreen();
                        }, 1000);
                    } else {
                        // –ï—Å–ª–∏ —ç—Ç–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                        showNotification('–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É', 'success');
                        
                        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–¥–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
                        setTimeout(() => {
                            navigateToPage('subscription');
                        }, 1000);
                    }
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞:', error);
                showNotification(error.message, 'error');
            } finally {
                hideLoading();
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ –ø–æ–¥–ø–∏—Å–∫–∏
        async function selectSubscription(subscriptionName) {
            if (!currentUser) {
                showNotification('–î–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                showLoginModal();
                return;
            }
            
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    showNotification('–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', 'error');
                    return;
                }
                
                const response = await fetch(`${API_BASE_URL}/api/subscriptions/subscribe`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        plan: subscriptionName
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    // –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                    if (data.requires_phone_verification) {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                        openVerifyPhoneModal(data.user_phone || currentUser.phone);
                        return;
                    }
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–æ–¥–ø–∏—Å–∫–∏');
                }
                
                if (data.success) {
                    showNotification('–ü–æ–¥–ø–∏—Å–∫–∞ —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!', 'success');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    if (data.data.user) {
                        currentUser = data.data.user;
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        updateUserInterface();
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —ç–∫—Ä–∞–Ω
                        determineInitialScreen();
                    }
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–æ–¥–ø–∏—Å–∫–∏');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–æ–¥–ø–∏—Å–∫–∏:', error);
                showNotification(error.message, 'error');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function updateUserInterface() {
            const userAvatar = document.getElementById('userAvatar');
            const profileAvatar = document.getElementById('profileAvatar');
            const profileName = document.getElementById('profileName');
            const profileEmail = document.getElementById('profileEmail');
            const menuUserName = document.getElementById('menuUserName');
            const menuUserEmail = document.getElementById('menuUserEmail');
            const loginMenuBtn = document.getElementById('loginMenuBtn');
            const logoutMenuBtn = document.getElementById('logoutMenuBtn');
            const adminAccessBtn = document.getElementById('adminAccessBtn');
            const performerAccessBtn = document.getElementById('performerAccessBtn');
            const performerPanelLink = document.getElementById('performerPanelLink');
            
            if (currentUser) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä –∏ –∏–º—è
                const firstLetter = currentUser.first_name ? currentUser.first_name.charAt(0).toUpperCase() : '–ì';
                
                if (userAvatar) userAvatar.textContent = firstLetter;
                if (profileAvatar) profileAvatar.textContent = firstLetter;
                if (profileName) profileName.textContent = currentUser.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                if (profileEmail) profileEmail.textContent = currentUser.email || '';
                if (menuUserName) menuUserName.textContent = currentUser.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                if (menuUserEmail) menuUserEmail.textContent = currentUser.email || '';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –º–µ–Ω—é
                if (loginMenuBtn) loginMenuBtn.style.display = 'none';
                if (logoutMenuBtn) logoutMenuBtn.style.display = 'block';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
                if (adminAccessBtn && (currentUser.role === 'admin' || currentUser.role === 'superadmin' || currentUser.role === 'manager')) {
                    adminAccessBtn.style.display = 'flex';
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–∞–Ω–µ–ª–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
                if (performerAccessBtn && currentUser.role === 'performer') {
                    performerAccessBtn.style.display = 'flex';
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –ø–∞–Ω–µ–ª—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –≤ –º–µ–Ω—é
                if (performerPanelLink && (currentUser.role === 'performer' || currentUser.role === 'admin' || currentUser.role === 'superadmin' || currentUser.role === 'manager')) {
                    performerPanelLink.style.display = 'block';
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ—Ñ–∏–ª—è
                updateProfileStats();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ–¥–ø–∏—Å–∫–∏ –≤ –ø—Ä–æ—Ñ–∏–ª–µ
                updateProfileSubscriptionCard();
                
            } else {
                // –ì–æ—Å—Ç–µ–≤–æ–π —Ä–µ–∂–∏–º
                if (userAvatar) userAvatar.textContent = '–ì';
                if (profileAvatar) profileAvatar.textContent = '–ì';
                if (profileName) profileName.textContent = '–ì–æ—Å—Ç—å';
                if (profileEmail) profileEmail.textContent = '–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç';
                if (menuUserName) menuUserName.textContent = '–ì–æ—Å—Ç—å';
                if (menuUserEmail) menuUserEmail.textContent = '';
                
                if (loginMenuBtn) loginMenuBtn.style.display = 'block';
                if (logoutMenuBtn) logoutMenuBtn.style.display = 'none';
                if (adminAccessBtn) adminAccessBtn.style.display = 'none';
                if (performerAccessBtn) performerAccessBtn.style.display = 'none';
                if (performerPanelLink) performerPanelLink.style.display = 'none';
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const statTasks = document.getElementById('statTasks');
                const statRating = document.getElementById('statRating');
                const statBalance = document.getElementById('statBalance');
                
                if (statTasks) statTasks.textContent = '0';
                if (statRating) statRating.textContent = '0';
                if (statBalance) statBalance.textContent = '0‚ÇΩ';
            }
        }
        
        function updateProfileStats() {
            if (!currentUser) return;
            
            const statTasks = document.getElementById('statTasks');
            const statRating = document.getElementById('statRating');
            const statBalance = document.getElementById('statBalance');
            
            if (statTasks) statTasks.textContent = currentUser.tasks_used || '0';
            if (statRating) statRating.textContent = currentUser.rating || '0';
            if (statBalance) statBalance.textContent = (currentUser.balance || '0') + '‚ÇΩ';
        }
        
        function updateProfileSubscriptionCard() {
            if (!currentUser) return;
            
            const card = document.getElementById('profileSubscriptionCard');
            if (!card) return;
            
            if (currentUser.subscription_status === 'active' && currentUser.initial_fee_paid) {
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div>
                            <h3 style="font-size: 1.3rem; font-weight: 600; margin-bottom: 5px;">${currentUser.subscription_plan || '–≠—Å—Å–µ–Ω—à–ª'}</h3>
                            <p style="color: var(--graphite-medium); font-size: 0.9rem;">–ê–∫—Ç–∏–≤–Ω–∞ –¥–æ ${formatDate(currentUser.subscription_expires)}</p>
                        </div>
                        <span style="background: rgba(56, 178, 172, 0.1); color: var(--success); padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">–ê–∫—Ç–∏–≤–Ω–∞</span>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary" style="flex: 1;" onclick="navigateToPage('subscription')">
                            <i class="fas fa-exchange-alt"></i>
                            –°–º–µ–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ
                        </button>
                        <button class="btn btn-secondary" style="flex: 1;" onclick="showHelp()">
                            <i class="fas fa-question-circle"></i>
                            –ü–æ–¥–¥–µ—Ä–∂–∫–∞
                        </button>
                    </div>
                `;
            } else {
                card.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-crown empty-state-icon"></i>
                        <h3 class="empty-state-title">–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞</h3>
                        <p class="empty-state-description">–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º</p>
                        <button class="btn btn-primary" onclick="navigateToPage('subscription')">
                            <i class="fas fa-crown"></i>
                            –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
                        </button>
                    </div>
                `;
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserProfile() {
            if (!currentUser) {
                const container = document.getElementById('profileTasksList');
                if (container) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-user empty-state-icon"></i>
                            <h3 class="empty-state-title">–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç</h3>
                            <p class="empty-state-description">–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏</p>
                            <button class="btn btn-primary" onclick="showLoginModal()">
                                <i class="fas fa-sign-in-alt"></i>
                                –í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç
                            </button>
                        </div>
                    `;
                }
                return;
            }
            
            try {
                const token = localStorage.getItem('token');
                if (!token) return;
                
                const response = await fetch(`${API_BASE_URL}/api/auth/profile`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        currentUser = data.data.user;
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        updateUserInterface();
                        
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–¥–∞—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        await loadRecentTasks();
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–¥–∞—á –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è
        async function loadRecentTasks() {
            try {
                const token = localStorage.getItem('token');
                if (!token) return;
                
                const response = await fetch(`${API_BASE_URL}/api/tasks?limit=3`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                const container = document.getElementById('profileTasksList');
                
                if (data.success && data.data.tasks && data.data.tasks.length > 0) {
                    userTasks = data.data.tasks;
                    renderRecentTasks(container);
                } else if (container) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-tasks empty-state-icon"></i>
                            <h3 class="empty-state-title">–ó–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                            <p class="empty-state-description">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á:', error);
            }
        }
        
        function renderRecentTasks(container) {
            if (!container || !userTasks || userTasks.length === 0) return;
            
            container.innerHTML = '';
            
            userTasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = 'card task-item';
                taskElement.style.cursor = 'pointer';
                taskElement.onclick = () => showTaskDetailsPopup(task.id);
                
                const statusText = getStatusText(task.status);
                const statusClass = task.status ? `task-status ${task.status}` : 'task-status';
                
                taskElement.innerHTML = `
                    <div class="task-header">
                        <div class="task-title">${task.title}</div>
                        <span class="${statusClass}">${statusText}</span>
                    </div>
                    <div style="color: var(--graphite-medium); font-size: 0.9rem; margin-bottom: 8px;">
                        ${task.category_name || ''}
                    </div>
                    <div style="color: var(--graphite-light); font-size: 0.8rem;">
                        <i class="far fa-calendar" style="margin-right: 8px;"></i>
                        ${new Date(task.created_at).toLocaleDateString('ru-RU')}
                    </div>
                `;
                container.appendChild(taskElement);
            });
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
        async function loadUserTasks(filter = 'all') {
            try {
                currentTaskFilter = filter;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–±
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                const activeTab = document.querySelector(`.tab[onclick*="${filter}"]`);
                if (activeTab) {
                    activeTab.classList.add('active');
                }
                
                const token = localStorage.getItem('token');
                if (!token) return;
                
                const url = filter === 'all' 
                    ? `${API_BASE_URL}/api/tasks?limit=50`
                    : `${API_BASE_URL}/api/tasks?status=${filter}&limit=50`;
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                const container = document.getElementById('userTasksList');
                
                if (data.success && data.data.tasks && data.data.tasks.length > 0) {
                    userTasks = data.data.tasks;
                    renderUserTasks(container);
                } else if (container) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-tasks empty-state-icon"></i>
                            <h3 class="empty-state-title">–ó–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                            <p class="empty-state-description">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ–º–æ—â—å –æ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–æ–º–æ—â–Ω–∏—Ü</p>
                            <button class="btn btn-primary" onclick="checkSubscription()">
                                <i class="fas fa-plus"></i>
                                –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
                            </button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á', 'error');
            }
        }
        
        function renderUserTasks(container) {
            if (!container || !userTasks || userTasks.length === 0) return;
            
            container.innerHTML = '';
            
            // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –∑–∞–¥–∞—á
            const table = document.createElement('table');
            table.className = 'task-history-table';
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>–ù–æ–º–µ—Ä –∑–∞–¥–∞—á–∏</th>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    ${userTasks.map(task => `
                        <tr>
                            <td>${task.task_number}</td>
                            <td>${task.title}</td>
                            <td>${task.category_name || ''}</td>
                            <td><span class="task-status ${task.status}">${getStatusText(task.status)}</span></td>
                            <td>${formatDate(task.created_at)}</td>
                            <td>
                                <button class="btn btn-secondary btn-sm" onclick="showTaskDetailsPopup(${task.id})" style="padding: 4px 8px; font-size: 0.8rem;">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            `;
            
            container.appendChild(table);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        async function showTaskDetailsPopup(taskId) {
            try {
                const token = localStorage.getItem('token');
                if (!token) return;
                
                showLoading('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ç–∞–ª–µ–π –∑–∞–¥–∞—á–∏...');
                
                const response = await fetch(`${API_BASE_URL}/api/tasks/${taskId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const task = data.data.task;
                    const messages = data.data.messages || [];
                    chatMessages = messages;
                    currentChatTaskId = taskId;
                    
                    const container = document.getElementById('taskDetailsContent');
                    
                    if (container) {
                        container.innerHTML = `
                            <div class="task-detail-section">
                                <h3>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                                <div class="task-detail-grid">
                                    <div class="task-detail-item">
                                        <h4>–ù–æ–º–µ—Ä –∑–∞–¥–∞—á–∏</h4>
                                        <p>${task.task_number}</p>
                                    </div>
                                    <div class="task-detail-item">
                                        <h4>–°—Ç–∞—Ç—É—Å</h4>
                                        <p><span class="task-status ${task.status}">${getStatusText(task.status)}</span></p>
                                    </div>
                                    <div class="task-detail-item">
                                        <h4>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</h4>
                                        <p>${getPriorityText(task.priority)}</p>
                                    </div>
                                    <div class="task-detail-item">
                                        <h4>–ë—é–¥–∂–µ—Ç</h4>
                                        <p>${task.price ? task.price.toLocaleString() + ' ‚ÇΩ' : '–í–∫–ª—é—á–µ–Ω–æ –≤ –ø–æ–¥–ø–∏—Å–∫—É'}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="task-detail-section">
                                <h3>–î–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏</h3>
                                <div class="task-detail-grid">
                                    <div class="task-detail-item">
                                        <h4>–ù–∞–∑–≤–∞–Ω–∏–µ</h4>
                                        <p>${task.title}</p>
                                    </div>
                                    <div class="task-detail-item">
                                        <h4>–û–ø–∏—Å–∞–Ω–∏–µ</h4>
                                        <p>${task.description}</p>
                                    </div>
                                    <div class="task-detail-item">
                                        <h4>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</h4>
                                        <p>${task.category_name || ''}</p>
                                    </div>
                                    <div class="task-detail-item">
                                        <h4>–£—Å–ª—É–≥–∞</h4>
                                        <p>${task.service_name || ''}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="task-detail-section">
                                <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –∞–¥—Ä–µ—Å</h3>
                                <div class="task-detail-grid">
                                    <div class="task-detail-item">
                                        <h4>–ê–¥—Ä–µ—Å</h4>
                                        <p>${task.address}</p>
                                    </div>
                                    <div class="task-detail-item">
                                        <h4>–ö–æ–Ω—Ç–∞–∫—Ç –¥–ª—è —Å–≤—è–∑–∏</h4>
                                        <p>${task.contact_info}</p>
                                    </div>
                                    <div class="task-detail-item">
                                        <h4>–î–µ–¥–ª–∞–π–Ω</h4>
                                        <p>${formatDate(task.deadline)}</p>
                                    </div>
                                    <div class="task-detail-item">
                                        <h4>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è</h4>
                                        <p>${task.additional_requirements || '–ù–µ —É–∫–∞–∑–∞–Ω—ã'}</p>
                                    </div>
                                </div>
                            </div>
                            
                            ${task.performer_first_name ? `
                            <div class="task-detail-section">
                                <h3>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</h3>
                                <div class="task-detail-grid">
                                    <div class="task-detail-item">
                                        <h4>–ò–º—è</h4>
                                        <p>${task.performer_first_name} ${task.performer_last_name || ''}</p>
                                    </div>
                                    <div class="task-detail-item">
                                        <h4>–¢–µ–ª–µ—Ñ–æ–Ω</h4>
                                        <p>${task.performer_phone || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                                    </div>
                                    <div class="task-detail-item">
                                        <h4>–†–µ–π—Ç–∏–Ω–≥</h4>
                                        <p>${task.performer_rating || '–ù–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞'}</p>
                                    </div>
                                    ${task.performer_avatar ? `
                                    <div class="task-detail-item">
                                        <h4>–ê–≤–∞—Ç–∞—Ä</h4>
                                        <img src="${task.performer_avatar}" alt="–ê–≤–∞—Ç–∞—Ä –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è" style="width: 60px; height: 60px; border-radius: 50%;">
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                            ` : ''}
                            
                            <div class="task-detail-section">
                                <h3>–í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                                <div class="task-detail-grid">
                                    <div class="task-detail-item">
                                        <h4>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</h4>
                                        <p>${formatDate(task.created_at)}</p>
                                    </div>
                                    ${task.started_at ? `
                                    <div class="task-detail-item">
                                        <h4>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</h4>
                                        <p>${formatDate(task.started_at)}</p>
                                    </div>
                                    ` : ''}
                                    ${task.completed_at ? `
                                    <div class="task-detail-item">
                                        <h4>–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è</h4>
                                        <p>${formatDate(task.completed_at)}</p>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                            
                            <!-- –ö–Ω–æ–ø–∫–∞ —á–∞—Ç–∞ -->
                            <div style="margin-top: 30px;">
                                <button class="btn btn-primary" onclick="openTaskChat(${task.id})" style="width: 100%;">
                                    <i class="fas fa-comments"></i> –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç —Å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º
                                </button>
                            </div>
                            
                            <!-- –î–µ–π—Å—Ç–≤–∏—è —Å –∑–∞–¥–∞—á–µ–π -->
                            <div style="margin-top: 30px; display: flex; gap: 10px;">
                                <button class="btn btn-secondary" onclick="navigateToPage('tasks')">
                                    <i class="fas fa-arrow-left"></i>
                                    –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
                                </button>
                                ${task.status === 'new' || task.status === 'searching' || task.status === 'assigned' ? `
                                <button class="btn btn-primary" onclick="updateTaskStatus(${task.id}, 'cancelled')">
                                    <i class="fas fa-times"></i>
                                    –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–¥–∞—á—É
                                </button>
                                ` : ''}
                                ${(task.status === 'assigned' || task.status === 'in_progress') && currentUser.role === 'client' ? `
                                <button class="btn btn-success" onclick="completeTask(${task.id})">
                                    <i class="fas fa-check"></i>
                                    –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É
                                </button>
                                ` : ''}
                            </div>
                        `;
                        
                        navigateToPage('task-details');
                    }
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á–∏');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π –∑–∞–¥–∞—á–∏:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π –∑–∞–¥–∞—á–∏', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç –∑–∞–¥–∞—á–∏
        async function openTaskChat(taskId) {
            try {
                showLoading('–ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–∞...');
                
                // –ü–æ–ª—É—á–∞–µ–º –∑–∞–¥–∞—á—É –∏ —Å–æ–æ–±—â–µ–Ω–∏—è
                const [taskResponse, messagesResponse] = await Promise.all([
                    fetch(`${API_BASE_URL}/api/tasks/${taskId}`, {
                        headers: { 'Authorization': `Bearer ${currentToken}` }
                    }),
                    fetch(`${API_BASE_URL}/api/tasks/${taskId}/messages`, {
                        headers: { 'Authorization': `Bearer ${currentToken}` }
                    })
                ]);
                
                if (!taskResponse.ok || !messagesResponse.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–∞');
                }
                
                const taskData = await taskResponse.json();
                const messagesData = await messagesResponse.json();
                
                if (!taskData.success || !messagesData.success) {
                    throw new Error('–û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–∞—Ç–∞');
                }
                
                const task = taskData.data.task;
                chatMessages = messagesData.data.messages || [];
                currentChatTaskId = taskId;
                
                // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —á–∞—Ç–∞
                const chatModal = document.createElement('div');
                chatModal.className = 'chat-modal';
                chatModal.id = 'taskChatModal';
                
                chatModal.innerHTML = `
                    <div class="chat-modal-content">
                        <div class="chat-header" style="
                            padding: 20px;
                            background: linear-gradient(135deg, var(--gold-metallic), var(--gold-dark));
                            color: white;
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                        ">
                            <div>
                                <h3 style="margin: 0; font-size: 1.2rem;">–ß–∞—Ç –ø–æ –∑–∞–¥–∞—á–µ: ${task.title}</h3>
                                <p style="margin: 5px 0 0 0; font-size: 0.9rem; opacity: 0.9;">
                                    ${task.performer_first_name ? `–° –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º: ${task.performer_first_name}` : '–û–∂–∏–¥–∞–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è'}
                                </p>
                            </div>
                            <button onclick="closeChatModal()" style="
                                background: rgba(255,255,255,0.2);
                                border: none;
                                color: white;
                                width: 40px;
                                height: 40px;
                                border-radius: 50%;
                                cursor: pointer;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            ">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div class="chat-messages-container" id="chatMessagesContent" style="
                            flex: 1;
                            overflow-y: auto;
                            padding: 20px;
                            background: rgba(249, 247, 243, 0.5);
                            display: flex;
                            flex-direction: column;
                            gap: 10px;
                        ">
                            <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                        </div>
                        
                        <div class="chat-input-area" style="
                            padding: 15px 20px;
                            border-top: 1px solid rgba(61, 61, 61, 0.1);
                            background: white;
                            display: flex;
                            gap: 10px;
                        ">
                            <textarea 
                                id="chatMessageInput" 
                                placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
                                style="
                                    flex: 1;
                                    padding: 12px 16px;
                                    border: 1px solid rgba(61, 61, 61, 0.1);
                                    border-radius: 24px;
                                    font-family: 'Inter', sans-serif;
                                    font-size: 0.95rem;
                                    resize: none;
                                    min-height: 48px;
                                    max-height: 120px;
                                    transition: var(--transition);
                                "
                                onkeydown="handleChatKeydown(event)"
                            ></textarea>
                            <button 
                                id="sendChatButton"
                                onclick="sendChatMessage()"
                                style="
                                    background: linear-gradient(135deg, var(--gold-metallic), var(--gold-dark));
                                    color: white;
                                    border: none;
                                    border-radius: 50%;
                                    width: 48px;
                                    height: 48px;
                                    cursor: pointer;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    transition: var(--transition);
                                "
                            >
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(chatModal);
                renderChatMessages();
                startChatPolling();
                
                // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                const input = document.getElementById('chatMessageInput');
                if (input) {
                    input.focus();
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // –†–µ–Ω–¥–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞
        function renderChatMessages() {
            const container = document.getElementById('chatMessagesContent');
            if (!container) return;
            
            if (chatMessages.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--graphite-medium);">
                        <i class="fas fa-comments" style="font-size: 3rem; opacity: 0.3; margin-bottom: 16px;"></i>
                        <p>–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</p>
                        <p class="text-sm">–ù–∞—á–Ω–∏—Ç–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = chatMessages.map(msg => {
                const isCurrentUser = msg.user_id === currentUser.id;
                const senderName = isCurrentUser 
                    ? '–í—ã' 
                    : `${msg.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'} ${msg.last_name || ''}`;
                
                return `
                    <div style="display: flex; max-width: 80%; ${isCurrentUser ? 'margin-left: auto;' : ''}">
                        ${!isCurrentUser ? `
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, var(--lavender-light), var(--pastel-pink)); 
                                 display: flex; align-items: center; justify-content: center; margin-right: 10px; margin-top: 5px; color: var(--graphite-dark); font-weight: 600; font-size: 0.8rem;">
                                ${senderName.charAt(0)}
                            </div>
                        ` : ''}
                        
                        <div style="flex: 1;">
                            ${!isCurrentUser ? `
                                <div style="font-size: 0.8rem; font-weight: 600; color: var(--graphite-medium); margin-bottom: 4px;">
                                    ${senderName}
                                </div>
                            ` : ''}
                            
                            <div style="
                                padding: 12px 16px;
                                border-radius: 18px;
                                ${isCurrentUser 
                                    ? 'background: linear-gradient(135deg, var(--pastel-pink), #F0C8DE); color: var(--graphite-dark); border-bottom-right-radius: 4px;' 
                                    : 'background: white; border: 1px solid rgba(61, 61, 61, 0.1); color: var(--graphite-dark); border-bottom-left-radius: 4px;'
                                }
                                box-shadow: var(--shadow-sm);
                                word-break: break-word;
                            ">
                                ${msg.message}
                            </div>
                            
                            <div style="
                                font-size: 0.7rem;
                                color: var(--graphite-light);
                                margin-top: 4px;
                                ${isCurrentUser ? 'text-align: right;' : ''}
                            ">
                                ${new Date(msg.created_at).toLocaleString('ru-RU')}
                                ${msg.is_read && !isCurrentUser ? ' <i class="fas fa-check" style="color: var(--success);"></i>' : ''}
                            </div>
                        </div>
                        
                        ${isCurrentUser ? `
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, var(--gold-metallic), var(--gold-dark)); 
                                 display: flex; align-items: center; justify-content: center; margin-left: 10px; margin-top: 5px; color: white; font-weight: 600; font-size: 0.8rem;">
                                ${senderName.charAt(0)}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
            container.scrollTop = container.scrollHeight;
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
        async function sendChatMessage() {
            if (!currentChatTaskId) return;
            
            const input = document.getElementById('chatMessageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const sendBtn = document.getElementById('sendChatButton');
            sendBtn.disabled = true;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/tasks/${currentChatTaskId}/messages`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify({ message })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
                    input.value = '';
                    
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
                    await loadChatMessages();
                    
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
                showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è', 'error');
            } finally {
                sendBtn.disabled = false;
                input.focus();
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞
        async function loadChatMessages() {
            if (!currentChatTaskId) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/tasks/${currentChatTaskId}/messages`, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    chatMessages = data.data.messages || [];
                    renderChatMessages();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:', error);
            }
        }
        
        // –û–ø—Ä–æ—Å –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        function startChatPolling() {
            if (chatPollingInterval) {
                clearInterval(chatPollingInterval);
            }
            
            chatPollingInterval = setInterval(async () => {
                await loadChatMessages();
            }, 3000);
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ —á–∞—Ç–µ
        function handleChatKeydown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendChatMessage();
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ —á–∞—Ç–∞
        function closeChatModal() {
            if (chatPollingInterval) {
                clearInterval(chatPollingInterval);
                chatPollingInterval = null;
            }
            
            const modal = document.getElementById('taskChatModal');
            if (modal) {
                modal.remove();
            }
            
            currentChatTaskId = null;
            chatMessages = [];
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ø-–∞–ø –æ–∫–Ω–æ —Å –∑–∞–¥–∞—á–∞–º–∏
        function showTasksPopup() {
            if (!currentUser) {
                showNotification('–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–¥–∞—á –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'warning');
                showLoginModal();
                return;
            }
            
            loadPopupTasks();
            document.getElementById('tasksPopupModal').style.display = 'flex';
        }
        
        function closeTasksPopup() {
            document.getElementById('tasksPopupModal').style.display = 'none';
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á –¥–ª—è –ø–æ–ø-–∞–ø –æ–∫–Ω–∞
        async function loadPopupTasks() {
            try {
                const token = localStorage.getItem('token');
                if (!token) return;
                
                const response = await fetch(`${API_BASE_URL}/api/tasks?limit=10`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                const container = document.getElementById('popupTasksList');
                
                if (data.success && data.data.tasks && data.data.tasks.length > 0) {
                    const tasks = data.data.tasks;
                    
                    container.innerHTML = tasks.map(task => {
                        const status = getStatusInfo(task.status);
                        return `
                            <div class="task-quick-item" onclick="showTaskDetailsPopup(${task.id})">
                                <div class="task-quick-header">
                                    <div class="task-quick-title">${task.title}</div>
                                    <span class="task-quick-status ${task.status}">${status.name}</span>
                                </div>
                                <div class="task-quick-info">
                                    ${task.category_name || ''}
                                </div>
                                <div class="task-quick-date">
                                    –°–æ–∑–¥–∞–Ω–æ: ${new Date(task.created_at).toLocaleDateString('ru-RU')}
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    container.innerHTML = `
                        <div class="no-messages">
                            <i class="fas fa-tasks"></i>
                            <p>–ó–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç</p>
                            <button class="btn btn-primary mt-20" onclick="checkSubscription()">
                                <i class="fas fa-plus"></i>
                                –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
                            </button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á:', error);
                document.getElementById('popupTasksList').innerHTML = `
                    <div class="no-messages">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á</p>
                    </div>
                `;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏
        async function updateTaskStatus(taskId, status) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/tasks/${taskId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify({ status: status })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('–°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏
                    showTaskDetailsPopup(taskId);
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏:', error);
                showNotification(error.message, 'error');
            }
        }
        
        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
        async function completeTask(taskId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/tasks/${taskId}/complete`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('–ó–∞–¥–∞—á–∞ –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è', 'success');
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏
                    showTaskDetailsPopup(taskId);
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏:', error);
                showNotification(error.message, 'error');
            }
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
        function getPriorityText(priority) {
            const priorities = {
                'low': '–ù–∏–∑–∫–∏–π',
                'medium': '–°—Ä–µ–¥–Ω–∏–π',
                'high': '–í—ã—Å–æ–∫–∏–π',
                'urgent': '–°—Ä–æ—á–Ω—ã–π'
            };
            return priorities[priority] || priority;
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Ç–∞—Ç—É—Å–µ
        function getStatusInfo(status) {
            const statuses = {
                'new': { name: '–ù–æ–≤–∞—è', icon: 'fas fa-star', color: '#1976D2' },
                'searching': { name: '–ü–æ–∏—Å–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è', icon: 'fas fa-search', color: '#FF9800' },
                'assigned': { name: '–ù–∞–∑–Ω–∞—á–µ–Ω–∞', icon: 'fas fa-user-check', color: '#2196F3' },
                'in_progress': { name: '–í —Ä–∞–±–æ—Ç–µ', icon: 'fas fa-cogs', color: '#673AB7' },
                'completed': { name: '–í—ã–ø–æ–ª–Ω–µ–Ω–∞', icon: 'fas fa-check-circle', color: '#4CAF50' },
                'cancelled': { name: '–û—Ç–º–µ–Ω–µ–Ω–∞', icon: 'fas fa-times-circle', color: '#F44336' }
            };
            return statuses[status] || { name: status, icon: 'fas fa-question-circle', color: '#9E9E9E' };
        }
        
        function getStatusText(status) {
            const statusMap = {
                'new': '–ù–æ–≤–∞—è',
                'searching': '–ü–æ–∏—Å–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è',
                'assigned': '–ù–∞–∑–Ω–∞—á–µ–Ω–∞',
                'in_progress': '–í —Ä–∞–±–æ—Ç–µ',
                'completed': '–í—ã–ø–æ–ª–Ω–µ–Ω–∞',
                'cancelled': '–û—Ç–º–µ–Ω–µ–Ω–∞'
            };
            return statusMap[status] || status;
        }
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞ –ø–∞–Ω–µ–ª—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
        function navigateToPerformerPanel() {
            window.location.href = '/performer.html';
        }
        
async function login() {
    try {
        const phoneEmail = document.getElementById('loginPhoneInput').value;
        const password = document.getElementById('loginPasswordInput').value;
        
        if (!phoneEmail || !password) {
            showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
            return;
        }
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —á—Ç–æ –≤–≤–µ–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - —Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ email
        const isPhone = /^[\+]?[0-9\s\-\(\)]+$/.test(phoneEmail.replace(/\s/g, ''));
        
        let loginData;
        if (isPhone) {
            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
            const normalizedPhone = normalizePhone(phoneEmail);
            console.log('–í–≤–µ–¥–µ–Ω —Ç–µ–ª–µ—Ñ–æ–Ω:', phoneEmail, '–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω:', normalizedPhone);
            loginData = { phone: normalizedPhone, password };
        } else {
            loginData = { email: phoneEmail, password };
        }
                
                const response = await fetch(`${API_BASE_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(loginData)
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    // –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                    if (data.requires_phone_verification) {
                        showNotification('–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞', 'info');
                        openVerifyPhoneModal(data.phone);
                        return;
                    }
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');
                }
                
                if (data.success) {
                    localStorage.setItem('token', data.data.token);
                    localStorage.setItem('currentUser', JSON.stringify(data.data.user));
                    currentToken = data.data.token;
                    currentUser = data.data.user;
                    
                    showNotification('–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!', 'success');
                    closeModal('loginModal');
                    updateUserInterface();
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫–æ–π —ç–∫—Ä–∞–Ω –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
                    determineInitialScreen();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–¥–ø–∏—Å–∫–µ
                    setTimeout(() => {
                        showSubscriptionNotification();
                    }, 1500);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error);
                showNotification(error.message, 'error');
            }
        }

// –í —Ñ—É–Ω–∫—Ü–∏–∏ loginPerformer() –Ω–∞–π–¥–∏—Ç–µ –∏ –∏—Å–ø—Ä–∞–≤—å—Ç–µ:
async function loginPerformer() {
    const email = document.getElementById('loginEmail')?.value;
    const phone = document.getElementById('loginPhone')?.value;
    const password = document.getElementById('loginPassword')?.value;
    
    console.log('–ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è:', { email, phone });
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω
    if ((!email && !phone) || !password) {
        showNotification('–£–∫–∞–∂–∏—Ç–µ email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –ø–∞—Ä–æ–ª—å', 'error');
        return;
    }
    
    showLoading('–í—Ö–æ–¥ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è...');
    
    try {
        const response = await fetch('/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                email: email || null, 
                phone: phone || null, 
                password 
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            // –í —Ñ—É–Ω–∫—Ü–∏–∏ loginUser –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –¥–æ–±–∞–≤—å—Ç–µ:
            if (data.data.user.role === 'performer' || 
                data.data.user.role === 'admin' || 
                data.data.user.role === 'superadmin' || 
                data.data.user.role === 'manager') {
                
                showNotification('–í—ã –≤–æ—à–ª–∏ –∫–∞–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å. –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø–∞–Ω–µ–ª—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è...', 'success');
                setTimeout(() => {
                    window.location.href = '/performer.html';
                }, 1500);
                return;
            } else {
                showNotification('–≠—Ç–æ –ø–∞–Ω–µ–ª—å –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–æ–π—Ç–∏ –≤ –ø–∞–Ω–µ–ª—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è.', 'info');
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –ø–∞–Ω–µ–ª—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
                showPerformerPanelButton();
            }
            
        } else if (data.requires_phone_verification) {
            // –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
            showVerificationModal(data.phone);
            
        } else if (data.requires_initial_fee) {
            // –¢—Ä–µ–±—É–µ—Ç—Å—è –æ–ø–ª–∞—Ç–∞ –≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤–∑–Ω–æ—Å–∞
            showInitialFeeModal(data);
            
        } else {
            throw new Error(data.error || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');
        }
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è:', error);
        showNotification(error.message, 'error');
    } finally {
        hideLoading();
    }
}

// –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É –ø–∞–Ω–µ–ª–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
function showPerformerPanelButton() {
    const modal = document.getElementById('loginModal');
    if (!modal) return;
    
    const buttonHtml = `
        <div style="margin-top: 20px; padding: 15px; background: rgba(52, 152, 219, 0.1); border-radius: 10px; border: 1px solid rgba(52, 152, 219, 0.2);">
            <p style="margin-bottom: 10px; font-weight: 500; color: #3498DB;">–í—ã –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å?</p>
            <button onclick="goToPerformerPanel()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #3498DB, #2980B9); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
                <i class="fas fa-user-tie"></i>
                –í–æ–π—Ç–∏ –≤ –ø–∞–Ω–µ–ª—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
            </button>
        </div>
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    const existingButton = modal.querySelector('.performer-panel-button');
    if (existingButton) {
        existingButton.remove();
    }
    
    const buttonDiv = document.createElement('div');
    buttonDiv.className = 'performer-panel-button';
    buttonDiv.innerHTML = buttonHtml;
    
    const form = modal.querySelector('form');
    if (form) {
        form.parentNode.insertBefore(buttonDiv, form.nextSibling);
    }
}

// –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø–∞–Ω–µ–ª—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
function goToPerformerPanel() {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –≤—Ö–æ–¥–∞
    const email = document.getElementById('loginEmail')?.value;
    const phone = document.getElementById('loginPhone')?.value;
    const password = document.getElementById('loginPassword')?.value;
    
    localStorage.setItem('performer_login_data', JSON.stringify({
        email: email || null,
        phone: phone || null,
        password: password || null
    }));
    
    window.location.href = '/performer.html';
}
        
async function register() {
    try {
        const firstName = document.getElementById('registerFirstName').value;
        const lastName = document.getElementById('registerLastName').value;
        const email = document.getElementById('registerEmail').value;
        const phone = document.getElementById('registerPhone').value;
        const password = document.getElementById('registerPassword').value;
        
        if (!firstName || !phone || !password) {
            showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –ø–∞—Ä–æ–ª—å', 'error');
            return;
        }
        
        // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
        const normalizedPhone = normalizePhone(phone);
        console.log('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è. –í–≤–µ–¥–µ–Ω —Ç–µ–ª–µ—Ñ–æ–Ω:', phone, '–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω:', normalizedPhone);
                
                if (password.length < 6) {
                    showNotification('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                    return;
                }
                
        const response = await fetch(`${API_BASE_URL}/api/auth/register`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                email,
                password,
                first_name: firstName,
                last_name: lastName || '',
                phone: normalizedPhone, // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω
                subscription_plan: 'essential'
            })
        });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
                }
                
                if (data.success) {
                    // –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
                    if (data.data.requires_phone_verification && data.data.can_verify_immediately) {
                        showNotification('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ—á—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω.', 'info');
                        closeModal('registerModal');
                        
                        // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —Å—Ä–∞–∑—É
                        setTimeout(() => {
                            openVerifyPhoneModal(data.data.phone);
                        }, 500);
                        
                        // –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –æ–Ω –µ—â–µ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
                    } else if (data.data.token) {
                        // –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –µ—Å—Ç—å (–ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ —ç—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
                        localStorage.setItem('token', data.data.token);
                        localStorage.setItem('currentUser', JSON.stringify(data.data.user));
                        currentToken = data.data.token;
                        currentUser = data.data.user;
                        
                        showNotification('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!', 'success');
                        closeModal('registerModal');
                        updateUserInterface();
                        
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫–æ–π —ç–∫—Ä–∞–Ω –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                        determineInitialScreen();
                    }
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', error);
                showNotification(error.message, 'error');
            }
        }
        
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('currentUser');
            currentToken = null;
            currentUser = null;
            updateUserInterface();
            showNotification('–í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'success');
            navigateToPage('auth');
            closeUserMenu();
        }
        
        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        function showLoginModal() {
            closeAllModals();
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.classList.add('active');
                document.getElementById('loginPhoneInput')?.focus();
            }
            closeUserMenu();
        }
        
        function showRegisterModal() {
            closeAllModals();
            const modal = document.getElementById('registerModal');
            if (modal) {
                modal.classList.add('active');
                document.getElementById('registerFirstName')?.focus();
            }
        }
        
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
            }
        }
        
        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('active');
            });
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function formatNumber(num) {
            if (!num && num !== 0) return '0';
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
        }
        
        function formatDate(dateString) {
            if (!dateString) return '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        }

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø—Ä–∏ –≤–≤–æ–¥–µ
function formatPhoneInput(input) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ–ª–µ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –∞ –Ω–µ –¥–ª—è –∫–æ–¥–∞
    if (input.id && (input.id.includes('Code') || input.id.includes('code'))) {
        return;
    }
    
    if (input.placeholder && (input.placeholder.includes('–∫–æ–¥') || input.placeholder.includes('–ö–æ–¥'))) {
        return;
    }
    
    let value = input.value.replace(/\D/g, '');
    
    // –ï—Å–ª–∏ –Ω–æ–º–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 7, 8 –∏–ª–∏ 9
    if (value.length > 0) {
        if (value.startsWith('7') || value.startsWith('8')) {
            if (value.length === 1) {
                input.value = '+7';
            } else if (value.length <= 4) {
                input.value = '+7 (' + value.substring(1, 4);
            } else if (value.length <= 7) {
                input.value = '+7 (' + value.substring(1, 4) + ') ' + value.substring(4, 7);
            } else if (value.length <= 9) {
                input.value = '+7 (' + value.substring(1, 4) + ') ' + value.substring(4, 7) + '-' + value.substring(7, 9);
            } else {
                input.value = '+7 (' + value.substring(1, 4) + ') ' + value.substring(4, 7) + '-' + value.substring(7, 9) + '-' + value.substring(9, 11);
            }
        } else if (value.startsWith('9')) {
            // –ï—Å–ª–∏ –≤–≤–µ–ª–∏ –Ω–æ–º–µ—Ä —Å 9 –±–µ–∑ –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã
            if (value.length <= 3) {
                input.value = '+7 (' + value.substring(0, 3);
            } else if (value.length <= 6) {
                input.value = '+7 (' + value.substring(0, 3) + ') ' + value.substring(3, 6);
            } else if (value.length <= 8) {
                input.value = '+7 (' + value.substring(0, 3) + ') ' + value.substring(3, 6) + '-' + value.substring(6, 8);
            } else {
                input.value = '+7 (' + value.substring(0, 3) + ') ' + value.substring(3, 6) + '-' + value.substring(6, 8) + '-' + value.substring(8, 10);
            }
        }
    }
}

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
        function normalizePhone(phone) {
            if (!phone) return '';
            
            // –£–±–∏—Ä–∞–µ–º –≤—Å–µ –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã
            let cleaned = phone.replace(/\D/g, '');
            
            // –ï—Å–ª–∏ –Ω–æ–º–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 7 –∏–ª–∏ 8 (11 —Ü–∏—Ñ—Ä)
            if (/^[78]\d{10}$/.test(cleaned)) {
                return '+7' + cleaned.substring(1);
            }
            // –ï—Å–ª–∏ –Ω–æ–º–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 9 (10 —Ü–∏—Ñ—Ä)
            else if (/^9\d{9}$/.test(cleaned)) {
                return '+7' + cleaned;
            }
            // –ï—Å–ª–∏ –Ω–æ–º–µ—Ä —É–∂–µ —Å –ø–ª—é—Å–æ–º
            else if (cleaned.startsWith('7') || cleaned.startsWith('8')) {
                return '+' + cleaned;
            }
            // –ï—Å–ª–∏ —É–∂–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
            else if (cleaned.startsWith('7')) {
                return '+' + cleaned;
            }
            
            return phone;
        }
        
        function showNotification(message, type = 'success') {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const oldNotifications = document.querySelectorAll('.notification');
            oldNotifications.forEach(notif => notif.remove());
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = 'fas fa-check-circle';
            if (type === 'error') icon = 'fas fa-exclamation-circle';
            if (type === 'warning') icon = 'fas fa-exclamation-triangle';
            if (type === 'info') icon = 'fas fa-info-circle';
            
            notification.innerHTML = `
                <i class="${icon}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 5000);
        }
        
        function showLoading(message = '–ó–∞–≥—Ä—É–∑–∫–∞...') {
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏
            const loadingEl = document.createElement('div');
            loadingEl.id = 'globalLoading';
            loadingEl.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(255, 255, 255, 0.9);
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                z-index: 9999;
            `;
            
            loadingEl.innerHTML = `
                <div class="spinner"></div>
                <p style="margin-top: 20px; color: var(--graphite-dark);">${message}</p>
            `;
            
            document.body.appendChild(loadingEl);
        }
        
        function hideLoading() {
            const loadingEl = document.getElementById('globalLoading');
            if (loadingEl) {
                loadingEl.remove();
            }
        }
        
        // –ú–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function toggleUserMenu() {
            const menu = document.getElementById('userMenu');
            if (menu) {
                menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
            }
        }
        
        function closeUserMenu() {
            const menu = document.getElementById('userMenu');
            if (menu) {
                menu.style.display = 'none';
            }
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü
        function filterTasks(status) {
            loadUserTasks(status);
        }
        
        function showHelp() {
            showNotification('–°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–æ email: support@concierge.ru', 'info');
            closeUserMenu();
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        window.navigateToPage = navigateToPage;
        window.checkSubscription = checkSubscription;
        window.cancelTask = cancelTask;
        window.showLoginModal = showLoginModal;
        window.showRegisterModal = showRegisterModal;
        window.logout = logout;
        window.toggleUserMenu = toggleUserMenu;
        window.selectSubscription = selectSubscription;
        window.filterTasks = filterTasks;
        window.showTaskDetails = showTaskDetailsPopup;
        window.showTaskDetailsPopup = showTaskDetailsPopup;
        window.showHelp = showHelp;
        window.showTasksPopup = showTasksPopup;
        window.closeTasksPopup = closeTasksPopup;
        window.updateTaskStatus = updateTaskStatus;
        window.completeTask = completeTask;
        window.openTaskChat = openTaskChat;
        window.closeChatModal = closeChatModal;
        window.sendChatMessage = sendChatMessage;
        window.handleChatKeydown = handleChatKeydown;
        window.navigateToPerformerPanel = navigateToPerformerPanel;
        window.openVerifyPhoneModal = openVerifyPhoneModal;
        window.openSendCodeModal = openSendCodeModal;
        window.verifyPhoneCode = verifyPhoneCode;
        window.sendVerificationCode = sendVerificationCode;
    </script>
</body>
</html>
